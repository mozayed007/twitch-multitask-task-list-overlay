var Ft=T=>{throw TypeError(T)};var Tt=(T,M,O)=>M.has(T)||Ft("Cannot "+O);var o=(T,M,O)=>(Tt(T,M,"read from private field"),O?O.call(T):M.get(T)),g=(T,M,O)=>M.has(T)?Ft("Cannot add the same private member more than once"):M instanceof WeakSet?M.add(T):M.set(T,O),m=(T,M,O,Te)=>(Tt(T,M,"write to private field"),Te?Te.call(T,O):M.set(T,O),O),d=(T,M,O)=>(Tt(T,M,"access private method"),O);var Lt=(T,M,O,Te)=>({set _(Oe){m(T,M,Oe,O)},get _(){return o(T,M,Te)}});(function(){"use strict";var Je,Rt,ke,Y,Ht,ne,le,x,Fe,ce,Re,q,de,ue,Ee,xe,he,Bt,_t,Nt,U,Pe,He,ve,Be,H,_,F,X,oe,W,j,K,be,we,Qe,Ze,Me,b,Yt,$t,jt,ie,lt,ct,Ke,Kt,Vt,Ve,Xt,C,et,I,_e,tt,wt,Ie,st,S,Wt,Gt,dt,Ct,Jt,Qt,Et,Zt,xt,De,es,P,ot,D,Ne,nt,St,Ae,it,L,ts,ss,os,ns,ut,ht,is,rs,as,Pt,Se,me,te,V,G,Ye,je,w,ls,cs,ds,us,hs,ms,Mt,fs,ps,mt,gs,ft,ys,pt;let T,M,O=!1;const Te=getComputedStyle(document.documentElement).getPropertyValue("--card-gap-between").slice(0,-2);function Oe(){const e=document.querySelector(".task-wrapper").clientHeight,t=document.querySelector(".task-container.primary"),s=t.scrollHeight,n=document.querySelector(".task-container.secondary");if(s>e&&!O){n.style.display="block";const l=_settings.scrollSpeed.toString();let r=parseInt(l,10),a=s+parseInt(Te,10)*2,u={duration:a/r*1e3,iterations:1,easing:"linear"},y=[{transform:"translateY(0)"},{transform:`translateY(-${a}px)`}],h=[{transform:"translateY(0)"},{transform:`translateY(-${a}px)`}];T=t.animate(y,u),M=n.animate(h,u),O=!0,vs()}else s<=e&&(n.style.display="none",ks())}function ks(){T&&T.cancel(),M&&M.cancel(),O=!1}function vs(){T&&(T.addEventListener("finish",It),T.addEventListener("cancel",It))}function It(){O=!1,Oe()}function gt(i,e){if(i.innerText===e)return;const t=i.animate([{opacity:1},{opacity:0}],{duration:350,fill:"forwards",easing:"ease-out"});t.onfinish=()=>{i.textContent=e,i.animate([{opacity:0},{opacity:1}],{duration:350,fill:"forwards",easing:"ease-in"})}}function bs(i){const e=document.querySelector(":root");for(let[t,s]of Object.entries(i))t.includes("FontFamily")&&ws(s),e.style.setProperty(Ss(t),s)}function ws(i){window.WebFont.load({google:{families:[`${i}:100,400,700`]}})}function Ss(i){return`--${i.replace(/([A-Z])/g,"-$1").toLowerCase()}`}class At{constructor(e,t){this.username=this.validateUsername(e),this.userColor=(t==null?void 0:t.userColor)||"",this.tasks=[]}validateUsername(e){if(typeof e!="string")throw new Error("Username must be of type string");if(e=e.trim(),e.length===0)throw new Error("Username invalid");return e}addTask(e){return this.tasks.push(e),e}editTask(e,t){let s=this.getTask(e);return s?(s.setDescription(t),s):null}completeTask(e){let t=this.getTask(e);return t?(t.setCompletionStatus(!0),t):null}setFocusedTask(e){let t=this.getTask(e);return t?(this.tasks.forEach(s=>{s.setFocusStatus(!1)}),t.setFocusStatus(!0),t):null}deleteTask(e){const t=[].concat(e).filter(n=>this.validTaskIndex(n)),s=[];return this.tasks=this.tasks.filter((n,l)=>t.includes(l)?(s.push(n),!1):!0),s}removeCompletedTasks(){const e=[];return this.tasks=this.tasks.filter(t=>t.isComplete()?(e.push(t),!1):!0),e}getTask(e){return this.validTaskIndex(e)?this.tasks[e]:null}getTasks(){return this.tasks}validTaskIndex(e){return!(typeof e!="number"||isNaN(e)||e<0||e>=this.tasks.length)}}class Dt{constructor(e){g(this,Je);this.description=this.validateDescription(e),this.id=d(this,Je,Rt).call(this),this.completionStatus=!1,this.focusStatus=!1}validateDescription(e){if(typeof e!="string")throw new Error("Task description must be of type string");if(e=e.trim(),e.length===0)throw new Error("Task description invalid");return e}setDescription(e){this.description=this.validateDescription(e)}isComplete(){return this.completionStatus}setCompletionStatus(e){if(typeof e!="boolean")throw new Error("Completion status must be of type boolean");this.completionStatus=e,this.isFocused()&&this.isComplete()&&this.setFocusStatus(!1)}isFocused(){return this.focusStatus}setFocusStatus(e){if(typeof e!="boolean")throw new Error("Focus status must be of type boolean");this.focusStatus=e}}Je=new WeakSet,Rt=function(){const e=new Date,t=String(e.getDate()).padStart(2,"0"),s=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0"),l=String(e.getSeconds()).padStart(2,"0"),r=String(e.getMilliseconds()).padStart(3,"0"),a=Math.floor(Math.random()*1e4);return`${t}${s}${n}${l}${r}${a}`};class Ts{constructor(e="userList"){g(this,Y);g(this,ke);m(this,ke,e),this.tasksCompleted=0,this.totalTasks=0,this.users=d(this,Y,Ht).call(this)}getUser(e){return this.users.find(t=>t.username===e)}getAllUsers(){return this.users}createUser(e,t){if(this.getUser(e))throw new Error(`${e} already exists`);const s=new At(e,t);return this.users.push(s),s}addUserTasks(e,t){const s=this.getUser(e);if(!s)throw new Error(`${e} does not exist`);const n=[].concat(t),l=[];return n.forEach(r=>{l.push(s.addTask(new Dt(r))),this.totalTasks++}),d(this,Y,ne).call(this),l}editUserTask(e,t,s){const n=this.getUser(e);if(!n)throw new Error(`${e} has no tasks`);const l=n.editTask(t,s);if(!l)throw new Error(`Task ${t} not found`);return d(this,Y,ne).call(this),l}focusUserTask(e,t){const s=this.getUser(e);if(!s)throw new Error(`User ${e} not found`);const n=s.setFocusedTask(t);if(!n)throw new Error(`Task ${t} not found`);return d(this,Y,ne).call(this),n}completeUserTasks(e,t){const s=this.getUser(e);if(!s)throw new Error(`User ${e} not found`);const n=[].concat(t).reduce((l,r)=>{const a=s.getTask(r);return a&&(a.isComplete()||(a.setCompletionStatus(!0),this.tasksCompleted++),l.push(a)),l},[]);return d(this,Y,ne).call(this),n}deleteUserTasks(e,t){const s=this.getUser(e);if(!s)throw new Error(`User ${e} not found`);const n=[].concat(t),l=s.deleteTask(n);return s.getTasks().length===0&&this.deleteUser(e),this.decreaseTaskCount(l),d(this,Y,ne).call(this),l}checkUserTasks(e,t="incomplete"){const s=this.getUser(e);if(!s)return new Map;const n=new Map;return s.getTasks().forEach((l,r)=>{t==="incomplete"&&!l.isComplete()&&n.set(r,l),t==="complete"&&l.isComplete()&&n.set(r,l)}),n}clearUserList(){this.users=[],this.tasksCompleted=0,this.totalTasks=0,d(this,Y,ne).call(this)}clearDoneTasks(){let e=[];for(let t=this.users.length-1;t>=0;t--){const s=this.users[t],n=s.removeCompletedTasks();e=e.concat(n),s.getTasks().length===0&&this.users.splice(t,1)}return this.decreaseTaskCount(e),d(this,Y,ne).call(this),e}deleteUser(e){const t=this.users.findIndex(l=>RegExp(`^${e}`,"i").test(l.username));if(t===-1)throw new Error(`${e} not found`);const s=this.users[t],n=this.users.splice(t,1)[0];return this.decreaseTaskCount(n.getTasks()),d(this,Y,ne).call(this),s}decreaseTaskCount(e){e.forEach(t=>{t.isComplete()&&this.tasksCompleted--,this.totalTasks--})}}ke=new WeakMap,Y=new WeakSet,Ht=function(){const e=[];let t=localStorage.getItem(o(this,ke));return t?JSON.parse(t).forEach(s=>{const n=new At(s.username,{userColor:s.userColor});s.tasks.map(l=>{const r=n.addTask(new Dt(l.description));this.totalTasks++,l.completionStatus&&(r.setCompletionStatus(l.completionStatus),this.tasksCompleted++),l.focusStatus&&r.setFocusStatus(l.focusStatus)}),e.push(n)}):localStorage.setItem(o(this,ke),JSON.stringify(e)),e},ne=function(){localStorage.setItem(o(this,ke),JSON.stringify(this.users))};const Ls=document.getElementById("audioSample");class $s{constructor(e){g(this,le,null);g(this,x);g(this,Fe);g(this,ce);g(this,Re);this.userList=new Ts(e),bs(_styles),m(this,x,_settings.languageCode),m(this,Fe,_settings.maxTasksPerUser),m(this,ce,_settings.headerFeature),m(this,Re,_settings.headerCustomText)}render(){this.renderTaskList(),this.renderTaskHeader()}renderTaskList(){const e=document.getElementById("task-list-container"),t=this.userList.users.length;if(e.classList.remove("minimized","single-item","expanded"),t===0){e.classList.add("minimized");return}else t===1?e.classList.add("single-item"):t>=5&&e.classList.add("expanded");const s=document.createDocumentFragment();this.userList.getAllUsers().forEach(c=>{const u=Ot(c),y=u.querySelector("ol");c.tasks.forEach(h=>{const p=document.createElement("li");p.classList.add("task"),p.dataset.taskId=`${h.id}`,p.innerText=h.description,h.isComplete()&&p.classList.add("done"),h.isFocused()&&p.classList.add("focus"),y.appendChild(p)}),s.appendChild(u)});const n=s.cloneNode(!0),l=document.querySelector(".task-container.primary");l.innerHTML="",l.appendChild(n);const r=s.cloneNode(!0),a=document.querySelector(".task-container.secondary");a.innerHTML="",a.appendChild(r),Oe()}renderTaskHeader(){this.renderTaskCount(),o(this,ce).toLowerCase()==="timer"?this.renderTimer():o(this,ce).toLowerCase()==="commands"?this.renderCommandTips():o(this,ce).toLowerCase()==="text"&&this.renderCustomText(o(this,Re))}renderTaskCount(){let e=this.userList.tasksCompleted,t=this.userList.totalTasks;const s=document.querySelector(".task-count");s.innerText=`${e}/${t}`}renderTimer(){document.querySelector(".timer").classList.remove("hidden")}startTimer(e=0,t=10){o(this,le)&&clearInterval(o(this,le));const s=document.querySelector(".timer"),n=s.querySelector(".timer-title"),l=s.querySelector(".timer-countdown");let r=e*60;gt(n,"Focus");let a=!0;const c=()=>{const u=Math.floor(r/60).toString().padStart(2,"0"),y=(r%60).toString().padStart(2,"0");l.textContent=`${u}:${y}`,r===0?(clearInterval(o(this,le)),gt(n,"Break"),l.textContent="00:00",Ls.play(),r=t*60,a&&(m(this,le,setInterval(c,1e3)),a=!1)):r--};m(this,le,setInterval(c,1e3))}renderCommandTips(){const e=["!task","!edit","!done","!delete","!check","!help"],t=document.querySelector(".command-tips");t.classList.remove("hidden");let s=0;setInterval(()=>{const n=t.querySelector(".command-code");gt(n,e[s]),s=(s+1)%e.length},6e3)}renderCustomText(e){document.querySelector(".custom-header").classList.remove("hidden"),document.querySelector(".custom-text").textContent=e}chatHandler(e,t,s,n,l){t=`!${t.toLowerCase()}`;let r="",a="";try{if(Cs(n))if(o(this,ce).toLowerCase()==="timer"&&_adminConfig.commands.timer.includes(t)){const[c,u]=s.split("/"),y=parseInt(c,10),h=parseInt(u,10)||10;if(isNaN(y)||y<0||isNaN(h)||h<0)throw new Error("Invalid timer duration");return this.startTimer(y,h),r=_adminConfig.responseTo[o(this,x)].timer+" ‚è≤Ô∏è",a=c,re(r,e,a)}else{if(_adminConfig.commands.clearList.includes(t))return this.userList.clearUserList(),this.clearListFromDOM(),r=_adminConfig.responseTo[o(this,x)].clearList,re(r,e,a);if(_adminConfig.commands.clearDone.includes(t))return this.userList.clearDoneTasks().forEach(({id:u})=>{this.deleteTaskFromDOM(u)}),r=_adminConfig.responseTo[o(this,x)].clearDone,re(r,e,a);if(_adminConfig.commands.clearUser.includes(t)){const c=this.userList.deleteUser(s);return this.deleteUserFromDOM(c),a=c.username,r=_adminConfig.responseTo[o(this,x)].clearUser,re(r,e,a)}}if(_userConfig.commands.addTask.includes(t)){if(!n.broadcaster)return re("üìã Use !backlog add [task] to manage your personal tasks!",e,"",!1);if(s==="")throw new Error("Task description is empty");let c=this.userList.getUser(e)||this.userList.createUser(e,{userColor:l.userColor});const u=s.split(", ");c.getTasks().length+u.length>parseInt(o(this,Fe).toString(),10)?r=_userConfig.responseTo[o(this,x)].maxTasksAdded:(this.userList.addUserTasks(e,u).forEach(h=>{this.addTaskToDOM(c,h)}),a=u.map(h=>`üìù "${h}"`).join(", ").replace(/,([^,]*)$/," &$1"),r=_userConfig.responseTo[o(this,x)].addTask)}else if(_userConfig.commands.editTask.includes(t)){if(!n.broadcaster)return re("üìã Use !backlog commands to manage your personal tasks!",e,"",!1);const c=s.search(new RegExp("(?<=\\d)\\s"));if(c===-1)throw new Error("Task number or description format is invalid");const u=s.slice(0,c),y=s.slice(c+1),h=this.userList.editUserTask(e,Le(u),y);this.editTaskFromDOM(h),a=u,r=_userConfig.responseTo[o(this,x)].editTask}else if(_userConfig.commands.focusTask.includes(t)){const c=Le(s),u=this.userList.focusUserTask(e,c);this.focusTaskFromDOM(e,u.id),a=(c+1).toString(),r=_userConfig.responseTo[o(this,x)].focusTask}else if(_userConfig.commands.finishTask.includes(t)){const c=s.split(",").reduce((y,h)=>(Le(h)>=0&&y.push(Le(h)),y),[]),u=this.userList.completeUserTasks(e,c);u.forEach(({id:y})=>{this.completeTaskFromDOM(y)}),u.length===0?r=_userConfig.responseTo[o(this,x)].noTaskFound:(a=u.map(y=>`‚úÖ "${y.description}"`).join(", ").replace(/,([^,]*)$/," &$1"),r=_userConfig.responseTo[o(this,x)].finishTask)}else if(_userConfig.commands.deleteTask.includes(t))if(a=s,s.toLowerCase()==="all"){const c=this.userList.deleteUser(e);this.deleteUserFromDOM(c),r=_userConfig.responseTo[o(this,x)].deleteAll}else{const c=s.split(",").reduce((y,h)=>(Le(h)>=0&&y.push(Le(h)),y),[]),u=this.userList.deleteUserTasks(e,c);u.forEach(({id:y})=>{this.deleteTaskFromDOM(y)}),u.length===0?r=_userConfig.responseTo[o(this,x)].noTaskFound:r=_userConfig.responseTo[o(this,x)].deleteTask}else if(_userConfig.commands.check.includes(t)){const c=this.userList.checkUserTasks(e),u=[];for(let[y,h]of c)u.push(`üìù ${y+1}. ${h.description}`);a=u.join(" "),a===""?r=_userConfig.responseTo[o(this,x)].noTaskFound:r=_userConfig.responseTo[o(this,x)].check}else if(_userConfig.commands.help.includes(t))r=_userConfig.responseTo[o(this,x)].help;else if(_userConfig.commands.additional.includes(t))r=_userConfig.responseTo[o(this,x)].additional;else throw new Error("command not found");return re(r,e,a)}catch(c){return re(_userConfig.responseTo[o(this,x)].invalidCommand,e,c.message,!0)}}clearListFromDOM(){const e=document.querySelector(".task-container.primary"),t=document.querySelector(".task-container.secondary");e.innerHTML="",t.innerHTML="",this.renderTaskCount()}addTaskToDOM(e,t){const s=document.querySelector(".task-container.primary"),n=document.querySelector(".task-container.secondary");if(document.querySelectorAll(`[data-user="${e.username}"]`).length===0){const c=Ot(e),u=c.cloneNode(!0);s.appendChild(c),n.appendChild(u)}const r=document.createElement("li");r.classList.add("task"),r.dataset.taskId=`${t.id}`,r.innerText=t.description;const a=r.cloneNode(!0);s.querySelector(`[data-user="${e.username}"] .tasks`).appendChild(r),n.querySelector(`[data-user="${e.username}"] .tasks`).appendChild(a),this.renderTaskCount(),Oe()}editTaskFromDOM(e){const t=document.querySelectorAll(`[data-task-id="${e.id}"]`);for(const s of t)s.innerText=e.description}completeTaskFromDOM(e){const t=document.querySelectorAll(`[data-task-id="${e}"]`);for(const s of t)s.classList.add("done"),s.classList.remove("focus");this.renderTaskCount()}focusTaskFromDOM(e,t){document.querySelectorAll(`[data-user="${e}"] .task`).forEach(s=>{s.classList.remove("focus")}),document.querySelectorAll(`[data-task-id="${t}"]`).forEach(s=>{s.classList.add("focus")})}deleteTaskFromDOM(e){const t=document.querySelectorAll(`[data-task-id="${e}"]`);for(const s of t)s.parentElement.children.length===1?s.parentElement.parentElement.remove():s.remove();this.renderTaskCount()}deleteUserFromDOM(e){const{username:t,tasks:s}=e,n=document.querySelectorAll(`[data-user="${t}"]`);for(let l of n)l.remove();this.renderTaskCount()}}le=new WeakMap,x=new WeakMap,Fe=new WeakMap,ce=new WeakMap,Re=new WeakMap;function re(i,e,t,s=!1){return{message:_settings.botResponsePrefix+i.replace("{user}",e).replace("{message}",t),error:s}}function Cs(i){return i.broadcaster||i.mod}function Le(i){return parseInt(i,10)-1}function Ot({username:i,userColor:e}){const t=document.createElement("div");t.classList.add("card"),t.dataset.user=i;const s=document.createElement("div");s.classList.add("username"),s.innerText=i,s.style.color=_settings.showUsernameColor?e:"",t.appendChild(s);const n=document.createElement("ol");return n.classList.add("tasks"),t.appendChild(n),t}function Es(){document.getElementById("modal").classList.remove("hidden"),document.getElementById("modal").classList.add("flex")}function xs(){document.getElementById("modal").classList.remove("flex"),document.getElementById("modal").classList.add("hidden")}function Ps(i){const e={command:null,parameters:null,source:null,tags:null};let t=0,s=null,n=null,l=null,r=null;if(i[t]==="@"){let c=i.indexOf(" ");s=i.slice(1,c),t=c+1}if(i[t]===":"){t+=1;let c=i.indexOf(" ",t);n=i.slice(t,c),t=c+1}let a=i.indexOf(":",t);return a===-1&&(a=i.length),l=i.slice(t,a).trim(),a!==i.length&&(t=a+1,r=i.slice(t)),e.command=Ms(l),e.command===null?null:(s!==null&&(e.tags=Is(s)),e.source=As(n),e.parameters=r,r&&r[0]==="!"&&(e.command=Ds(r,e.command)),e)}function Ms(i){let e=null;const t=i.split(" ");switch(t[0]){case"JOIN":case"PART":case"NOTICE":case"CLEARCHAT":case"HOSTTARGET":case"PRIVMSG":e={command:t[0],channel:t[1]};break;case"PING":e={command:t[0]};break;case"CAP":e={command:t[0],isCapRequestEnabled:t[2]==="ACK"};break;case"GLOBALUSERSTATE":e={command:t[0]};break;case"USERSTATE":case"ROOMSTATE":e={command:t[0],channel:t[1]};break;case"RECONNECT":e={command:t[0]};break;case"421":return console.error(`Unsupported IRC command: ${t[2]}`),null;case"001":e={command:t[0]};break;case"002":case"003":case"004":case"353":case"366":case"372":case"375":case"376":return null;default:return console.log(`Unexpected command: ${t[0]}`),null}return e}function Is(i){const e={"client-nonce":null,flags:null};let t={};return i.split(";").forEach(n=>{let l=n.split("="),r=l[1]===""?null:l[1];switch(l[0]){case"badges":case"badge-info":if(r){let c={};r.split(",").forEach(y=>{let h=y.split("/");c[h[0]]=h[1]}),t[l[0]]=c}else t[l[0]]=null;break;case"emotes":if(r){let c={};r.split("/").forEach(y=>{let h=y.split(":"),p=[];h[1].split(",").forEach(f=>{let v=f.split("-");p.push({startPosition:v[0],endPosition:v[1]})}),c[h[0]]=p}),t[l[0]]=c}else t[l[0]]=null;break;case"emote-sets":let a=r.split(",");t[l[0]]=a;break;default:e.hasOwnProperty(l[0])||(t[l[0]]=r)}}),t}function As(i){if(i==null)return null;{let e=i.split("!");return{nick:e.length==2?e[0]:null,host:e.length==2?e[1]:e[0]}}}function Ds(i,e){let s=i.slice(0+1).trim(),n=s.indexOf(" ");return n===-1?(e.botCommand=s.slice(0),e.botCommandParams=""):(e.botCommand=s.slice(0,n),e.botCommandParams=s.slice(n).trim()),e}class Os{constructor(){this.events=new Map}on(e,t){this.events.has(e)||this.events.set(e,[]),this.events.get(e).push(t)}emit(e,...t){this.events.has(e)&&this.events.get(e).forEach(s=>s(...t))}off(e,t){if(this.events.has(e)){const s=this.events.get(e),n=s.indexOf(t);n!==-1&&(s.splice(n,1),s.length===0&&this.events.delete(e))}}once(e,t){const s=(...n)=>{t(...n),this.off(e,s)};this.on(e,s)}}class zs extends Os{constructor(t,{username:s,authToken:n,channel:l},r=WebSocket){super();g(this,q,null);g(this,de,1e3);this.url=t,this.username=s.toLowerCase(),this.channel=`#${l.toLowerCase()}`,this.authToken=n.includes("oauth:")?n:`oauth:${n}`,this.WebSocketService=r}connect(){m(this,q,new this.WebSocketService(this.url)),o(this,q).onopen=()=>{o(this,q).send("CAP REQ :twitch.tv/tags twitch.tv/commands"),o(this,q).send(`PASS ${this.authToken}`),o(this,q).send(`NICK ${this.username}`)},o(this,q).onerror=t=>(console.error("websocket error: ",t),t),o(this,q).onmessage=t=>{(t==null?void 0:t.data).trim().split(`\r
`).forEach(l=>{const r=Ps(l);if(r)switch(r.command.command){case"PRIVMSG":if(r.parameters.startsWith("!")){const a=qs(r);this.emit("command",a)}break;case"PING":o(this,q).send("PONG "+r.parameters);break;case"001":o(this,q).send(`JOIN ${this.channel}`);break;case"JOIN":console.log(`Joined ${this.channel}`),m(this,de,1e3),this.emit("oauthSuccess");break;case"RECONNECT":this.disconnect(1012,"The Twitch IRC server is terminating the connection for maintenance reasons.");break;case"PART":console.error("The channel must have banned (/ban) the bot."),o(this,q).close();break;case"NOTICE":console.error(`${r.parameters}; left ${this.channel}`),this.emit("oauthError"),o(this,q).send(`PART ${this.channel}`);break}})},o(this,q).onclose=t=>{switch(t.code){case 1e3:console.log("Connection closed normally.");break;case 1006:console.error(`Connection dropped. Reconnecting in ${o(this,de)} milliseconds...`);let s=o(this,de);setTimeout(()=>{this.connect()},s),m(this,de,o(this,de)*2);break;case 1012:console.log("Switching  servers..."),this.connect();break;default:console.error(`Unhandled code: ${t.code}. Reason: ${t.reason}`)}}}say(t,s){var n;if(((n=o(this,q))==null?void 0:n.readyState)===WebSocket.OPEN){const r=[s?`@reply-parent-msg-id=${s}`:"","PRIVMSG",this.channel,`:${t}`].join(" ").trim();o(this,q).send(r)}else console.error("Connection is not open")}disconnect(t=1e3,s=""){o(this,q).close(t,s)}}q=new WeakMap,de=new WeakMap;function qs(i){var e,t;return{user:i.tags["display-name"],command:i.command.botCommand,message:i.command.botCommandParams||"",flags:{broadcaster:!!((e=i.tags.badges)!=null&&e.broadcaster),mod:!!((t=i.tags.badges)!=null&&t.moderator)},extra:{userColor:i.tags.color,messageId:i.tags.id}}}function Us(i){i.emit("command",{user:"adminUser",command:"clearList",message:"",flags:{broadcaster:!0,mod:!1},extra:{userColor:"#FF0000",messageId:`${yt()}`}});const e=["red","coral","springGreen","lightSeaGreen","slateBlue","hotpink","violet","orange","darkTurquoise","dodgerblue","blueviolet"],{maxTasksPerUser:t}=_settings;for(let s=1;s<=5;s++){const n=`Username${s}`,l=e[s-1];for(let r=0;r<t;r++){const a={user:n,command:"task",message:`test task description ${r===2?"longer text example":""}`,flags:{broadcaster:!0,mod:!1},extra:{userColor:l,messageId:`${yt()}`}};setTimeout(()=>{i.emit("command",a)},1e3*s+r*100)}setTimeout(()=>{const r={user:n,command:"done",message:"1",flags:{broadcaster:!0,mod:!1},extra:{userColor:l,messageId:`${yt()}`}};i.emit("command",r)},1e3*s+1e4)}}function yt(){return`${Math.floor(Math.random()*1e9)}`}class Fs{constructor(){g(this,he);g(this,ue,{});g(this,Ee,null);g(this,xe,null);d(this,he,Bt).call(this)}applyTheme(e){if(!o(this,ue)[e])return console.error(`Theme "${e}" not found`),!1;const t=o(this,ue)[e];return m(this,Ee,e),localStorage.setItem("currentTheme",e),d(this,he,_t).call(this,t),d(this,he,Nt).call(this,t.fonts),window.dispatchEvent(new CustomEvent("themeChanged",{detail:{themeName:e,theme:t}})),!0}getAvailableThemes(){return Object.entries(o(this,ue)).map(([e,t])=>({name:e,displayName:t.name}))}getCurrentTheme(){return o(this,Ee)}getCurrentThemeData(){return o(this,ue)[o(this,Ee)]}}ue=new WeakMap,Ee=new WeakMap,xe=new WeakMap,he=new WeakSet,Bt=async function(){try{const e=await fetch("./themes.json");m(this,xe,await e.json()),m(this,ue,o(this,xe).themes);const t=localStorage.getItem("currentTheme")||o(this,xe).defaultTheme;this.applyTheme(t)}catch(e){console.error("Failed to load themes:",e)}},_t=function(e){const t=document.documentElement,{colors:s,effects:n}=e;t.style.setProperty("--color-primary",s.primary),t.style.setProperty("--color-secondary",s.secondary),t.style.setProperty("--color-accent",s.accent),t.style.setProperty("--color-text",s.text),t.style.setProperty("--color-text-secondary",s.textSecondary),t.style.setProperty("--color-card-bg",s.cardBg),t.style.setProperty("--color-card-border",s.cardBorder),t.style.setProperty("--color-timer-ring",s.timerRing),t.style.setProperty("--color-timer-bg",s.timerBg),t.style.setProperty("--color-task-done",s.taskDone),t.style.setProperty("--color-task-focus",s.taskFocus),t.style.setProperty("--shadow",s.shadow),s.background.includes("gradient"),t.style.setProperty("--background",s.background),t.style.setProperty("--background-overlay",s.backgroundOverlay),t.style.setProperty("--blur",n.blur),t.style.setProperty("--border-radius",n.borderRadius),t.style.setProperty("--card-radius",n.cardRadius)},Nt=function(e){typeof WebFont<"u"&&WebFont.load({google:{families:[`${e.primary}:300,400,600,700`,`${e.secondary}:300,400,500,700`]}});const t=document.documentElement;t.style.setProperty("--font-primary",`'${e.primary}', sans-serif`),t.style.setProperty("--font-secondary",`'${e.secondary}', sans-serif`)};class Rs{constructor(e){g(this,b);g(this,U);g(this,Pe);g(this,He);g(this,ve);g(this,Be);g(this,H,null);g(this,_,0);g(this,F,0);g(this,X,"focus");g(this,oe,null);g(this,W,!1);g(this,j,0);g(this,K,4);g(this,be,25);g(this,we,5);g(this,Qe,15);g(this,Ze,4);g(this,Me,"pomoTimer.state");if(m(this,U,document.getElementById(e)),!o(this,U)){console.error(`Timer container "${e}" not found`);return}d(this,b,Yt).call(this)}startCycle(e=25,t=5,s=4,n=null){this.stop(),m(this,be,e),m(this,we,t),m(this,K,s),m(this,j,0),m(this,oe,n),d(this,b,$t).call(this),d(this,b,Ve).call(this)}start(e,t="focus",s=null){this.stop(),m(this,X,t),m(this,_,e*60),m(this,F,o(this,_)),m(this,oe,s),m(this,W,!1),d(this,b,Ke).call(this),m(this,H,setInterval(()=>d(this,b,ie).call(this),1e3)),d(this,b,ie).call(this)}stop(){o(this,H)&&(clearInterval(o(this,H)),m(this,H,null))}pause(){o(this,H)&&(clearInterval(o(this,H)),m(this,H,null),m(this,W,!0),d(this,b,Ve).call(this))}resume(){!o(this,H)&&o(this,F)>0&&o(this,W)&&(m(this,W,!1),m(this,H,setInterval(()=>d(this,b,ie).call(this),1e3)),d(this,b,Ve).call(this))}reset(){this.stop(),m(this,F,0),m(this,_,0),m(this,j,0),m(this,W,!1),d(this,b,lt).call(this),d(this,b,ct).call(this,0),o(this,ve).textContent="Ready",this.updatePomoCount(0,o(this,K)),d(this,b,Xt).call(this)}updatePomoCount(e,t){const s=o(this,U).querySelector(".pomo-number");s&&(s.textContent=`${e} / ${t}`)}getState(){return{mode:o(this,X),currentSeconds:o(this,F),totalSeconds:o(this,_),isRunning:o(this,H)!==null,isPaused:o(this,W),currentSession:o(this,j),totalSessions:o(this,K),focusDuration:o(this,be),breakDuration:o(this,we)}}restoreState(){try{const e=localStorage.getItem(o(this,Me));if(e){const t=JSON.parse(e);(t.isRunning||t.isPaused)&&(m(this,X,t.mode),m(this,F,t.currentSeconds),m(this,_,t.totalSeconds),m(this,j,t.currentSession),m(this,K,t.totalSessions),m(this,be,t.focusDuration),m(this,we,t.breakDuration),m(this,W,t.isPaused),d(this,b,lt).call(this),d(this,b,Ke).call(this),this.updatePomoCount(o(this,j),o(this,K)),t.isRunning&&m(this,H,setInterval(()=>d(this,b,ie).call(this),1e3)))}}catch(e){console.warn("Failed to restore timer state:",e)}}}U=new WeakMap,Pe=new WeakMap,He=new WeakMap,ve=new WeakMap,Be=new WeakMap,H=new WeakMap,_=new WeakMap,F=new WeakMap,X=new WeakMap,oe=new WeakMap,W=new WeakMap,j=new WeakMap,K=new WeakMap,be=new WeakMap,we=new WeakMap,Qe=new WeakMap,Ze=new WeakMap,Me=new WeakMap,b=new WeakSet,Yt=function(){o(this,U).innerHTML=`
			<div class="circular-timer">
				<svg class="timer-svg" viewBox="0 0 200 200">
					<!-- Background circle -->
					<circle
						class="timer-bg-circle"
						cx="100"
						cy="100"
						r="85"
						fill="none"
						stroke="var(--color-timer-bg)"
						stroke-width="12"
					/>
					<!-- Progress circle -->
					<circle
						class="timer-progress-ring"
						cx="100"
						cy="100"
						r="85"
						fill="none"
						stroke="var(--color-timer-ring)"
						stroke-width="12"
						stroke-linecap="round"
						transform="rotate(-90 100 100)"
					/>
				</svg>
				<div class="timer-content">
					<div class="timer-icon">
						<i class="icon-work">üìö</i>
					</div>
					<div class="timer-time">00:00</div>
					<div class="timer-label">Ready</div>
					<div class="timer-pomo-count">
						<span class="pomo-text">Pomo</span>
						<span class="pomo-number">0 / 4</span>
					</div>
				</div>
			</div>
		`,m(this,Pe,o(this,U).querySelector(".timer-progress-ring")),m(this,He,o(this,U).querySelector(".timer-time")),m(this,ve,o(this,U).querySelector(".timer-label")),m(this,Be,o(this,U).querySelector(".timer-icon")),d(this,b,ct).call(this,0)},$t=function(){if(o(this,j)>=o(this,K)){d(this,b,Vt).call(this);return}m(this,X,"focus"),Lt(this,j)._++,m(this,_,o(this,be)*60),m(this,F,o(this,_)),m(this,W,!1),d(this,b,Ke).call(this),this.updatePomoCount(o(this,j),o(this,K)),m(this,H,setInterval(()=>d(this,b,ie).call(this),1e3)),d(this,b,ie).call(this)},jt=function(){const e=o(this,j)%o(this,Ze)===0,t=e?o(this,Qe):o(this,we);m(this,X,e?"longbreak":"break"),m(this,_,t*60),m(this,F,o(this,_)),m(this,W,!1),d(this,b,Ke).call(this),m(this,H,setInterval(()=>d(this,b,ie).call(this),1e3)),d(this,b,ie).call(this)},ie=function(){if(o(this,F)<=0){this.stop(),d(this,b,Kt).call(this);return}Lt(this,F)._--,d(this,b,lt).call(this),d(this,b,ct).call(this,(o(this,_)-o(this,F))/o(this,_)*100),o(this,F)<=3&&o(this,F)>0&&o(this,U).classList.add("timer-pulse")},lt=function(){const e=Math.floor(o(this,F)/60).toString().padStart(2,"0"),t=(o(this,F)%60).toString().padStart(2,"0");o(this,He).textContent=`${e}:${t}`},ct=function(e){const t=2*Math.PI*85,s=t-e/100*t;o(this,Pe).style.strokeDasharray=`${t} ${t}`,o(this,Pe).style.strokeDashoffset=s},Ke=function(){const e={focus:{label:"Focus",icon:"üìö",class:"timer-focus-mode"},break:{label:"Short Break",icon:"‚òï",class:"timer-break-mode"},longbreak:{label:"Long Break",icon:"üå¥",class:"timer-longbreak-mode"}},t=e[o(this,X)]||e.focus;o(this,ve).textContent=t.label,o(this,Be).innerHTML=`<i class="icon-${o(this,X)}">${t.icon}</i>`,o(this,U).classList.remove("timer-focus-mode","timer-break-mode","timer-longbreak-mode"),o(this,U).classList.add(t.class)},Kt=function(){o(this,U).classList.remove("timer-pulse"),o(this,U).classList.add("timer-complete"),setTimeout(()=>{o(this,U).classList.remove("timer-complete")},2e3),o(this,X)==="focus"?setTimeout(()=>d(this,b,jt).call(this),2e3):setTimeout(()=>d(this,b,$t).call(this),2e3),o(this,oe)&&o(this,oe).call(this,o(this,X),o(this,j),o(this,K)),d(this,b,Ve).call(this)},Vt=function(){this.reset(),o(this,ve).textContent="Cycle Complete! üéâ",o(this,oe)&&o(this,oe).call(this,"cycle_complete",o(this,K),o(this,K))},Ve=function(){try{localStorage.setItem(o(this,Me),JSON.stringify(this.getState()))}catch(e){console.warn("Failed to save timer state:",e)}},Xt=function(){try{localStorage.removeItem(o(this,Me))}catch(e){console.warn("Failed to clear timer state:",e)}};class Hs{constructor(e){g(this,S);g(this,C,[]);g(this,et);g(this,I);g(this,_e,"taskBacklog");g(this,tt,50);g(this,wt,null);g(this,Ie,!1);g(this,st,15);if(m(this,et,e),m(this,I,document.getElementById(e)),!o(this,I)){console.error(`Backlog container "${e}" not found`);return}d(this,S,es).call(this),d(this,S,Wt).call(this),this.render()}addItem(e,t="Unknown",s=3){if(o(this,C).length>=o(this,tt))return console.warn("Backlog is full"),null;const n={id:Date.now().toString(),description:e,creator:t,priority:Math.max(1,Math.min(5,s)),completed:!1,createdAt:new Date().toISOString()};return o(this,C).push(n),d(this,S,dt).call(this),d(this,S,De).call(this),this.render(),n}removeItem(e){const t=o(this,C).findIndex(s=>s.id===e);return t===-1?!1:(o(this,C).splice(t,1),d(this,S,De).call(this),this.render(),!0)}toggleComplete(e){const t=o(this,C).find(s=>s.id===e);return t?(t.completed=!t.completed,d(this,S,De).call(this),this.render(),!0):!1}setPriority(e,t){const s=o(this,C).find(n=>n.id===e);return s?(s.priority=Math.max(1,Math.min(5,t)),d(this,S,dt).call(this),d(this,S,De).call(this),this.render(),!0):!1}clearCompleted(){const e=o(this,C).length;m(this,C,o(this,C).filter(s=>!s.completed));const t=e-o(this,C).length;return t>0&&(d(this,S,De).call(this),this.render()),t}getItems(){return[...o(this,C)]}getItemByIndex(e){return o(this,C)[e-1]||null}render(){const e=o(this,I).querySelector(".backlog-list-primary"),t=o(this,I).querySelector(".backlog-list-secondary"),s=o(this,I).querySelector(".backlog-empty"),n=o(this,I).querySelector(".backlog-count"),l=o(this,I).querySelector(".backlog-panel"),r=o(this,C).filter(c=>!c.completed).length;if(n.textContent=`${r} task${r!==1?"s":""}`,l.classList.remove("minimized","single-item","expanded"),o(this,C).length===0){l.classList.add("minimized"),e.classList.add("hidden"),t.classList.add("hidden"),s.classList.remove("hidden"),d(this,S,Et).call(this);return}else o(this,C).length===1?l.classList.add("single-item"):o(this,C).length>=5&&l.classList.add("expanded");e.classList.remove("hidden"),s.classList.add("hidden");const a=o(this,C).map((c,u)=>d(this,S,Zt).call(this,c,u+1)).join("");e.innerHTML=a,t.innerHTML=a,d(this,S,Ct).call(this,e),d(this,S,Ct).call(this,t),setTimeout(()=>d(this,S,Jt).call(this),100)}}C=new WeakMap,et=new WeakMap,I=new WeakMap,_e=new WeakMap,tt=new WeakMap,wt=new WeakMap,Ie=new WeakMap,st=new WeakMap,S=new WeakSet,Wt=function(){o(this,I).innerHTML=`
			<div class="backlog-panel">
				<div class="backlog-header">
					<div class="backlog-header-top">
						<h3 class="backlog-title">
							<span class="backlog-icon">üìã</span>
							Task Backlog
						</h3>
						<div class="backlog-controls">
							<span class="backlog-count">0 tasks</span>
							<button class="backlog-btn backlog-clear-btn" title="Clear completed">
								<span>üóëÔ∏è</span>
							</button>
						</div>
					</div>
					<div class="backlog-commands-hint">
						<span class="backlog-cmd-label">COMMANDS:</span>
						<span class="backlog-cmd-typewriter"></span>
					</div>
				</div>
				<div class="backlog-content-wrapper">
					<div class="backlog-content">
						<div class="backlog-list backlog-list-primary"></div>
						<div class="backlog-list backlog-list-secondary"></div>
						<div class="backlog-empty">
							<p>No tasks in backlog</p>
							<p class="backlog-hint">Use !backlog add [task] to add tasks</p>
						</div>
					</div>
				</div>
			</div>
		`,o(this,I).querySelector(".backlog-clear-btn").addEventListener("click",()=>this.clearCompleted()),d(this,S,Gt).call(this)},Gt=function(){const e=["!backlog add [task]","!backlog done #","!backlog remove #","!backlog clear (mods)"],t=o(this,I).querySelector(".backlog-cmd-typewriter");if(!t)return;let s=0,n=0,l=!1,r=!1;const a=()=>{const c=e[s];if(r){setTimeout(()=>{r=!1,l=!0,a()},2e3);return}l?(t.textContent=c.substring(0,n-1),n--,n===0?(l=!1,s=(s+1)%e.length,setTimeout(a,500)):setTimeout(a,40)):(t.textContent=c.substring(0,n+1),n++,n===c.length&&(r=!0),setTimeout(a,r?0:80))};a()},dt=function(){o(this,C).sort((e,t)=>e.completed!==t.completed?e.completed?1:-1:e.priority!==t.priority?t.priority-e.priority:new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())},Ct=function(e){e.querySelectorAll(".backlog-item-check").forEach(t=>{t.addEventListener("click",s=>{const l=s.target.closest(".backlog-item");l&&l.dataset&&this.toggleComplete(l.dataset.id)})}),e.querySelectorAll(".backlog-item-delete").forEach(t=>{t.addEventListener("click",s=>{const l=s.target.closest(".backlog-item");l&&l.dataset&&this.removeItem(l.dataset.id)})})},Jt=function(){const e=o(this,I).querySelector(".backlog-list-primary"),t=o(this,I).querySelector(".backlog-list-secondary");if(e)if(o(this,C).length>5&&!o(this,Ie)){const s=e.scrollHeight;t.style.display="flex",d(this,S,Qt).call(this,s)}else t.style.display="none",d(this,S,Et).call(this)},Qt=function(e){const t=o(this,I).querySelector(".backlog-list-primary"),s=o(this,I).querySelector(".backlog-list-secondary");if(!t||!s)return;const l=e+12,r=l/o(this,st)*1e3,a=[{transform:"translateY(0)"},{transform:`translateY(-${l}px)`}],c={duration:r,iterations:1/0,easing:"linear"};t.animate(a,c),s.animate(a,c),m(this,Ie,!0);const u=o(this,I).querySelector(".backlog-content");u&&u.classList.add("scrolling")},Et=function(){const e=o(this,I).querySelector(".backlog-list-primary"),t=o(this,I).querySelector(".backlog-list-secondary");e&&e.getAnimations().forEach(n=>n.cancel()),t&&t.getAnimations().forEach(n=>n.cancel()),m(this,Ie,!1);const s=o(this,I).querySelector(".backlog-content");s&&s.classList.remove("scrolling")},Zt=function(e,t){const s=e.completed?"‚úÖ":"‚¨ú",n=e.creator||"Unknown";return`
			<div class="backlog-item ${e.completed?"completed":""}" data-id="${e.id}">
				<div class="backlog-item-header">
					<span class="backlog-item-index">${t}.</span>
					<span class="backlog-item-creator" title="Created by ${n}">@${d(this,S,xt).call(this,n)}</span>
				</div>
				<div class="backlog-item-body">
					<button class="backlog-item-check" title="${e.completed?"Mark incomplete":"Mark complete"}">
						${s}
					</button>
					<span class="backlog-item-text">${d(this,S,xt).call(this,e.description)}</span>
				</div>
				<button class="backlog-item-delete" title="Delete">üóëÔ∏è</button>
			</div>
		`},xt=function(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML},De=function(){try{localStorage.setItem(o(this,_e),JSON.stringify(o(this,C)))}catch(e){console.error("Failed to save backlog:",e)}},es=function(){try{const e=localStorage.getItem(o(this,_e));e&&(m(this,C,JSON.parse(e)),d(this,S,dt).call(this))}catch(e){console.error("Failed to load backlog:",e),m(this,C,[])}};class Bs{constructor(e){g(this,L);g(this,P,new Map);g(this,ot);g(this,D);g(this,Ne,"viewerProfiles");g(this,nt,100);g(this,St,null);g(this,Ae,!1);g(this,it,15);if(m(this,ot,e),m(this,D,document.getElementById(e)),!o(this,D)){console.error(`Info panel container "${e}" not found`);return}d(this,L,is).call(this),d(this,L,ts).call(this),this.render()}setViewerInfo(e,t,s){o(this,P).has(e)||(o(this,P).size>=o(this,nt)&&d(this,L,ss).call(this),o(this,P).set(e,{username:e,info:{},lastActive:Date.now(),taskCount:0}));const n=o(this,P).get(e);return n.info[t]=s,n.lastActive=Date.now(),d(this,L,ht).call(this),this.render(),!0}getViewerInfo(e){return o(this,P).get(e)||null}updateViewerActivity(e,t=0){if(!o(this,P).has(e))o(this,P).set(e,{username:e,info:{},lastActive:Date.now(),taskCount:t});else{const s=o(this,P).get(e);s.lastActive=Date.now(),s.taskCount=t}d(this,L,ht).call(this),this.render()}getAllViewers(){return Array.from(o(this,P).values())}removeViewer(e){const t=o(this,P).delete(e);return t&&(d(this,L,ht).call(this),this.render()),t}getActiveViewers(){const e=Date.now()-36e5;return this.getAllViewers().filter(t=>t.lastActive>e)}render(){const e=o(this,D).querySelector(".info-list-primary"),t=o(this,D).querySelector(".info-list-secondary"),s=o(this,D).querySelector(".info-empty"),n=o(this,D).querySelector(".active-count"),l=o(this,D).querySelector(".total-count"),r=o(this,D).querySelector(".info-panel"),a=this.getActiveViewers();if(n.textContent=String(a.length),l.textContent=String(o(this,P).size),r.classList.remove("minimized","single-item","expanded"),o(this,P).size===0){r.classList.add("minimized"),e.classList.add("hidden"),t.classList.add("hidden"),s.classList.remove("hidden"),d(this,L,Pt).call(this);return}else o(this,P).size===1?r.classList.add("single-item"):o(this,P).size>=5&&r.classList.add("expanded");e.classList.remove("hidden"),s.classList.add("hidden");const u=this.getAllViewers().sort((y,h)=>h.lastActive-y.lastActive).slice(0,10).map(y=>d(this,L,os).call(this,y)).join("");e.innerHTML=u,t.innerHTML=u,setTimeout(()=>d(this,L,rs).call(this),100)}}P=new WeakMap,ot=new WeakMap,D=new WeakMap,Ne=new WeakMap,nt=new WeakMap,St=new WeakMap,Ae=new WeakMap,it=new WeakMap,L=new WeakSet,ts=function(){o(this,D).innerHTML=`
			<div class="info-panel">
				<div class="info-header">
					<h3 class="info-title">
						<span class="info-icon">üë•</span>
						Viewer Info
					</h3>
					<div class="info-stats">
						<span class="stat-item">
							<span class="stat-label">Active:</span>
							<span class="stat-value active-count">0</span>
						</span>
						<span class="stat-item">
							<span class="stat-label">Total:</span>
							<span class="stat-value total-count">0</span>
						</span>
					</div>
				</div>
				<div class="info-content-wrapper">
					<div class="info-content">
						<div class="info-list info-list-primary"></div>
						<div class="info-list info-list-secondary"></div>
						<div class="info-empty">
							<p>No viewer data yet</p>
							<p class="info-hint">Viewers can set info with !setinfo [field] [value]</p>
						</div>
					</div>
				</div>
			</div>
		`},ss=function(){const e=this.getAllViewers();e.length!==0&&(e.sort((t,s)=>t.lastActive-s.lastActive),o(this,P).delete(e[0].username))},os=function(e){const{username:t,info:s,lastActive:n,taskCount:l}=e,r=Date.now()-n<3600*1e3,a=d(this,L,ns).call(this,n),c=Object.entries(s).map(([u,y])=>`
				<div class="viewer-info-item">
					<span class="info-key">${d(this,L,ut).call(this,u)}:</span>
					<span class="info-value">${d(this,L,ut).call(this,y)}</span>
				</div>
			`).join("");return`
			<div class="viewer-card ${r?"active":"inactive"}">
				<div class="viewer-header">
					<span class="viewer-name">${d(this,L,ut).call(this,t)}</span>
					<span class="viewer-status ${r?"status-active":"status-inactive"}">
						${r?"üü¢":"‚ö´"}
					</span>
				</div>
				<div class="viewer-meta">
					<span class="viewer-tasks">üìù ${l} task${l!==1?"s":""}</span>
					<span class="viewer-time">‚è∞ ${a}</span>
				</div>
				${c?`<div class="viewer-info">${c}</div>`:""}
			</div>
		`},ns=function(e){const t=Math.floor((Date.now()-e)/1e3);return t<60?"just now":t<3600?`${Math.floor(t/60)}m ago`:t<86400?`${Math.floor(t/3600)}h ago`:`${Math.floor(t/86400)}d ago`},ut=function(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML},ht=function(){try{const e=Array.from(o(this,P).entries());localStorage.setItem(o(this,Ne),JSON.stringify(e))}catch(e){console.error("Failed to save viewer data:",e)}},is=function(){try{const e=localStorage.getItem(o(this,Ne));if(e){const t=JSON.parse(e);m(this,P,new Map(t))}}catch(e){console.error("Failed to load viewer data:",e),m(this,P,new Map)}},rs=function(){const e=o(this,D).querySelector(".info-list-primary"),t=o(this,D).querySelector(".info-list-secondary");if(e)if(o(this,P).size>5&&!o(this,Ae)){const s=e.scrollHeight;t.style.display="flex",d(this,L,as).call(this,s)}else t.style.display="none",d(this,L,Pt).call(this)},as=function(e){const t=o(this,D).querySelector(".info-list-primary"),s=o(this,D).querySelector(".info-list-secondary");if(!t||!s)return;const l=e+12,r=l/o(this,it)*1e3,a=[{transform:"translateY(0)"},{transform:`translateY(-${l}px)`}],c={duration:r,iterations:1/0,easing:"linear"};t.animate(a,c),s.animate(a,c),m(this,Ae,!0);const u=o(this,D).querySelector(".info-content");u&&u.classList.add("scrolling")},Pt=function(){const e=o(this,D).querySelector(".info-list-primary"),t=o(this,D).querySelector(".info-list-secondary");e&&e.getAnimations().forEach(n=>n.cancel()),t&&t.getAnimations().forEach(n=>n.cancel()),m(this,Ae,!1);const s=o(this,D).querySelector(".info-content");s&&s.classList.remove("scrolling")};const zt={timer:{id:"timer-container",defaultDisplay:"flex"},taskList:{id:"task-list-container",defaultDisplay:"block"},backlog:{id:"backlog-container",defaultDisplay:"block"},infoPanel:{id:"info-panel-container",defaultDisplay:"block"}},_s=30;class Ns{constructor(e){g(this,w);g(this,Se,{compact:{name:"Compact",description:"Timer and tasks in a tight side-by-side layout",container:{padding:40},components:{timer:{enabled:!0,display:"flex",position:{top:120,left:80},size:{width:320,height:320,minWidth:280}},taskList:{enabled:!0,position:{top:100,left:460},size:{width:700,minWidth:520,minHeight:420}},backlog:{enabled:!1},infoPanel:{enabled:!1}}},split:{name:"Split View",description:"Timer left, tasks center, backlog right",container:{padding:40},components:{timer:{enabled:!0,display:"flex",position:{top:120,left:80},size:{width:320,height:320}},taskList:{enabled:!0,position:{top:100,left:440},size:{width:320,minHeight:480}},backlog:{enabled:!0,position:{top:100,left:800},size:{width:320,minHeight:420}},infoPanel:{enabled:!1}}},fullOverlay:{name:"Full Overlay",description:"Balanced dashboard with all panels visible",container:{padding:32},components:{timer:{enabled:!0,display:"flex",position:{top:60,left:780},size:{width:360,height:360}},taskList:{enabled:!0,position:{top:460,left:540},size:{width:280,minHeight:420}},backlog:{enabled:!0,position:{top:460,left:220},size:{width:280,minHeight:420}},infoPanel:{enabled:!0,position:{top:460,left:860},size:{width:280,minHeight:420}}}},minimal:{name:"Minimal",description:"Single timer focus for clean scenes",container:{padding:60},components:{timer:{enabled:!0,display:"flex",position:{top:320,left:820},size:{width:320,height:320}},taskList:{enabled:!1},backlog:{enabled:!1},infoPanel:{enabled:!1}}},timerWithTasks:{name:"Timer + Tasks",description:"Timer stacked above active tasks",container:{padding:40},components:{timer:{enabled:!0,display:"flex",position:{top:100,left:760},size:{width:360,height:360}},taskList:{enabled:!0,position:{top:520,left:700},size:{width:520,minHeight:420}},backlog:{enabled:!1},infoPanel:{enabled:!1}}},dashboard:{name:"Productivity Dashboard",description:"Comprehensive layout for work and study streams",container:{padding:36},components:{timer:{enabled:!0,display:"flex",position:{top:80,left:80},size:{width:320,height:320}},taskList:{enabled:!0,position:{top:80,left:460},size:{width:360,minHeight:480}},backlog:{enabled:!0,position:{top:620,left:80},size:{width:360,minHeight:360}},infoPanel:{enabled:!0,position:{top:620,left:480},size:{width:360,minHeight:360}}}}});g(this,me,"compact");g(this,te);g(this,V,{});g(this,G,{});g(this,Ye,"enhancedOverlay.panelPositions.v2");g(this,je,"enhancedOverlay.panelSizes.v1");if(m(this,te,document.getElementById(e)),!o(this,te)){console.error(`Layout container "${e}" not found`);return}m(this,V,d(this,w,gs).call(this)),m(this,G,d(this,w,ys).call(this));const t=localStorage.getItem("currentLayout")||"compact";this.applyLayout(t)}applyLayout(e){if(!o(this,Se)[e])return console.error(`Layout "${e}" not found`),!1;m(this,me,e);const t=o(this,Se)[e];return localStorage.setItem("currentLayout",e),o(this,te).dataset.layout=e,d(this,w,ls).call(this),d(this,w,cs).call(this,t.container),d(this,w,ds).call(this,e,t.components),window.dispatchEvent(new CustomEvent("layoutChanged",{detail:{layoutName:e,layout:t}})),!0}savePanelPosition(e,t,s){o(this,V)[e]||(o(this,V)[e]={});const n=d(this,w,mt).call(this,s);o(this,V)[e][t]={left:Math.round(n.left),top:Math.round(n.top)},d(this,w,ft).call(this)}savePanelSize(e,t,s){o(this,G)[e]||(o(this,G)[e]={}),o(this,G)[e][t]={width:Math.round(s.width),height:Math.round(s.height)},d(this,w,pt).call(this)}resetPanelPosition(e,t=o(this,me)){var s;return o(this,V)[t]?e?o(this,V)[t][e]?(delete o(this,V)[t][e],(s=o(this,G)[t])!=null&&s[e]&&(delete o(this,G)[t][e],d(this,w,pt).call(this)),d(this,w,ft).call(this),this.applyLayout(t),!0):!1:(delete o(this,V)[t],delete o(this,G)[t],d(this,w,ft).call(this),d(this,w,pt).call(this),this.applyLayout(t),!0):!1}resetLayoutPositions(e){return this.resetPanelPosition(void 0,e)}getAvailableLayouts(){return Object.entries(o(this,Se)).map(([e,t])=>({name:e,displayName:t.name,description:t.description}))}getCurrentLayout(){return o(this,me)}getDefaultPosition(e,t){var n,l;const s=o(this,Se)[e];return((l=(n=s==null?void 0:s.components)==null?void 0:n[t])==null?void 0:l.position)??null}createLayoutSelector(){const e=document.createElement("div");return e.className="layout-selector glass-effect",e.innerHTML=`
			<div class="layout-selector-header">
				<h4>Layout Presets</h4>
				<button class="layout-close-btn">√ó</button>
			</div>
			<div class="layout-options">
				${this.getAvailableLayouts().map(t=>`
					<button 
						class="layout-option ${t.name===o(this,me)?"active":""}"
						data-layout="${t.name}"
					>
						<div class="layout-option-name">${t.displayName}</div>
						<div class="layout-option-desc">${t.description}</div>
					</button>
				`).join("")}
			</div>
		`,e.querySelectorAll(".layout-option").forEach(t=>{t.addEventListener("click",()=>{const s=t,n=s.dataset.layout;this.applyLayout(n),e.querySelectorAll(".layout-option").forEach(l=>l.classList.remove("active")),s.classList.add("active")})}),e.querySelector(".layout-close-btn").addEventListener("click",()=>{e.remove()}),e}convertToBasePosition(e){return d(this,w,mt).call(this,e)}refreshLayout(){this.applyLayout(o(this,me))}}Se=new WeakMap,me=new WeakMap,te=new WeakMap,V=new WeakMap,G=new WeakMap,Ye=new WeakMap,je=new WeakMap,w=new WeakSet,ls=function(){const e=o(this,te).style;e.display="block",e.gridTemplateColumns="",e.gridTemplateRows="",e.justifyContent="",e.alignItems="",e.maxWidth="",e.height="",e.gap="",e.position="fixed",e.top="0",e.left="0",e.width="100%",e.height="100%",e.padding=`${_s}px`,e.boxSizing="border-box",e.overflow="visible"},cs=function(e={}){if(!e)return;const t=o(this,te).style;typeof e.padding=="number"&&(t.padding=`${e.padding}px`)},ds=function(e,t){const{scaleX:s,scaleY:n}=d(this,w,Mt).call(this),l=o(this,te).getBoundingClientRect();Object.values(zt).forEach(({id:r})=>{const a=document.getElementById(r);a&&(a.style.display="none",a.removeAttribute("aria-hidden"))}),Object.entries(t).forEach(([r,a])=>{const c=zt[r];if(!c)return;const u=document.getElementById(c.id);if(!u)return;if(!(a!=null&&a.enabled)){u.style.display="none",u.setAttribute("aria-hidden","true");return}u.style.display=a.display||c.defaultDisplay,u.classList.add("draggable-panel"),u.style.position="absolute",u.style.zIndex=a.zIndex??10,u.dataset.panel=r,u.style.transform="none",console.log(`Setting up panel ${r}:`,{display:u.style.display,position:u.style.position,left:u.style.left,top:u.style.top,class:u.className}),d(this,w,us).call(this,u,a.size,r,e);const h=d(this,w,hs).call(this,e,r)??a.position;if(h){const p=d(this,w,fs).call(this,h,s,n),k=d(this,w,ps).call(this,p,u,l);u.style.left=`${Math.round(k.left)}px`,u.style.top=`${Math.round(k.top)}px`;const f=d(this,w,mt).call(this,k);u.dataset.baseLeft=`${f.left}`,u.dataset.baseTop=`${f.top}`}})},us=function(e,t={},s=null,n=null){const l=n&&s?d(this,w,ms).call(this,n,s):null,r=l?{...t,...l}:t;["width","height","minWidth","minHeight","maxWidth","maxHeight"].forEach(c=>{r[c]!==void 0?e.style[c]=`${r[c]}px`:e.style[c]=""})},hs=function(e,t){var s;return((s=o(this,V)[e])==null?void 0:s[t])??null},ms=function(e,t){var s;return((s=o(this,G)[e])==null?void 0:s[t])??null},Mt=function(){if(!o(this,te))return{scaleX:1,scaleY:1};const e=1,t=1;return console.log("Using 1:1 scale for 1920x1080 resolution"),{scaleX:e,scaleY:t}},fs=function(e,t,s){return{left:e.left*t,top:e.top*s}},ps=function(e,t,s){const n=t.getBoundingClientRect(),l=n.width||t.offsetWidth||0,r=n.height||t.offsetHeight||0,a=Math.max(0,s.width-l),c=Math.max(0,s.height-r);return{left:Math.max(0,Math.min(a,e.left)),top:Math.max(0,Math.min(c,e.top))}},mt=function(e){const{scaleX:t,scaleY:s}=d(this,w,Mt).call(this);return{left:e.left/t,top:e.top/s}},gs=function(){try{const e=localStorage.getItem(o(this,Ye));return e?JSON.parse(e):{}}catch(e){return console.warn("Failed to load saved panel positions",e),{}}},ft=function(){try{localStorage.setItem(o(this,Ye),JSON.stringify(o(this,V)))}catch(e){console.warn("Failed to persist panel positions",e)}},ys=function(){try{const e=localStorage.getItem(o(this,je));return e?JSON.parse(e):{}}catch(e){return console.warn("Failed to load saved panel sizes",e),{}}},pt=function(){try{localStorage.setItem(o(this,je),JSON.stringify(o(this,G)))}catch(e){console.warn("Failed to persist panel sizes",e)}};const{twitch_channel:Ys,twitch_oauth:js,twitch_username:Ks}=_authConfig,Vs="wss://irc-ws.chat.twitch.tv:443",ee=new zs(Vs,{username:Ks,authToken:js,channel:Ys});let ze,ge,ae,ye,qe,$;const $e=new Map;let Q=null,Ce=!1,Xe=!1;const Ue=new Map;window.addEventListener("load",()=>{let i="userList";_settings.testMode&&(console.log("Test mode enabled"),i="testUserList"),ze=new $s(i),ze.render(),ge=new Fs,ae=new Rs("timer-container"),ye=new Hs("backlog-container"),qe=new Bs("info-panel-container"),$=new Ns("app"),setTimeout(()=>{vt(),setTimeout(()=>vt(),200)},100),Gs(),ee.on("command",e=>{var u;const{user:t,command:s,message:n,flags:l,extra:r}=e,a=Xs(t,s,n,l);if(a){a.error?console.error(a.message):ee.say(a.message,r.messageId);return}const c=ze.chatHandler(t,s,n,l,r);if(c.error)console.error(c.message);else{ee.say(c.message,r.messageId);const y=((u=ze.userList.getUser(t))==null?void 0:u.getTasks().length)||0;qe.updateViewerActivity(t,y)}}),ee.on("oauthError",()=>{Es()}),ee.on("oauthSuccess",()=>{xs()}),ee.connect(),_settings.testMode&&Us(ee)});function Xs(i,e,t,s,n){var y;const l=`!${e.toLowerCase()}`,r=s.broadcaster||s.mod,a=_settings.botResponsePrefix,c=(t||"").trim(),u=h=>{if(!h)return null;const p=h.toLowerCase(),k=p.replace(/[^a-z0-9]/g,""),f=$.getAvailableLayouts();for(const v of f){const z=v.name.toLowerCase(),A=z.replace(/[^a-z0-9]/g,""),B=v.displayName.toLowerCase(),R=B.replace(/[^a-z0-9]/g,"");if(z===p||A===k||B===p||R===k)return v.name}return null};if(l==="!theme"){if(!r)return{message:`${a}@${i} Only moderators can change themes.`,error:!0};if(!c){const k=ge.getAvailableThemes().map(f=>f.name).join(", ");return{message:`${a}Available themes: ${k}. Use !theme [name] to switch.`,error:!1}}const h=c.toLowerCase(),p=ge.applyTheme(h);return{message:p?`${a}Theme changed to ${c}! üé®`:`${a}Theme "${c}" not found.`,error:!p}}if(l==="!layout"){if(!r)return{message:`${a}@${i} Only moderators can change layouts.`,error:!0};if(!c){const f=$.getAvailableLayouts().map(v=>`${v.name} (${v.description})`).join(", ");return{message:`${a}Available layouts: ${f}. Use !layout [name] to switch.`,error:!1}}const h=u(c);if(!h)return{message:`${a}Layout "${c}" not found.`,error:!0};const p=$.applyLayout(h),k=$.getAvailableLayouts().find(f=>f.name===h);return{message:p?`${a}Layout changed to ${(k==null?void 0:k.displayName)||h}! üìê`:`${a}Layout "${c}" not found.`,error:!p}}if(l==="!resetpanel"){if(!r)return{message:`${a}@${i} Only moderators can reset panel positions.`,error:!0};if(!c)return{message:`${a}Usage: !resetpanel [timer|tasklist|backlog|infopanel] (optional layout)`,error:!1};const[h,p]=c.split(/\s+/),k=h==null?void 0:h.toLowerCase();if(!k||!["timer","tasklist","backlog","infopanel"].includes(k))return{message:`${a}Panel must be one of: timer, tasklist, backlog, infopanel.`,error:!0};const v=k==="tasklist"?"taskList":k==="infopanel"?"infoPanel":k,z=p?u(p):$.getCurrentLayout();if(!z)return{message:`${a}Layout "${p}" not found.`,error:!0};const A=$.getAvailableLayouts().find(N=>N.name===z),B=(A==null?void 0:A.displayName)||z,R=$.resetPanelPosition(v,z);return{message:R?`${a}Reset ${k} panel position for ${B}.`:`${a}No custom position stored for ${k} in ${B}.`,error:!R}}if(l==="!resetlayout"){if(!r)return{message:`${a}@${i} Only moderators can reset layouts.`,error:!0};const h=c?u(c):$.getCurrentLayout();if(!h)return{message:`${a}Layout "${c}" not found.`,error:!0};const p=$.getAvailableLayouts().find(v=>v.name===h),k=(p==null?void 0:p.displayName)||h,f=$.resetLayoutPositions(h);return{message:f?`${a}Reset all panel positions for ${k}.`:`${a}No custom positions stored for ${k}.`,error:!f}}if(l==="!backlog"){const h=c.length?c.split(/\s+/):[],p=(y=h[0])==null?void 0:y.toLowerCase(),k=h.slice(1).join(" ");if(!p)return{message:`${a}@${i} Usage: !backlog add/done/remove [text/number]`,error:!1};if(p==="add"){if(!k)return{message:`${a}@${i} Provide a task description to add.`,error:!0};const f=ye.addItem(k,i);return{message:f?`${a}@${i} Added "${k}" to backlog! üìã`:`${a}@${i} Backlog is full!`,error:!f}}if(p==="done"||p==="remove"){const f=parseInt(k,10);if(!k||Number.isNaN(f)||f<1)return{message:`${a}@${i} Provide a valid backlog item number.`,error:!0};const v=ye.getItemByIndex(f);return v?p==="done"?(ye.toggleComplete(v.id),{message:`${a}@${i} Marked backlog item ${f} as done! ‚úÖ`,error:!1}):(ye.removeItem(v.id),{message:`${a}@${i} Removed backlog item ${f}! üóëÔ∏è`,error:!1}):{message:`${a}@${i} Backlog item ${f} not found.`,error:!0}}if(p==="clear"){if(!r)return{message:`${a}@${i} Only moderators can clear the backlog.`,error:!0};const f=ye.clearCompleted();return{message:`${a}Cleared ${f} completed backlog item${f!==1?"s":""}!`,error:!1}}return{message:`${a}@${i} Usage: !backlog add/done/remove [text/number]`,error:!1}}if(l==="!setinfo"){const h=c.split(/\s+/);if(h.length<2)return{message:`${a}@${i} Usage: !setinfo [field] [value] (e.g., !setinfo goal Graduate)`,error:!1};const p=h[0],k=c.slice(p.length).trim();return k?(qe.setViewerInfo(i,p,k),{message:`${a}@${i} Set ${p} to "${k}"! üìù`,error:!1}):{message:`${a}@${i} Provide a value for ${p}.`,error:!0}}if(l==="!getinfo"){const h=c||i,p=qe.getViewerInfo(h);if(!p||Object.keys(p.info).length===0)return{message:`${a}@${i} No info found for ${h}.`,error:!1};const k=Object.entries(p.info).map(([f,v])=>`${f}: ${v}`).join(", ");return{message:`${a}@${i} ${h}'s info: ${k}`,error:!1}}if(l==="!pomopause")return r?(ae.pause(),{message:`${a}Timer paused! ‚è∏Ô∏è`,error:!1}):{message:`${a}@${i} Only moderators can control the timer.`,error:!0};if(l==="!pomoresume")return r?(ae.resume(),{message:`${a}Timer resumed! ‚ñ∂Ô∏è`,error:!1}):{message:`${a}@${i} Only moderators can control the timer.`,error:!0};if(l==="!pomostop"||l==="!stoptimer")return r?(ae.stop(),{message:`${a}Timer stopped! ‚èπÔ∏è`,error:!1}):{message:`${a}@${i} Only moderators can control the timer.`,error:!0};if(l==="!pomoreset")return r?(ae.reset(),{message:`${a}Timer reset! All sessions cleared. üîÑ`,error:!1}):{message:`${a}@${i} Only moderators can control the timer.`,error:!0};if(l==="!pomostatus"){const h=ae.getState(),p=Math.floor(h.currentSeconds/60),k=h.currentSeconds%60,f=`${p}:${k.toString().padStart(2,"0")}`,v=h.isRunning?"Running":h.isPaused?"Paused":"Stopped";return{message:`${a}Timer: ${v} | ${h.mode} mode | ${f} | Session ${h.currentSession}/${h.totalSessions} üìä`,error:!1}}if(l==="!pomo"||l==="!pomodoro"){if(!r)return{message:`${a}@${i} Only moderators can control the timer.`,error:!0};const h=c.split("/"),p=Math.max(1,parseInt(h[0],10)||25),k=Math.max(1,parseInt(h[1],10)||5),f=Math.max(1,Math.min(12,parseInt(h[2],10)||4));return ae.startCycle(p,k,f,(v,z,A)=>{v==="focus"?ee.say(`${a}Focus session ${z} complete! Time for a break ‚òï`):v==="break"||v==="longbreak"?ee.say(`${a}Break over! Starting session ${z+1}/${A} üí™`):v==="cycle_complete"&&ee.say(`${a}Pomodoro cycle complete! ${A} sessions done! üéâ`)}),{message:`${a}Pomodoro started: ${p}m focus / ${k}m break √ó ${f} sessions ‚è±Ô∏è`,error:!1}}return null}function kt(i,e,t={}){const{strategy:s="transform",bounds:n=null,onDragStart:l,onDragEnd:r}=t,a=e||i;let c=!1,u=0,y=0,h=0,p=0,k=0,f=0,v=0,z=0,A={left:i.offsetLeft||0,top:i.offsetTop||0};const B=typeof n=="string"?document.querySelector(n):n;a.style.cursor="move",a.style.touchAction="none",console.log("Making draggable:",{element:i,dragHandle:a,strategy:s,bounds:n});const R=E=>{if(E.type==="mousedown"&&E.button!==0)return;E.preventDefault(),c=!0,i.classList.add("dragging"),document.body.classList.add("overlay-dragging");const fe=E.type.includes("touch")?E.touches[0].clientX:E.clientX,se=E.type.includes("touch")?E.touches[0].clientY:E.clientY;if(s==="absolute"){const Z=i.getBoundingClientRect(),pe=B?B.getBoundingClientRect():{left:0,top:0};v=fe-Z.left,z=se-Z.top,k=Z.left-pe.left,f=Z.top-pe.top,A={left:k,top:f}}else{const Z=window.getComputedStyle(i),pe=new DOMMatrix(Z.transform);k=pe.m41,f=pe.m42,h=fe-k,p=se-f}l==null||l()},N=E=>{if(!c)return;E.preventDefault();const fe=E.type.includes("touch")?E.touches[0].clientX:E.clientX,se=E.type.includes("touch")?E.touches[0].clientY:E.clientY;if(s==="absolute"){const Z=B?B.getBoundingClientRect():{left:0,top:0,width:window.innerWidth,height:window.innerHeight},pe=i.getBoundingClientRect();let rt=fe-Z.left-v,at=se-Z.top-z;const oo=Math.max(0,Z.width-pe.width),no=Math.max(0,Z.height-pe.height);rt=Math.max(0,Math.min(oo,rt)),at=Math.max(0,Math.min(no,at)),i.style.left=`${Math.round(rt)}px`,i.style.top=`${Math.round(at)}px`,A={left:rt,top:at}}else u=fe-h,y=se-p,k=u,f=y,i.style.transform=`translate(${u}px, ${y}px)`},J=()=>{c&&(c=!1,i.classList.remove("dragging"),document.body.classList.remove("overlay-dragging"),s!=="absolute"&&(h=u,p=y),r==null||r({left:Math.round(A.left),top:Math.round(A.top)}))};return a.addEventListener("mousedown",R),document.addEventListener("mousemove",N),document.addEventListener("mouseup",J),a.addEventListener("touchstart",R,{passive:!1}),document.addEventListener("touchmove",N,{passive:!1}),document.addEventListener("touchend",J),()=>{a.removeEventListener("mousedown",R),document.removeEventListener("mousemove",N),document.removeEventListener("mouseup",J),a.removeEventListener("touchstart",R),document.removeEventListener("touchmove",N),document.removeEventListener("touchend",J),i.classList.remove("dragging"),document.body.classList.remove("overlay-dragging")}}function vt(){if(!$)return;const i=document.getElementById("app");if(!i)return;console.log("Setting up panel draggables...");const e=new Set,t=i.querySelectorAll(".draggable-panel");console.log(`Found ${t.length} draggable panels`),t.forEach(n=>{var u;const l=n,r=l.dataset.panel;if(console.log(`Processing panel: ${r}`,l),!r||(e.add(r),$e.has(r)&&((u=$e.get(r))==null||u(),$e.delete(r)),getComputedStyle(l).display==="none"))return;const c=kt(l,l,{strategy:"absolute",bounds:i,onDragEnd:y=>{$.savePanelPosition($.getCurrentLayout(),r,y)}});l.addEventListener("click",y=>{const h=y.target;h.tagName==="BUTTON"||h.tagName==="INPUT"||qt(l,r)}),$e.set(r,c),console.log(`Draggable setup complete for panel: ${r}`)});const s=[];$e.forEach((n,l)=>{e.has(l)||(n(),s.push(l))}),s.forEach(n=>$e.delete(n))}window.addEventListener("layoutChanged",()=>{setTimeout(()=>vt(),50)});let We=null;window.addEventListener("resize",()=>{$&&(We&&cancelAnimationFrame(We),We=requestAnimationFrame(()=>{We=null,$.refreshLayout()}))});function Ws(){const i=document.createElement("div");i.className="theme-menu";const e=ge.getCurrentTheme(),t=ge.getAvailableThemes();return i.innerHTML=`
		<div class="theme-menu-header" title="Drag to move">
			<span>üé® Themes</span>
			<span class="drag-hint">‚ãÆ‚ãÆ</span>
		</div>
		<div class="theme-list">
			${t.map(s=>`
				<button 
					class="theme-item ${s.name===e?"active":""}"
					data-theme="${s.name}"
				>
					${s.displayName}
				</button>
			`).join("")}
		</div>
	`,i.querySelectorAll(".theme-item").forEach(s=>{s.addEventListener("click",()=>{const n=s.getAttribute("data-theme");ge.applyTheme(n),i.querySelectorAll(".theme-item").forEach(l=>l.classList.remove("active")),s.classList.add("active")})}),i}function Gs(){document.addEventListener("DOMContentLoaded",()=>{document.body.focus(),document.body.setAttribute("tabindex","0")}),document.addEventListener("click",()=>{document.body.focus()});const i=e=>{if(console.log("Key pressed:",e.key,"Alt:",e.altKey,"Ctrl:",e.ctrlKey,"Shift:",e.shiftKey),(e.key==="+"||e.key==="="||e.key==="Add")&&!e.altKey&&!e.ctrlKey&&!e.shiftKey&&Q){e.preventDefault(),e.stopPropagation(),bt(1.1);return}if((e.key==="-"||e.key==="_"||e.key==="Subtract")&&!e.altKey&&!e.ctrlKey&&!e.shiftKey&&Q){e.preventDefault(),e.stopPropagation(),bt(.9);return}if(e.altKey&&!e.ctrlKey&&!e.shiftKey&&e.key.toLowerCase()==="l"){e.preventDefault(),e.stopPropagation(),Js();return}if(e.altKey&&!e.ctrlKey&&!e.shiftKey&&e.key.toLowerCase()==="g"){e.preventDefault(),e.stopPropagation(),Qs();return}if(e.altKey&&!e.ctrlKey&&!e.shiftKey&&e.key.toLowerCase()==="t"){e.preventDefault(),e.stopPropagation();const t=document.querySelector(".theme-menu");if(t){t.remove();return}const s=Ws();document.body.appendChild(s);const n=s.querySelector(".theme-menu-header");kt(s,n,{strategy:"absolute"});return}if(e.key==="Escape"){if(e.preventDefault(),e.stopPropagation(),Ce){Ut();return}if(Q){Ge();return}const t=document.querySelector(".theme-menu");if(t){t.remove();return}const s=document.querySelector(".layout-selector");if(s){s.remove();return}}};document.addEventListener("keydown",i,!0),window.addEventListener("keydown",i,!0)}function Js(){const i=document.querySelector(".layout-selector");if(i){i.remove();return}const e=$.createLayoutSelector();document.body.appendChild(e);const t=e.querySelector(".layout-selector-header");t&&kt(e,t,{strategy:"absolute"})}function qt(i,e){Ge(),Q={element:i,key:e},i.classList.add("panel-selected"),console.log(`Panel selected: ${e}`)}function Ge(){Q&&(Q.element.classList.remove("panel-selected"),Q=null,console.log("Panel deselected"))}function bt(i){if(!Q||!$)return;const{element:e,key:t}=Q,s=e.getBoundingClientRect(),n=document.getElementById("app");if(!n)return;const l=n.getBoundingClientRect(),r=s.width,a=s.height,c=Math.round(r*i),u=Math.round(a*i),y=s.left-l.left,h=s.top-l.top,p=y+r/2,k=h+a/2;let f=p-c/2,v=k-u/2;const z=Math.max(0,l.width-c),A=Math.max(0,l.height-u);f=Math.max(0,Math.min(z,f)),v=Math.max(0,Math.min(A,v)),e.style.width=`${c}px`,e.style.height=`${u}px`,e.style.left=`${Math.round(f)}px`,e.style.top=`${Math.round(v)}px`;const B=$.getCurrentLayout();$.savePanelSize(B,t,{width:c,height:u}),$.savePanelPosition(B,t,{left:f,top:v}),console.log(`Resized ${t}: ${r}x${a} -> ${c}x${u}`)}function Qs(){Ce?Ut():Zs()}function Zs(){if(Ce)return;Ce=!0;const i=document.createElement("div");i.id="grid-overlay",i.className="grid-overlay",document.body.appendChild(i),eo(),console.log("Grid overlay shown")}function Ut(){if(!Ce)return;Ce=!1;const i=document.getElementById("grid-overlay");i&&i.remove(),to(),console.log("Grid overlay hidden")}function eo(){if(Xe)return;Xe=!0,document.querySelectorAll(".draggable-panel").forEach(e=>{const t=e,s=t.dataset.panel;if(!s)return;[{name:"nw",cursor:"nwse-resize",position:"top-left"},{name:"n",cursor:"ns-resize",position:"top-center"},{name:"ne",cursor:"nesw-resize",position:"top-right"},{name:"e",cursor:"ew-resize",position:"middle-right"},{name:"se",cursor:"nwse-resize",position:"bottom-right"},{name:"s",cursor:"ns-resize",position:"bottom-center"},{name:"sw",cursor:"nesw-resize",position:"bottom-left"},{name:"w",cursor:"ew-resize",position:"middle-left"}].forEach(({name:l,cursor:r,position:a})=>{const c=document.createElement("div");c.className=`resize-handle resize-handle-${l}`,c.dataset.direction=l,c.style.cursor=r,t.appendChild(c);const u=so(t,c,l,s);Ue.has(s)||Ue.set(s,[]),Ue.get(s).push(u)})}),console.log("Resize handles added to all panels")}function to(){if(!Xe)return;Xe=!1,Ue.forEach(e=>{e.forEach(t=>t())}),Ue.clear(),document.querySelectorAll(".resize-handle").forEach(e=>e.remove()),console.log("Resize handles removed from all panels")}function so(i,e,t,s){let n=!1,l=0,r=0,a=0,c=0,u=0,y=0;const h=f=>{if(f.type==="mousedown"&&f.button!==0)return;f.preventDefault(),f.stopPropagation(),n=!0;const v=f.type.includes("touch")?f.touches[0].clientX:f.clientX,z=f.type.includes("touch")?f.touches[0].clientY:f.clientY;l=v,r=z;const A=i.getBoundingClientRect();a=A.width,c=A.height,u=i.offsetLeft,y=i.offsetTop,i.classList.add("resizing"),document.body.classList.add("overlay-resizing")},p=f=>{if(!n)return;f.preventDefault();const v=f.type.includes("touch")?f.touches[0].clientX:f.clientX,z=f.type.includes("touch")?f.touches[0].clientY:f.clientY,A=v-l,B=z-r;let R=a,N=c,J=u,E=y;t.includes("e")&&(R=Math.max(100,a+A)),t.includes("w")&&(R=Math.max(100,a-A),J=u+(a-R)),t.includes("s")&&(N=Math.max(100,c+B)),t.includes("n")&&(N=Math.max(100,c-B),E=y+(c-N));const fe=document.getElementById("app");if(fe){const se=fe.getBoundingClientRect();J<0&&(R+=J,J=0),E<0&&(N+=E,E=0),J+R>se.width&&(R=se.width-J),E+N>se.height&&(N=se.height-E)}i.style.width=`${Math.round(R)}px`,i.style.height=`${Math.round(N)}px`,i.style.left=`${Math.round(J)}px`,i.style.top=`${Math.round(E)}px`},k=()=>{if(n&&(n=!1,i.classList.remove("resizing"),document.body.classList.remove("overlay-resizing"),$)){const f=$.getCurrentLayout(),v=i.getBoundingClientRect();$.savePanelSize(f,s,{width:Math.round(v.width),height:Math.round(v.height)}),$.savePanelPosition(f,s,{left:Math.round(i.offsetLeft),top:Math.round(i.offsetTop)}),console.log(`Panel ${s} resized: ${Math.round(v.width)}x${Math.round(v.height)}`)}};return e.addEventListener("mousedown",h),document.addEventListener("mousemove",p),document.addEventListener("mouseup",k),e.addEventListener("touchstart",h,{passive:!1}),document.addEventListener("touchmove",p,{passive:!1}),document.addEventListener("touchend",k),()=>{e.removeEventListener("mousedown",h),document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",k),e.removeEventListener("touchstart",h),document.removeEventListener("touchmove",p),document.removeEventListener("touchend",k)}}document.addEventListener("click",i=>{if(!Q)return;const e=i.target;if(!Q.element.contains(e)){if(e.closest(".theme-menu")||e.closest(".layout-selector"))return;Ge()}}),typeof window<"u"&&(window.debugOverlay={app:ze,themeManager:ge,circularTimer:ae,backlogPanel:ye,infoPanel:qe,layoutManager:$,selectPanel:qt,deselectPanel:Ge,resizeSelectedPanel:bt})})();

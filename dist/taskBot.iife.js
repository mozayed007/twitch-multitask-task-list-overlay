var $t=L=>{throw TypeError(L)};var dt=(L,I,O)=>I.has(L)||$t("Cannot "+O);var s=(L,I,O)=>(dt(L,I,"read from private field"),O?O.call(L):I.get(L)),m=(L,I,O)=>I.has(L)?$t("Cannot add the same private member more than once"):I instanceof WeakSet?I.add(L):I.set(L,O),h=(L,I,O,ve)=>(dt(L,I,"write to private field"),ve?ve.call(L,O):I.set(L,O),O),d=(L,I,O)=>(dt(L,I,"access private method"),O);var ht=(L,I,O,ve)=>({set _(Ge){h(L,I,Ge,O)},get _(){return s(L,I,ve)}});(function(){"use strict";var je,Lt,fe,_,Ct,ee,ie,x,Oe,ne,De,Ve,D,ae,le,Le,Ce,ce,wt,Et,xt,C,we,Y,Ue,ge,Ae,F,q,U,j,Z,V,H,N,ye,ke,We,Ye,Ee,k,Pt,ut,It,te,tt,_e,He,Mt,Ot,Ne,Dt,w,Je,E,Fe,Ke,xe,ct,Pe,Xe,S,Ut,At,st,mt,Ft,qt,Rt,Bt,pt,Ie,_t,be,de,X,z,W,qe,Re,T,Ht,Nt,zt,Gt,jt,Vt,ft,Wt,Yt,rt,Jt,ot,Kt,it,he,P,Be,R,gt,yt,ze,Xt;let L,I,O=!1;const ve=getComputedStyle(document.documentElement).getPropertyValue("--card-gap-between").slice(0,-2);function Ge(){const e=document.querySelector(".task-wrapper").clientHeight,t=document.querySelector(".task-container.primary"),r=t.scrollHeight,o=document.querySelector(".task-container.secondary");if(r>e&&!O){o.style.display="block";const a=_settings.scrollSpeed.toString();let l=parseInt(a,10),i=r+parseInt(ve,10)*2,u={duration:i/l*1e3,iterations:1,easing:"linear"},b=[{transform:"translateY(0)"},{transform:`translateY(-${i}px)`}],v=[{transform:"translateY(0)"},{transform:`translateY(-${i}px)`}];L=t.animate(b,u),I=o.animate(v,u),O=!0,Zt()}else r<=e&&(o.style.display="none",Qt())}function Qt(){L&&L.cancel(),I&&I.cancel(),O=!1}function Zt(){L&&(L.addEventListener("finish",kt),L.addEventListener("cancel",kt))}function kt(){O=!1,Ge()}function nt(n,e){if(n.innerText===e)return;const t=n.animate([{opacity:1},{opacity:0}],{duration:350,fill:"forwards",easing:"ease-out"});t.onfinish=()=>{n.textContent=e,n.animate([{opacity:0},{opacity:1}],{duration:350,fill:"forwards",easing:"ease-in"})}}function es(n){const e=document.querySelector(":root");for(let[t,r]of Object.entries(n))t.includes("FontFamily")&&ts(r),e.style.setProperty(ss(t),r)}function ts(n){window.WebFont.load({google:{families:[`${n}:100,400,700`]}})}function ss(n){return`--${n.replace(/([A-Z])/g,"-$1").toLowerCase()}`}class bt{constructor(e,t){this.username=this.validateUsername(e),this.userColor=(t==null?void 0:t.userColor)||"",this.tasks=[]}validateUsername(e){if(typeof e!="string")throw new Error("Username must be of type string");if(e=e.trim(),e.length===0)throw new Error("Username invalid");return e}addTask(e){return this.tasks.push(e),e}editTask(e,t){let r=this.getTask(e);return r?(r.setDescription(t),r):null}completeTask(e){let t=this.getTask(e);return t?(t.setCompletionStatus(!0),t):null}setFocusedTask(e){let t=this.getTask(e);return t?(this.tasks.forEach(r=>{r.setFocusStatus(!1)}),t.setFocusStatus(!0),t):null}deleteTask(e){const t=[].concat(e).filter(o=>this.validTaskIndex(o)),r=[];return this.tasks=this.tasks.filter((o,a)=>t.includes(a)?(r.push(o),!1):!0),r}removeCompletedTasks(){const e=[];return this.tasks=this.tasks.filter(t=>t.isComplete()?(e.push(t),!1):!0),e}getTask(e){return this.validTaskIndex(e)?this.tasks[e]:null}getTasks(){return this.tasks}validTaskIndex(e){return!(typeof e!="number"||isNaN(e)||e<0||e>=this.tasks.length)}}class Tt{constructor(e){m(this,je);this.description=this.validateDescription(e),this.id=d(this,je,Lt).call(this),this.completionStatus=!1,this.focusStatus=!1}validateDescription(e){if(typeof e!="string")throw new Error("Task description must be of type string");if(e=e.trim(),e.length===0)throw new Error("Task description invalid");return e}setDescription(e){this.description=this.validateDescription(e)}isComplete(){return this.completionStatus}setCompletionStatus(e){if(typeof e!="boolean")throw new Error("Completion status must be of type boolean");this.completionStatus=e,this.isFocused()&&this.isComplete()&&this.setFocusStatus(!1)}isFocused(){return this.focusStatus}setFocusStatus(e){if(typeof e!="boolean")throw new Error("Focus status must be of type boolean");this.focusStatus=e}}je=new WeakSet,Lt=function(){const e=new Date,t=String(e.getDate()).padStart(2,"0"),r=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0"),a=String(e.getSeconds()).padStart(2,"0"),l=String(e.getMilliseconds()).padStart(3,"0"),i=Math.floor(Math.random()*1e4);return`${t}${r}${o}${a}${l}${i}`};class rs{constructor(e="userList"){m(this,_);m(this,fe);h(this,fe,e),this.tasksCompleted=0,this.totalTasks=0,this.users=d(this,_,Ct).call(this)}getUser(e){return this.users.find(t=>t.username===e)}getAllUsers(){return this.users}createUser(e,t){if(this.getUser(e))throw new Error(`${e} already exists`);const r=new bt(e,t);return this.users.push(r),r}addUserTasks(e,t){const r=this.getUser(e);if(!r)throw new Error(`${e} does not exist`);const o=[].concat(t),a=[];return o.forEach(l=>{a.push(r.addTask(new Tt(l))),this.totalTasks++}),d(this,_,ee).call(this),a}editUserTask(e,t,r){const o=this.getUser(e);if(!o)throw new Error(`${e} has no tasks`);const a=o.editTask(t,r);if(!a)throw new Error(`Task ${t} not found`);return d(this,_,ee).call(this),a}focusUserTask(e,t){const r=this.getUser(e);if(!r)throw new Error(`User ${e} not found`);const o=r.setFocusedTask(t);if(!o)throw new Error(`Task ${t} not found`);return d(this,_,ee).call(this),o}completeUserTasks(e,t){const r=this.getUser(e);if(!r)throw new Error(`User ${e} not found`);const o=[].concat(t).reduce((a,l)=>{const i=r.getTask(l);return i&&(i.isComplete()||(i.setCompletionStatus(!0),this.tasksCompleted++),a.push(i)),a},[]);return d(this,_,ee).call(this),o}deleteUserTasks(e,t){const r=this.getUser(e);if(!r)throw new Error(`User ${e} not found`);const o=[].concat(t),a=r.deleteTask(o);return r.getTasks().length===0&&this.deleteUser(e),this.decreaseTaskCount(a),d(this,_,ee).call(this),a}checkUserTasks(e,t="incomplete"){const r=this.getUser(e);if(!r)return new Map;const o=new Map;return r.getTasks().forEach((a,l)=>{t==="incomplete"&&!a.isComplete()&&o.set(l,a),t==="complete"&&a.isComplete()&&o.set(l,a)}),o}clearUserList(){this.users=[],this.tasksCompleted=0,this.totalTasks=0,d(this,_,ee).call(this)}clearDoneTasks(){let e=[];for(let t=this.users.length-1;t>=0;t--){const r=this.users[t],o=r.removeCompletedTasks();e=e.concat(o),r.getTasks().length===0&&this.users.splice(t,1)}return this.decreaseTaskCount(e),d(this,_,ee).call(this),e}deleteUser(e){const t=this.users.findIndex(a=>RegExp(`^${e}`,"i").test(a.username));if(t===-1)throw new Error(`${e} not found`);const r=this.users[t],o=this.users.splice(t,1)[0];return this.decreaseTaskCount(o.getTasks()),d(this,_,ee).call(this),r}decreaseTaskCount(e){e.forEach(t=>{t.isComplete()&&this.tasksCompleted--,this.totalTasks--})}}fe=new WeakMap,_=new WeakSet,Ct=function(){const e=[];let t=localStorage.getItem(s(this,fe));return t?JSON.parse(t).forEach(r=>{const o=new bt(r.username,{userColor:r.userColor});r.tasks.map(a=>{const l=o.addTask(new Tt(a.description));this.totalTasks++,a.completionStatus&&(l.setCompletionStatus(a.completionStatus),this.tasksCompleted++),a.focusStatus&&l.setFocusStatus(a.focusStatus)}),e.push(o)}):localStorage.setItem(s(this,fe),JSON.stringify(e)),e},ee=function(){localStorage.setItem(s(this,fe),JSON.stringify(this.users))};const os=document.getElementById("audioSample");class is{constructor(e){m(this,ie,null);m(this,x);m(this,Oe);m(this,ne);m(this,De);m(this,Ve,null);this.userList=new rs(e),es(_styles),h(this,x,_settings.languageCode),h(this,Oe,_settings.maxTasksPerUser),h(this,ne,_settings.headerFeature),h(this,De,_settings.headerCustomText)}setBacklogPanel(e){h(this,Ve,e),e.setOnRefresh(()=>{this.renderTaskList()}),this.renderTaskList()}render(){this.renderTaskList(),this.renderTaskHeader()}renderTaskList(){const e=document.querySelector(".task-container.primary"),t=document.querySelector(".task-container.secondary"),r=document.querySelector(".streamer-tasks-container");if(this.userList.users.length===0){e&&(e.innerHTML=""),t&&(t.innerHTML=""),r&&(r.innerHTML=""),this.renderTaskCount();return}const o=document.createDocumentFragment();this.userList.getAllUsers().forEach(a=>{const l=as(a),i=l.querySelector("ol");a.tasks.forEach(c=>{const u=document.createElement("li");u.classList.add("task"),u.dataset.taskId=`${c.id}`,u.innerText=c.description,c.isComplete()&&u.classList.add("done"),c.isFocused()&&u.classList.add("focus"),i.appendChild(u)}),o.appendChild(l)}),e&&(e.innerHTML="",e.appendChild(o.cloneNode(!0))),t&&(t.innerHTML="",t.appendChild(o.cloneNode(!0))),r&&(r.innerHTML="",r.appendChild(o.cloneNode(!0))),this.renderTaskCount(),Ge()}renderTaskHeader(){this.renderTaskCount(),s(this,ne).toLowerCase()==="timer"?this.renderTimer():s(this,ne).toLowerCase()==="commands"?this.renderCommandTips():s(this,ne).toLowerCase()==="text"&&this.renderCustomText(s(this,De))}renderTaskCount(){const e=this.userList.tasksCompleted,t=this.userList.totalTasks,r=document.querySelector(".task-count");r&&(r.textContent=`${e}/${t}`)}renderTimer(){document.querySelector(".timer").classList.remove("hidden")}startTimer(e=0,t=10){s(this,ie)&&clearInterval(s(this,ie));const r=document.querySelector(".timer"),o=r.querySelector(".timer-title"),a=r.querySelector(".timer-countdown");let l=e*60;nt(o,"Focus");let i=!0;const c=()=>{const u=Math.floor(l/60).toString().padStart(2,"0"),b=(l%60).toString().padStart(2,"0");a.textContent=`${u}:${b}`,l===0?(clearInterval(s(this,ie)),nt(o,"Break"),a.textContent="00:00",os.play(),l=t*60,i&&(h(this,ie,setInterval(c,1e3)),i=!1)):l--};h(this,ie,setInterval(c,1e3))}renderCommandTips(){const e=["!task","!edit","!done","!delete","!check","!help"],t=document.querySelector(".command-tips");t.classList.remove("hidden");let r=0;setInterval(()=>{const o=t.querySelector(".command-code");nt(o,e[r]),r=(r+1)%e.length},6e3)}renderCustomText(e){document.querySelector(".custom-header").classList.remove("hidden"),document.querySelector(".custom-text").textContent=e}chatHandler(e,t,r,o,a){t=`!${t.toLowerCase()}`;let l="",i="";try{if(ns(o))if(s(this,ne).toLowerCase()==="timer"&&_adminConfig.commands.timer.includes(t)){const[c,u]=r.split("/"),b=parseInt(c,10),v=parseInt(u,10)||10;if(isNaN(b)||b<0||isNaN(v)||v<0)throw new Error("Invalid timer duration");return this.startTimer(b,v),l=_adminConfig.responseTo[s(this,x)].timer+" ‚è≤Ô∏è",i=c,se(l,e,i)}else{if(_adminConfig.commands.clearList.includes(t))return this.userList.clearUserList(),this.clearListFromDOM(),l=_adminConfig.responseTo[s(this,x)].clearList,se(l,e,i);if(_adminConfig.commands.clearDone.includes(t))return this.userList.clearDoneTasks().forEach(({id:u})=>{this.deleteTaskFromDOM(u)}),l=_adminConfig.responseTo[s(this,x)].clearDone,se(l,e,i);if(_adminConfig.commands.clearUser.includes(t)){const c=this.userList.deleteUser(r);return this.deleteUserFromDOM(c),i=c.username,l=_adminConfig.responseTo[s(this,x)].clearUser,se(l,e,i)}}if(_userConfig.commands.addTask.includes(t)){if(!o.broadcaster)return se("üìã Use !backlog add [task] to manage your personal tasks!",e,"",!1);if(r==="")throw new Error("Task description is empty");let c=this.userList.getUser(e)||this.userList.createUser(e,{userColor:a.userColor});const u=r.split(", ");c.getTasks().length+u.length>parseInt(s(this,Oe).toString(),10)?l=_userConfig.responseTo[s(this,x)].maxTasksAdded:(this.userList.addUserTasks(e,u).forEach(v=>{this.addTaskToDOM(c,v)}),i=u.map(v=>`üìù "${v}"`).join(", ").replace(/,([^,]*)$/," &$1"),l=_userConfig.responseTo[s(this,x)].addTask)}else if(_userConfig.commands.editTask.includes(t)){if(!o.broadcaster)return se("üìã Use !backlog commands to manage your personal tasks!",e,"",!1);const c=r.search(new RegExp("(?<=\\d)\\s"));if(c===-1)throw new Error("Task number or description format is invalid");const u=r.slice(0,c),b=r.slice(c+1),v=this.userList.editUserTask(e,Se(u),b);this.editTaskFromDOM(v),i=u,l=_userConfig.responseTo[s(this,x)].editTask}else if(_userConfig.commands.focusTask.includes(t)){const c=Se(r),u=this.userList.focusUserTask(e,c);this.focusTaskFromDOM(e,u.id),i=(c+1).toString(),l=_userConfig.responseTo[s(this,x)].focusTask}else if(_userConfig.commands.finishTask.includes(t)){const c=r.split(",").reduce((b,v)=>(Se(v)>=0&&b.push(Se(v)),b),[]),u=this.userList.completeUserTasks(e,c);u.forEach(({id:b})=>{this.completeTaskFromDOM(b)}),u.length===0?l=_userConfig.responseTo[s(this,x)].noTaskFound:(i=u.map(b=>`‚úÖ "${b.description}"`).join(", ").replace(/,([^,]*)$/," &$1"),l=_userConfig.responseTo[s(this,x)].finishTask)}else if(_userConfig.commands.deleteTask.includes(t))if(i=r,r.toLowerCase()==="all"){const c=this.userList.deleteUser(e);this.deleteUserFromDOM(c),l=_userConfig.responseTo[s(this,x)].deleteAll}else{const c=r.split(",").reduce((b,v)=>(Se(v)>=0&&b.push(Se(v)),b),[]),u=this.userList.deleteUserTasks(e,c);u.forEach(({id:b})=>{this.deleteTaskFromDOM(b)}),u.length===0?l=_userConfig.responseTo[s(this,x)].noTaskFound:l=_userConfig.responseTo[s(this,x)].deleteTask}else if(_userConfig.commands.check.includes(t)){const c=this.userList.checkUserTasks(e),u=[];for(let[b,v]of c)u.push(`üìù ${b+1}. ${v.description}`);i=u.join(" "),i===""?l=_userConfig.responseTo[s(this,x)].noTaskFound:l=_userConfig.responseTo[s(this,x)].check}else if(_userConfig.commands.help.includes(t))l=_userConfig.responseTo[s(this,x)].help;else if(_userConfig.commands.additional.includes(t))l=_userConfig.responseTo[s(this,x)].additional;else throw new Error("command not found");return se(l,e,i)}catch(c){return se(_userConfig.responseTo[s(this,x)].invalidCommand,e,c.message,!0)}}clearListFromDOM(){this.renderTaskList()}addTaskToDOM(e,t){this.renderTaskList()}editTaskFromDOM(e){this.renderTaskList()}completeTaskFromDOM(e){this.renderTaskList()}focusTaskFromDOM(e,t){this.renderTaskList()}deleteTaskFromDOM(e){this.renderTaskList()}deleteUserFromDOM(e){this.renderTaskList()}}ie=new WeakMap,x=new WeakMap,Oe=new WeakMap,ne=new WeakMap,De=new WeakMap,Ve=new WeakMap;function se(n,e,t,r=!1){return{message:_settings.botResponsePrefix+n.replace("{user}",e).replace("{message}",t),error:r}}function ns(n){return n.broadcaster||n.mod}function Se(n){return parseInt(n,10)-1}function as({username:n,userColor:e}){const t=document.createElement("div");t.classList.add("card"),t.dataset.user=n;const r=document.createElement("div");r.classList.add("username"),r.innerText=n,r.style.color=_settings.showUsernameColor?e:"",t.appendChild(r);const o=document.createElement("ol");return o.classList.add("tasks"),t.appendChild(o),t}function ls(){document.getElementById("modal").classList.remove("hidden"),document.getElementById("modal").classList.add("flex")}function cs(){document.getElementById("modal").classList.remove("flex"),document.getElementById("modal").classList.add("hidden")}function ds(n){const e={command:null,parameters:null,source:null,tags:null};let t=0,r=null,o=null,a=null,l=null;if(n[t]==="@"){let c=n.indexOf(" ");r=n.slice(1,c),t=c+1}if(n[t]===":"){t+=1;let c=n.indexOf(" ",t);o=n.slice(t,c),t=c+1}let i=n.indexOf(":",t);return i===-1&&(i=n.length),a=n.slice(t,i).trim(),i!==n.length&&(t=i+1,l=n.slice(t)),e.command=hs(a),e.command===null?null:(r!==null&&(e.tags=us(r)),e.source=ms(o),e.parameters=l,l&&l[0]==="!"&&(e.command=ps(l,e.command)),e)}function hs(n){let e=null;const t=n.split(" ");switch(t[0]){case"JOIN":case"PART":case"NOTICE":case"CLEARCHAT":case"HOSTTARGET":case"PRIVMSG":e={command:t[0],channel:t[1]};break;case"PING":e={command:t[0]};break;case"CAP":e={command:t[0],isCapRequestEnabled:t[2]==="ACK"};break;case"GLOBALUSERSTATE":e={command:t[0]};break;case"USERSTATE":case"ROOMSTATE":e={command:t[0],channel:t[1]};break;case"RECONNECT":e={command:t[0]};break;case"421":return console.error(`Unsupported IRC command: ${t[2]}`),null;case"001":e={command:t[0]};break;case"002":case"003":case"004":case"353":case"366":case"372":case"375":case"376":return null;default:return console.log(`Unexpected command: ${t[0]}`),null}return e}function us(n){const e={"client-nonce":null,flags:null};let t={};return n.split(";").forEach(o=>{let a=o.split("="),l=a[1]===""?null:a[1];switch(a[0]){case"badges":case"badge-info":if(l){let c={};l.split(",").forEach(b=>{let v=b.split("/");c[v[0]]=v[1]}),t[a[0]]=c}else t[a[0]]=null;break;case"emotes":if(l){let c={};l.split("/").forEach(b=>{let v=b.split(":"),y=[];v[1].split(",").forEach(p=>{let g=p.split("-");y.push({startPosition:g[0],endPosition:g[1]})}),c[v[0]]=y}),t[a[0]]=c}else t[a[0]]=null;break;case"emote-sets":let i=l.split(",");t[a[0]]=i;break;default:e.hasOwnProperty(a[0])||(t[a[0]]=l)}}),t}function ms(n){if(n==null)return null;{let e=n.split("!");return{nick:e.length==2?e[0]:null,host:e.length==2?e[1]:e[0]}}}function ps(n,e){let r=n.slice(0+1).trim(),o=r.indexOf(" ");return o===-1?(e.botCommand=r.slice(0),e.botCommandParams=""):(e.botCommand=r.slice(0,o),e.botCommandParams=r.slice(o).trim()),e}class fs{constructor(){this.events=new Map}on(e,t){this.events.has(e)||this.events.set(e,[]),this.events.get(e).push(t)}emit(e,...t){this.events.has(e)&&this.events.get(e).forEach(r=>r(...t))}off(e,t){if(this.events.has(e)){const r=this.events.get(e),o=r.indexOf(t);o!==-1&&(r.splice(o,1),r.length===0&&this.events.delete(e))}}once(e,t){const r=(...o)=>{t(...o),this.off(e,r)};this.on(e,r)}}class gs extends fs{constructor(t,{username:r,authToken:o,channel:a},l=WebSocket){super();m(this,D,null);m(this,ae,1e3);this.url=t,this.username=r.toLowerCase(),this.channel=`#${a.toLowerCase()}`,this.authToken=o.includes("oauth:")?o:`oauth:${o}`,this.WebSocketService=l}connect(){h(this,D,new this.WebSocketService(this.url)),s(this,D).onopen=()=>{s(this,D).send("CAP REQ :twitch.tv/tags twitch.tv/commands"),s(this,D).send(`PASS ${this.authToken}`),s(this,D).send(`NICK ${this.username}`)},s(this,D).onerror=t=>(console.error("websocket error: ",t),t),s(this,D).onmessage=t=>{(t==null?void 0:t.data).trim().split(`\r
`).forEach(a=>{const l=ds(a);if(l)switch(l.command.command){case"PRIVMSG":if(l.parameters.startsWith("!")){const i=ys(l);this.emit("command",i)}break;case"PING":s(this,D).send("PONG "+l.parameters);break;case"001":s(this,D).send(`JOIN ${this.channel}`);break;case"JOIN":console.log(`Joined ${this.channel}`),h(this,ae,1e3),this.emit("oauthSuccess");break;case"RECONNECT":this.disconnect(1012,"The Twitch IRC server is terminating the connection for maintenance reasons.");break;case"PART":console.error("The channel must have banned (/ban) the bot."),s(this,D).close();break;case"NOTICE":console.error(`${l.parameters}; left ${this.channel}`),this.emit("oauthError"),s(this,D).send(`PART ${this.channel}`);break}})},s(this,D).onclose=t=>{switch(t.code){case 1e3:console.log("Connection closed normally.");break;case 1006:console.error(`Connection dropped. Reconnecting in ${s(this,ae)} milliseconds...`);let r=s(this,ae);setTimeout(()=>{this.connect()},r),h(this,ae,s(this,ae)*2);break;case 1012:console.log("Switching  servers..."),this.connect();break;default:console.error(`Unhandled code: ${t.code}. Reason: ${t.reason}`)}}}say(t,r){var o;if(((o=s(this,D))==null?void 0:o.readyState)===WebSocket.OPEN){const l=[r?`@reply-parent-msg-id=${r}`:"","PRIVMSG",this.channel,`:${t}`].join(" ").trim();s(this,D).send(l)}else console.error("Connection is not open")}disconnect(t=1e3,r=""){s(this,D).close(t,r)}}D=new WeakMap,ae=new WeakMap;function ys(n){var e,t;return{user:n.tags["display-name"],command:n.command.botCommand,message:n.command.botCommandParams||"",flags:{broadcaster:!!((e=n.tags.badges)!=null&&e.broadcaster),mod:!!((t=n.tags.badges)!=null&&t.moderator)},extra:{userColor:n.tags.color,messageId:n.tags.id}}}function ks(n){n.emit("command",{user:"adminUser",command:"clearList",message:"",flags:{broadcaster:!0,mod:!1},extra:{userColor:"#FF0000",messageId:`${at()}`}});const e=["red","coral","springGreen","lightSeaGreen","slateBlue","hotpink","violet","orange","darkTurquoise","dodgerblue","blueviolet"],{maxTasksPerUser:t}=_settings;for(let r=1;r<=5;r++){const o=`Username${r}`,a=e[r-1];for(let l=0;l<t;l++){const i={user:o,command:"task",message:`test task description ${l===2?"longer text example":""}`,flags:{broadcaster:!0,mod:!1},extra:{userColor:a,messageId:`${at()}`}};setTimeout(()=>{n.emit("command",i)},1e3*r+l*100)}setTimeout(()=>{const l={user:o,command:"done",message:"1",flags:{broadcaster:!0,mod:!1},extra:{userColor:a,messageId:`${at()}`}};n.emit("command",l)},1e3*r+1e4)}}function at(){return`${Math.floor(Math.random()*1e9)}`}class bs{constructor(){m(this,ce);m(this,le,{});m(this,Le,null);m(this,Ce,null);d(this,ce,wt).call(this)}applyTheme(e){if(!s(this,le)[e])return console.error(`Theme "${e}" not found`),!1;const t=s(this,le)[e];return h(this,Le,e),localStorage.setItem("currentTheme",e),d(this,ce,Et).call(this,t),d(this,ce,xt).call(this,t.fonts),window.dispatchEvent(new CustomEvent("themeChanged",{detail:{themeName:e,theme:t}})),!0}getAvailableThemes(){return Object.entries(s(this,le)).map(([e,t])=>({name:e,displayName:t.name}))}getCurrentTheme(){return s(this,Le)}getCurrentThemeData(){return s(this,le)[s(this,Le)]}}le=new WeakMap,Le=new WeakMap,Ce=new WeakMap,ce=new WeakSet,wt=async function(){try{const e=await fetch("./themes.json");h(this,Ce,await e.json()),h(this,le,s(this,Ce).themes);const t=localStorage.getItem("currentTheme")||s(this,Ce).defaultTheme;this.applyTheme(t)}catch(e){console.error("Failed to load themes:",e)}},Et=function(e){const t=document.documentElement,{colors:r,effects:o}=e;t.style.setProperty("--color-primary",r.primary),t.style.setProperty("--color-secondary",r.secondary),t.style.setProperty("--color-accent",r.accent),t.style.setProperty("--color-text",r.text),t.style.setProperty("--color-text-secondary",r.textSecondary),t.style.setProperty("--color-card-bg",r.cardBg),t.style.setProperty("--color-card-border",r.cardBorder),t.style.setProperty("--color-timer-ring",r.timerRing),t.style.setProperty("--color-timer-bg",r.timerBg),t.style.setProperty("--color-task-done",r.taskDone),t.style.setProperty("--color-task-focus",r.taskFocus),t.style.setProperty("--shadow",r.shadow),r.background.includes("gradient"),t.style.setProperty("--background",r.background),t.style.setProperty("--background-overlay",r.backgroundOverlay),t.style.setProperty("--blur",o.blur),t.style.setProperty("--border-radius",o.borderRadius),t.style.setProperty("--card-radius",o.cardRadius)},xt=function(e){typeof WebFont<"u"&&WebFont.load({google:{families:[`${e.primary}:300,400,600,700`,`${e.secondary}:300,400,500,700`]}});const t=document.documentElement;t.style.setProperty("--font-primary",`'${e.primary}', sans-serif`),t.style.setProperty("--font-secondary",`'${e.secondary}', sans-serif`)};class Ts{constructor(e){m(this,k);m(this,C);m(this,we);m(this,Y);m(this,Ue);m(this,ge);m(this,Ae);m(this,F,null);m(this,q,0);m(this,U,0);m(this,j,"focus");m(this,Z,null);m(this,V,!1);m(this,H,0);m(this,N,4);m(this,ye,25);m(this,ke,5);m(this,We,15);m(this,Ye,4);m(this,Ee,"pomoTimer.state");if(h(this,C,document.getElementById(e)),!s(this,C)){console.error(`Timer container "${e}" not found`);return}d(this,k,Pt).call(this)}startCycle(e=25,t=5,r=4,o=null){this.stop(),h(this,ye,e),h(this,ke,t),h(this,N,r),h(this,H,0),h(this,Z,o),d(this,k,ut).call(this),d(this,k,Ne).call(this)}start(e,t="focus",r=null){this.stop(),h(this,j,t),h(this,q,e*60),h(this,U,s(this,q)),h(this,Z,r),h(this,V,!1),d(this,k,He).call(this),h(this,F,setInterval(()=>d(this,k,te).call(this),1e3)),d(this,k,te).call(this)}stop(){s(this,F)&&(clearInterval(s(this,F)),h(this,F,null)),s(this,C).classList.remove("timer-running"),s(this,Y)&&(s(this,Y).style.opacity="0")}pause(){s(this,F)&&(clearInterval(s(this,F)),h(this,F,null),h(this,V,!0),s(this,C).classList.remove("timer-running"),s(this,Y)&&(s(this,Y).style.opacity="0"),d(this,k,Ne).call(this))}resume(){!s(this,F)&&s(this,U)>0&&s(this,V)&&(h(this,V,!1),h(this,F,setInterval(()=>d(this,k,te).call(this),1e3)),s(this,C).classList.add("timer-running"),d(this,k,_e).call(this,(s(this,q)-s(this,U))/s(this,q)*100),d(this,k,Ne).call(this))}reset(){this.stop(),h(this,U,0),h(this,q,0),h(this,H,0),h(this,V,!1),s(this,C).classList.remove("timer-running"),d(this,k,tt).call(this),d(this,k,_e).call(this,0),s(this,ge).textContent="Ready",this.updatePomoCount(0,s(this,N)),d(this,k,Dt).call(this)}updatePomoCount(e,t){const r=s(this,C).querySelector(".pomo-number");r&&(r.textContent=`${e} / ${t}`)}getState(){return{mode:s(this,j),currentSeconds:s(this,U),totalSeconds:s(this,q),isRunning:s(this,F)!==null,isPaused:s(this,V),currentSession:s(this,H),totalSessions:s(this,N),focusDuration:s(this,ye),breakDuration:s(this,ke)}}restoreState(){try{const e=localStorage.getItem(s(this,Ee));if(e){const t=JSON.parse(e);(t.isRunning||t.isPaused)&&(h(this,j,t.mode),h(this,U,t.currentSeconds),h(this,q,t.totalSeconds),h(this,H,t.currentSession),h(this,N,t.totalSessions),h(this,ye,t.focusDuration),h(this,ke,t.breakDuration),h(this,V,t.isPaused),d(this,k,tt).call(this),d(this,k,He).call(this),this.updatePomoCount(s(this,H),s(this,N)),t.isRunning&&h(this,F,setInterval(()=>d(this,k,te).call(this),1e3)))}}catch(e){console.warn("Failed to restore timer state:",e)}}}C=new WeakMap,we=new WeakMap,Y=new WeakMap,Ue=new WeakMap,ge=new WeakMap,Ae=new WeakMap,F=new WeakMap,q=new WeakMap,U=new WeakMap,j=new WeakMap,Z=new WeakMap,V=new WeakMap,H=new WeakMap,N=new WeakMap,ye=new WeakMap,ke=new WeakMap,We=new WeakMap,Ye=new WeakMap,Ee=new WeakMap,k=new WeakSet,Pt=function(){s(this,C).innerHTML=`
			<div class="circular-timer">
				<div class="timer-orbit-ring">
					<div class="timer-orbit-planet"></div>
				</div>
				<svg class="timer-svg" viewBox="0 0 200 200">
					<!-- Background circle -->
					<circle
						class="timer-bg-circle"
						cx="100"
						cy="100"
						r="85"
						fill="none"
						stroke="var(--color-timer-bg)"
						stroke-width="12"
					/>
					<!-- Progress circle -->
					<circle
						class="timer-progress-ring"
						cx="100"
						cy="100"
						r="85"
						fill="none"
						stroke="var(--color-timer-ring)"
						stroke-width="12"
						stroke-linecap="round"
						transform="rotate(-90 100 100)"
					/>
				</svg>
				<div class="timer-content">
					<div class="timer-icon">
						<i class="icon-work">üìö</i>
					</div>
					<div class="timer-time">00:00</div>
					<div class="timer-label">Ready</div>
					<div class="timer-pomo-count">
						<span class="pomo-text">Pomo</span>
						<span class="pomo-number">0 / 4</span>
					</div>
				</div>
			</div>
		`,h(this,we,s(this,C).querySelector(".timer-progress-ring")),h(this,Y,s(this,C).querySelector(".timer-orbit-ring")),h(this,Ue,s(this,C).querySelector(".timer-time")),h(this,ge,s(this,C).querySelector(".timer-label")),h(this,Ae,s(this,C).querySelector(".timer-icon")),d(this,k,_e).call(this,0)},ut=function(){if(s(this,H)>=s(this,N)){d(this,k,Ot).call(this);return}h(this,j,"focus"),ht(this,H)._++,h(this,q,s(this,ye)*60),h(this,U,s(this,q)),h(this,V,!1),d(this,k,He).call(this),this.updatePomoCount(s(this,H),s(this,N)),h(this,F,setInterval(()=>d(this,k,te).call(this),1e3)),d(this,k,te).call(this)},It=function(){const e=s(this,H)%s(this,Ye)===0,t=e?s(this,We):s(this,ke);h(this,j,e?"longbreak":"break"),h(this,q,t*60),h(this,U,s(this,q)),h(this,V,!1),d(this,k,He).call(this),h(this,F,setInterval(()=>d(this,k,te).call(this),1e3)),d(this,k,te).call(this)},te=function(){if(s(this,U)<=0){this.stop(),d(this,k,Mt).call(this);return}ht(this,U)._--,d(this,k,tt).call(this);const e=s(this,U)/s(this,q)*100;d(this,k,_e).call(this,e),s(this,U)<=3&&s(this,U)>0&&s(this,C).classList.add("timer-pulse")},tt=function(){const e=Math.floor(s(this,U)/60).toString().padStart(2,"0"),t=(s(this,U)%60).toString().padStart(2,"0");s(this,Ue).textContent=`${e}:${t}`},_e=function(e){const t=2*Math.PI*85,r=t-e/100*t;if(s(this,we).style.strokeDasharray=`${t} ${t}`,s(this,we).style.strokeDashoffset=r,s(this,Y)){const o=e/100*360;s(this,Y).style.transform=`translate(-50%, -50%) rotate(${o}deg)`,s(this,Y).style.opacity="0.7"}},He=function(){const e={focus:{label:"Focus",icon:"üìö",class:"timer-focus-mode"},break:{label:"Short Break",icon:"‚òï",class:"timer-break-mode"},longbreak:{label:"Long Break",icon:"üå¥",class:"timer-longbreak-mode"}},t=e[s(this,j)]||e.focus;s(this,ge).textContent=t.label,s(this,Ae).innerHTML=`<i class="icon-${s(this,j)}">${t.icon}</i>`,s(this,C).classList.remove("timer-focus-mode","timer-break-mode","timer-longbreak-mode"),s(this,C).classList.add(t.class),s(this,C).classList.add("timer-running")},Mt=function(){s(this,C).classList.remove("timer-pulse"),s(this,C).classList.add("timer-complete"),setTimeout(()=>{s(this,C).classList.remove("timer-complete")},2e3),s(this,j)==="focus"?setTimeout(()=>d(this,k,It).call(this),2e3):setTimeout(()=>d(this,k,ut).call(this),2e3),s(this,Z)&&s(this,Z).call(this,s(this,j),s(this,H),s(this,N)),d(this,k,Ne).call(this)},Ot=function(){this.reset(),s(this,ge).textContent="Cycle Complete! üéâ",s(this,Z)&&s(this,Z).call(this,"cycle_complete",s(this,N),s(this,N))},Ne=function(){try{localStorage.setItem(s(this,Ee),JSON.stringify(this.getState()))}catch(e){console.warn("Failed to save timer state:",e)}},Dt=function(){try{localStorage.removeItem(s(this,Ee))}catch(e){console.warn("Failed to clear timer state:",e)}};class vs{constructor(e){m(this,S);m(this,w,[]);m(this,Je);m(this,E);m(this,Fe,"taskBacklog");m(this,Ke,50);m(this,xe,null);m(this,ct,null);m(this,Pe,!1);m(this,Xe,15);if(h(this,Je,e),h(this,E,document.getElementById(e)),!s(this,E)){console.error(`Backlog container "${e}" not found`);return}d(this,S,_t).call(this),d(this,S,Ut).call(this),this.render()}setOnRefresh(e){h(this,xe,e)}addItem(e,t="Unknown",r=3){if(s(this,w).length>=s(this,Ke))return console.warn("Backlog is full"),null;const o={id:Date.now().toString(),description:e,creator:t,priority:Math.max(1,Math.min(5,r)),completed:!1,createdAt:new Date().toISOString()};return s(this,w).push(o),d(this,S,st).call(this),d(this,S,Ie).call(this),this.render(),o}removeItem(e){const t=s(this,w).findIndex(r=>r.id===e);return t===-1?!1:(s(this,w).splice(t,1),d(this,S,Ie).call(this),this.render(),!0)}toggleComplete(e){const t=s(this,w).find(r=>r.id===e);return t?(t.completed=!t.completed,d(this,S,Ie).call(this),this.render(),!0):!1}setPriority(e,t){const r=s(this,w).find(o=>o.id===e);return r?(r.priority=Math.max(1,Math.min(5,t)),d(this,S,st).call(this),d(this,S,Ie).call(this),this.render(),!0):!1}clearCompleted(){const e=s(this,w).length;h(this,w,s(this,w).filter(r=>!r.completed));const t=e-s(this,w).length;return t>0&&(d(this,S,Ie).call(this),this.render()),t}getItems(){return[...s(this,w)]}getItemByIndex(e){return s(this,w)[e-1]||null}render(){const e=s(this,E).querySelector(".backlog-list-primary"),t=s(this,E).querySelector(".backlog-list-secondary"),r=s(this,E).querySelector(".backlog-empty"),o=s(this,E).querySelector(".backlog-count"),a=s(this,E).querySelector(".backlog-panel"),l=s(this,E).querySelector(".streamer-tasks-container"),i=s(this,w).filter(g=>!g.completed).length;o.textContent=`${i} task${i!==1?"s":""}`,s(this,xe)&&s(this,xe).call(this);const c=l?l.querySelectorAll(".task").length:0,u=s(this,w).length,b=c+u,f=3+5;a.classList.remove("minimized","few-items","medium-content","expanded"),b===0?(a.classList.add("minimized"),e.classList.add("hidden"),t.classList.add("hidden"),r.classList.remove("hidden")):b<=3?(a.classList.add("few-items"),e.classList.remove("hidden"),r.classList.add("hidden")):b<=f?(a.classList.add("medium-content"),e.classList.remove("hidden"),r.classList.add("hidden")):(a.classList.add("expanded"),e.classList.remove("hidden"),r.classList.add("hidden"));const p=s(this,w).map((g,$)=>d(this,S,Bt).call(this,g,$+1)).join("");e.innerHTML=p,t.innerHTML=p,d(this,S,mt).call(this,e),d(this,S,mt).call(this,t),setTimeout(()=>d(this,S,Ft).call(this),100)}}w=new WeakMap,Je=new WeakMap,E=new WeakMap,Fe=new WeakMap,Ke=new WeakMap,xe=new WeakMap,ct=new WeakMap,Pe=new WeakMap,Xe=new WeakMap,S=new WeakSet,Ut=function(){s(this,E).innerHTML=`
			<div class="backlog-panel">
				<div class="backlog-header">
					<div class="backlog-header-top">
						<h3 class="backlog-title">
							<span class="backlog-icon">üìã</span>
							Task Backlog
						</h3>
						<div class="backlog-controls">
							<span class="backlog-count">0 tasks</span>
							<button class="backlog-btn backlog-clear-btn" title="Clear completed">
								<span>üóëÔ∏è</span>
							</button>
						</div>
					</div>
					<div class="backlog-commands-hint">
						<span class="backlog-cmd-label">COMMANDS:</span>
						<span class="backlog-cmd-typewriter"></span>
					</div>
				</div>
				<div class="backlog-content-wrapper">
					<div class="backlog-content">
						<!-- Streamer Tasks Section -->
						<div class="streamer-tasks-container"></div>
						
						<div class="backlog-list-header">Viewer Backlog</div>
						<div class="backlog-list backlog-list-primary"></div>
						<div class="backlog-list backlog-list-secondary"></div>
						<div class="backlog-empty">
							<p>No tasks in backlog</p>
							<p class="backlog-hint">Use !backlog add [task] to add tasks</p>
						</div>
					</div>
				</div>
			</div>
		`,s(this,E).querySelector(".backlog-clear-btn").addEventListener("click",()=>this.clearCompleted()),d(this,S,At).call(this)},At=function(){const e=["!backlog add [task]","!backlog done #","!backlog remove #","!backlog clear (mods)"],t=s(this,E).querySelector(".backlog-cmd-typewriter");if(!t)return;let r=0,o=0,a=!1,l=!1;const i=()=>{const c=e[r];if(l){setTimeout(()=>{l=!1,a=!0,i()},2e3);return}a?(t.textContent=c.substring(0,o-1),o--,o===0?(a=!1,r=(r+1)%e.length,setTimeout(i,500)):setTimeout(i,40)):(t.textContent=c.substring(0,o+1),o++,o===c.length&&(l=!0),setTimeout(i,l?0:80))};i()},st=function(){s(this,w).sort((e,t)=>e.completed!==t.completed?e.completed?1:-1:e.priority!==t.priority?t.priority-e.priority:new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())},mt=function(e){e.querySelectorAll(".backlog-item-check").forEach(t=>{t.addEventListener("click",r=>{const a=r.target.closest(".backlog-item");a&&a.dataset&&this.toggleComplete(a.dataset.id)})}),e.querySelectorAll(".backlog-item-delete").forEach(t=>{t.addEventListener("click",r=>{const a=r.target.closest(".backlog-item");a&&a.dataset&&this.removeItem(a.dataset.id)})})},Ft=function(){const e=s(this,E).querySelector(".backlog-list-primary"),t=s(this,E).querySelector(".backlog-list-secondary"),r=s(this,E).querySelector(".streamer-tasks-container");if(!e)return;const o=r?r.querySelectorAll(".task").length:0,a=s(this,w).length;if(o+a>8&&!s(this,Pe)){const c=e.scrollHeight;t.style.display="flex",d(this,S,qt).call(this,c)}else t.style.display="none",d(this,S,Rt).call(this)},qt=function(e){const t=s(this,E).querySelector(".backlog-list-primary"),r=s(this,E).querySelector(".backlog-list-secondary");if(!t||!r)return;const a=e+12,l=a/s(this,Xe)*1e3,i=[{transform:"translateY(0)"},{transform:`translateY(-${a}px)`}],c={duration:l,iterations:1/0,easing:"linear"};t.animate(i,c),r.animate(i,c),h(this,Pe,!0);const u=s(this,E).querySelector(".backlog-content");u&&u.classList.add("scrolling")},Rt=function(){const e=s(this,E).querySelector(".backlog-list-primary"),t=s(this,E).querySelector(".backlog-list-secondary");e&&e.getAnimations().forEach(o=>o.cancel()),t&&t.getAnimations().forEach(o=>o.cancel()),h(this,Pe,!1);const r=s(this,E).querySelector(".backlog-content");r&&r.classList.remove("scrolling")},Bt=function(e,t){const r=e.completed?"‚úÖ":"‚¨ú",o=e.creator||"Unknown";return`
			<div class="backlog-item ${e.completed?"completed":""}" data-id="${e.id}">
				<div class="backlog-item-header">
					<span class="backlog-item-index">${t}.</span>
					<span class="backlog-item-creator" title="Created by ${o}">@${d(this,S,pt).call(this,o)}</span>
				</div>
				<div class="backlog-item-body">
					<button class="backlog-item-check" title="${e.completed?"Mark incomplete":"Mark complete"}">
						${r}
					</button>
					<span class="backlog-item-text">${d(this,S,pt).call(this,e.description)}</span>
				</div>
				<button class="backlog-item-delete" title="Delete">üóëÔ∏è</button>
			</div>
		`},pt=function(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML},Ie=function(){try{localStorage.setItem(s(this,Fe),JSON.stringify(s(this,w)))}catch(e){console.error("Failed to save backlog:",e)}},_t=function(){try{const e=localStorage.getItem(s(this,Fe));e&&(h(this,w,JSON.parse(e)),d(this,S,st).call(this))}catch(e){console.error("Failed to load backlog:",e),h(this,w,[])}};const vt={timer:{id:"timer-container",defaultDisplay:"flex"},taskList:{id:"task-list-container",defaultDisplay:"block"},backlog:{id:"backlog-container",defaultDisplay:"block"},infoPanel:{id:"info-panel-container",defaultDisplay:"block"}},Ss=30;class $s{constructor(e){m(this,T);m(this,be,{compact:{name:"Compact",description:"Timer and tasks in a tight side-by-side layout",container:{padding:40},components:{timer:{enabled:!0,display:"flex",position:{top:120,left:80},size:{width:320,height:320,minWidth:280}},taskList:{enabled:!1},backlog:{enabled:!0,position:{top:5,left:460},size:{width:700,minWidth:520,minHeight:420}},infoPanel:{enabled:!1}}},split:{name:"Split View",description:"Timer left, tasks center, backlog right",container:{padding:40},components:{timer:{enabled:!0,display:"flex",position:{top:120,left:80},size:{width:320,height:320}},taskList:{enabled:!1},backlog:{enabled:!0,position:{top:15,left:440},size:{width:320,minHeight:480}},infoPanel:{enabled:!1}}},fullOverlay:{name:"Full Overlay",description:"Balanced dashboard with all panels visible",container:{padding:32},components:{timer:{enabled:!0,display:"flex",position:{top:60,left:780},size:{width:360,height:360}},taskList:{enabled:!1},backlog:{enabled:!0,position:{top:460,left:220},size:{width:280,minHeight:420}},infoPanel:{enabled:!0,position:{top:460,left:540},size:{width:280,minHeight:420}}}},minimal:{name:"Minimal",description:"Single timer focus for clean scenes",container:{padding:60},components:{timer:{enabled:!0,display:"flex",position:{top:320,left:820},size:{width:320,height:320}},taskList:{enabled:!1},backlog:{enabled:!1},infoPanel:{enabled:!1}}},timerWithTasks:{name:"Timer + Tasks",description:"Timer stacked above active tasks",container:{padding:40},components:{timer:{enabled:!0,display:"flex",position:{top:100,left:760},size:{width:360,height:360}},taskList:{enabled:!1},backlog:{enabled:!0,position:{top:480,left:700},size:{width:520,minHeight:420}},infoPanel:{enabled:!1}}},dashboard:{name:"Productivity Dashboard",description:"Comprehensive layout for work and study streams",container:{padding:36},components:{timer:{enabled:!0,display:"flex",position:{top:80,left:80},size:{width:320,height:320}},taskList:{enabled:!1},backlog:{enabled:!0,position:{top:15,left:460},size:{width:360,minHeight:480}},infoPanel:{enabled:!0,position:{top:620,left:480},size:{width:360,minHeight:360}}}}});m(this,de,"compact");m(this,X);m(this,z,{});m(this,W,{});m(this,qe,"enhancedOverlay.panelPositions.v2");m(this,Re,"enhancedOverlay.panelSizes.v1");if(h(this,X,document.getElementById(e)),!s(this,X)){console.error(`Layout container "${e}" not found`);return}h(this,z,d(this,T,Jt).call(this)),h(this,W,d(this,T,Kt).call(this));const t=localStorage.getItem("currentLayout")||"compact";this.applyLayout(t)}applyLayout(e){if(!s(this,be)[e])return console.error(`Layout "${e}" not found`),!1;h(this,de,e);const t=s(this,be)[e];return localStorage.setItem("currentLayout",e),s(this,X).dataset.layout=e,d(this,T,Ht).call(this),d(this,T,Nt).call(this,t.container),d(this,T,zt).call(this,e,t.components),window.dispatchEvent(new CustomEvent("layoutChanged",{detail:{layoutName:e,layout:t}})),!0}savePanelPosition(e,t,r){s(this,z)[e]||(s(this,z)[e]={});const o=d(this,T,rt).call(this,r);s(this,z)[e][t]={left:Math.round(o.left),top:Math.round(o.top)},d(this,T,ot).call(this)}savePanelSize(e,t,r){s(this,W)[e]||(s(this,W)[e]={}),s(this,W)[e][t]={width:Math.round(r.width),height:Math.round(r.height)},d(this,T,it).call(this)}resetPanelPosition(e,t=s(this,de)){var r;return s(this,z)[t]?e?s(this,z)[t][e]?(delete s(this,z)[t][e],(r=s(this,W)[t])!=null&&r[e]&&(delete s(this,W)[t][e],d(this,T,it).call(this)),d(this,T,ot).call(this),this.applyLayout(t),!0):!1:(delete s(this,z)[t],delete s(this,W)[t],d(this,T,ot).call(this),d(this,T,it).call(this),this.applyLayout(t),!0):!1}resetLayoutPositions(e){return this.resetPanelPosition(void 0,e)}getAvailableLayouts(){return Object.entries(s(this,be)).map(([e,t])=>({name:e,displayName:t.name,description:t.description}))}getCurrentLayout(){return s(this,de)}getDefaultPosition(e,t){var o,a;const r=s(this,be)[e];return((a=(o=r==null?void 0:r.components)==null?void 0:o[t])==null?void 0:a.position)??null}createLayoutSelector(){const e=document.createElement("div");return e.className="layout-selector glass-effect",e.innerHTML=`
			<div class="layout-selector-header">
				<h4>Layout Presets</h4>
				<button class="layout-close-btn">√ó</button>
			</div>
			<div class="layout-options">
				${this.getAvailableLayouts().map(t=>`
					<button 
						class="layout-option ${t.name===s(this,de)?"active":""}"
						data-layout="${t.name}"
					>
						<div class="layout-option-name">${t.displayName}</div>
						<div class="layout-option-desc">${t.description}</div>
					</button>
				`).join("")}
			</div>
		`,e.querySelectorAll(".layout-option").forEach(t=>{t.addEventListener("click",()=>{const r=t,o=r.dataset.layout;this.applyLayout(o),e.querySelectorAll(".layout-option").forEach(a=>a.classList.remove("active")),r.classList.add("active")})}),e.querySelector(".layout-close-btn").addEventListener("click",()=>{e.remove()}),e}convertToBasePosition(e){return d(this,T,rt).call(this,e)}refreshLayout(){this.applyLayout(s(this,de))}}be=new WeakMap,de=new WeakMap,X=new WeakMap,z=new WeakMap,W=new WeakMap,qe=new WeakMap,Re=new WeakMap,T=new WeakSet,Ht=function(){const e=s(this,X).style;e.display="block",e.gridTemplateColumns="",e.gridTemplateRows="",e.justifyContent="",e.alignItems="",e.maxWidth="",e.height="",e.gap="",e.position="fixed",e.top="0",e.left="0",e.width="100%",e.height="100%",e.padding=`${Ss}px`,e.boxSizing="border-box",e.overflow="visible"},Nt=function(e={}){if(!e)return;const t=s(this,X).style;typeof e.padding=="number"&&(t.padding=`${e.padding}px`)},zt=function(e,t){const{scaleX:r,scaleY:o}=d(this,T,ft).call(this),a=s(this,X).getBoundingClientRect();Object.values(vt).forEach(({id:l})=>{const i=document.getElementById(l);i&&(i.style.display="none",i.removeAttribute("aria-hidden"))}),Object.entries(t).forEach(([l,i])=>{const c=vt[l];if(!c)return;const u=document.getElementById(c.id);if(!u)return;if(!(i!=null&&i.enabled)){u.style.display="none",u.setAttribute("aria-hidden","true");return}u.style.display=i.display||c.defaultDisplay,u.classList.add("draggable-panel"),u.style.position="absolute",u.style.zIndex=i.zIndex??10,u.dataset.panel=l,u.style.transform="none",console.log(`Setting up panel ${l}:`,{display:u.style.display,position:u.style.position,left:u.style.left,top:u.style.top,class:u.className}),d(this,T,Gt).call(this,u,i.size,l,e);const v=d(this,T,jt).call(this,e,l)??i.position;if(v){const y=d(this,T,Wt).call(this,v,r,o),f=d(this,T,Yt).call(this,y,u,a);u.style.left=`${Math.round(f.left)}px`,u.style.top=`${Math.round(f.top)}px`;const p=d(this,T,rt).call(this,f);u.dataset.baseLeft=`${p.left}`,u.dataset.baseTop=`${p.top}`}})},Gt=function(e,t={},r=null,o=null){const a=o&&r?d(this,T,Vt).call(this,o,r):null,l=a?{...t,...a}:t;["width","height","minWidth","minHeight","maxWidth","maxHeight"].forEach(c=>{l[c]!==void 0?e.style[c]=`${l[c]}px`:e.style[c]=""})},jt=function(e,t){var r;return((r=s(this,z)[e])==null?void 0:r[t])??null},Vt=function(e,t){var r;return((r=s(this,W)[e])==null?void 0:r[t])??null},ft=function(){if(!s(this,X))return{scaleX:1,scaleY:1};const e=1,t=1;return console.log("Using 1:1 scale for 1920x1080 resolution"),{scaleX:e,scaleY:t}},Wt=function(e,t,r){return{left:e.left*t,top:e.top*r}},Yt=function(e,t,r){const o=t.getBoundingClientRect(),a=o.width||t.offsetWidth||0,l=o.height||t.offsetHeight||0,i=Math.max(0,r.width-a),c=Math.max(0,r.height-l);return{left:Math.max(0,Math.min(i,e.left)),top:Math.max(0,Math.min(c,e.top))}},rt=function(e){const{scaleX:t,scaleY:r}=d(this,T,ft).call(this);return{left:e.left/t,top:e.top/r}},Jt=function(){try{const e=localStorage.getItem(s(this,qe));return e?JSON.parse(e):{}}catch(e){return console.warn("Failed to load saved panel positions",e),{}}},ot=function(){try{localStorage.setItem(s(this,qe),JSON.stringify(s(this,z)))}catch(e){console.warn("Failed to persist panel positions",e)}},Kt=function(){try{const e=localStorage.getItem(s(this,Re));return e?JSON.parse(e):{}}catch(e){return console.warn("Failed to load saved panel sizes",e),{}}},it=function(){try{localStorage.setItem(s(this,Re),JSON.stringify(s(this,W)))}catch(e){console.warn("Failed to persist panel sizes",e)}};class Ls{constructor(e){m(this,R);m(this,he);m(this,P,{title:"Stream Goal",current:0,target:100,active:!1});m(this,Be,"overlay.goalData");if(h(this,he,document.getElementById(e)),!s(this,he)){console.error(`Goal container "${e}" not found`);return}d(this,R,Xt).call(this),d(this,R,gt).call(this)}setGoal(e,t,r=0){h(this,P,{title:e||"Goal",target:typeof t=="number"?t:parseInt(t)||100,current:typeof r=="number"?r:parseInt(r)||0,active:!0}),d(this,R,ze).call(this),this.render()}updateProgress(e){const t=typeof e=="number"?e:parseInt(e)||0;s(this,P).current+=t,s(this,P).current<0&&(s(this,P).current=0),d(this,R,ze).call(this),this.render()}reset(){s(this,P).current=0,d(this,R,ze).call(this),this.render()}hide(){s(this,P).active=!1,d(this,R,ze).call(this),this.render()}render(){if(!s(this,he))return;const e=s(this,he).querySelector(".goal-panel");if(!e){d(this,R,gt).call(this);return}s(this,P).active?(e.classList.remove("hidden"),e.classList.add("active")):(e.classList.add("hidden"),e.classList.remove("active"));const t=e.querySelector(".goal-title"),r=e.querySelector(".goal-progress-text"),o=e.querySelector(".goal-bar-fill");t&&(t.textContent=s(this,P).title),r&&(r.textContent=`${s(this,P).current} / ${s(this,P).target}`),o instanceof HTMLElement&&(o.style.width=`${d(this,R,yt).call(this)}%`)}}he=new WeakMap,P=new WeakMap,Be=new WeakMap,R=new WeakSet,gt=function(){s(this,he).innerHTML=`
			<div class="goal-panel ${s(this,P).active?"active":"hidden"}">
				<div class="goal-info">
					<span class="goal-title">${s(this,P).title}</span>
					<span class="goal-progress-text">${s(this,P).current} / ${s(this,P).target}</span>
				</div>
				<div class="goal-bar-container">
					<div class="goal-bar-fill" style="width: ${d(this,R,yt).call(this)}%"></div>
				</div>
			</div>
		`},yt=function(){if(s(this,P).target<=0)return 0;const e=s(this,P).current/s(this,P).target*100;return Math.min(Math.max(e,0),100)},ze=function(){localStorage.setItem(s(this,Be),JSON.stringify(s(this,P)))},Xt=function(){const e=localStorage.getItem(s(this,Be));if(e)try{h(this,P,JSON.parse(e))}catch(t){console.error("Failed to load goal state",t)}};const{twitch_channel:Cs,twitch_oauth:ws,twitch_username:Es}=_authConfig,xs="wss://irc-ws.chat.twitch.tv:443",K=new gs(xs,{username:Es,authToken:ws,channel:Cs});let Me,me,re,oe,A,pe;const $e=new Map,Ps={timer:".circular-timer",taskList:".header",backlog:".backlog-header",goal:".goal-panel"};window.addEventListener("load",()=>{let n="userList";_settings.testMode&&(console.log("Test mode enabled"),n="testUserList"),Me=new is(n),Me.render(),me=new bs,re=new Ts("timer-container"),oe=new vs("backlog-container"),Me.setBacklogPanel(oe),pe=new Ls("goal-container"),A=new $s("app"),St(),Ms(),Ds(),K.on("command",e=>{const{user:t,command:r,message:o,flags:a,extra:l}=e,i=Is(t,r,o,a);if(i){i.error?console.error(i.message):K.say(i.message,l.messageId);return}const c=Me.chatHandler(t,r,o,a,l);c.error?console.error(c.message):K.say(c.message,l.messageId)}),K.on("oauthError",()=>{ls()}),K.on("oauthSuccess",()=>{cs()}),K.connect(),_settings.testMode&&ks(K)});function Is(n,e,t,r,o){var b,v;const a=`!${e.toLowerCase()}`,l=r.broadcaster||r.mod,i=_settings.botResponsePrefix,c=(t||"").trim(),u=y=>{if(!y)return null;const f=y.toLowerCase(),p=f.replace(/[^a-z0-9]/g,""),g=A.getAvailableLayouts();for(const $ of g){const M=$.name.toLowerCase(),B=M.replace(/[^a-z0-9]/g,""),Q=$.displayName.toLowerCase(),Te=Q.replace(/[^a-z0-9]/g,"");if(M===f||B===p||Q===f||Te===p)return $.name}return null};if(a==="!theme"){if(!l)return{message:`${i}@${n} Only moderators can change themes.`,error:!0};if(!c){const p=me.getAvailableThemes().map(g=>g.name).join(", ");return{message:`${i}Available themes: ${p}. Use !theme [name] to switch.`,error:!1}}const y=c.toLowerCase(),f=me.applyTheme(y);return{message:f?`${i}Theme changed to ${c}! üé®`:`${i}Theme "${c}" not found.`,error:!f}}if(a==="!layout"){if(!l)return{message:`${i}@${n} Only moderators can change layouts.`,error:!0};if(!c){const g=A.getAvailableLayouts().map($=>`${$.name} (${$.description})`).join(", ");return{message:`${i}Available layouts: ${g}. Use !layout [name] to switch.`,error:!1}}const y=u(c);if(!y)return{message:`${i}Layout "${c}" not found.`,error:!0};const f=A.applyLayout(y),p=A.getAvailableLayouts().find(g=>g.name===y);return{message:f?`${i}Layout changed to ${(p==null?void 0:p.displayName)||y}! üìê`:`${i}Layout "${c}" not found.`,error:!f}}if(a==="!resetpanel"){if(!l)return{message:`${i}@${n} Only moderators can reset panel positions.`,error:!0};if(!c)return{message:`${i}Usage: !resetpanel [timer|tasklist|backlog|infopanel] (optional layout)`,error:!1};const[y,f]=c.split(/\s+/),p=y==null?void 0:y.toLowerCase();if(!p||!["timer","tasklist","backlog","infopanel"].includes(p))return{message:`${i}Panel must be one of: timer, tasklist, backlog, infopanel.`,error:!0};const $=p==="tasklist"?"taskList":p==="infopanel"?"infoPanel":p,M=f?u(f):A.getCurrentLayout();if(!M)return{message:`${i}Layout "${f}" not found.`,error:!0};const B=A.getAvailableLayouts().find(Qe=>Qe.name===M),Q=(B==null?void 0:B.displayName)||M,Te=A.resetPanelPosition($,M);return{message:Te?`${i}Reset ${p} panel position for ${Q}.`:`${i}No custom position stored for ${p} in ${Q}.`,error:!Te}}if(a==="!resetlayout"){if(!l)return{message:`${i}@${n} Only moderators can reset layouts.`,error:!0};const y=c?u(c):A.getCurrentLayout();if(!y)return{message:`${i}Layout "${c}" not found.`,error:!0};const f=A.getAvailableLayouts().find($=>$.name===y),p=(f==null?void 0:f.displayName)||y,g=A.resetLayoutPositions(y);return{message:g?`${i}Reset all panel positions for ${p}.`:`${i}No custom positions stored for ${p}.`,error:!g}}if(a==="!backlog"){const y=c.length?c.split(/\s+/):[],f=(b=y[0])==null?void 0:b.toLowerCase(),p=y.slice(1).join(" ");if(!f)return{message:`${i}@${n} Usage: !backlog add/done/remove [text/number]`,error:!1};if(f==="add"){if(!p)return{message:`${i}@${n} Provide a task description to add.`,error:!0};const g=oe.addItem(p,n);return{message:g?`${i}@${n} Added "${p}" to backlog! üìã`:`${i}@${n} Backlog is full!`,error:!g}}if(f==="done"||f==="remove"){const g=parseInt(p,10);if(!p||Number.isNaN(g)||g<1)return{message:`${i}@${n} Provide a valid backlog item number.`,error:!0};const $=oe.getItemByIndex(g);return $?f==="done"?(oe.toggleComplete($.id),{message:`${i}@${n} Marked backlog item ${g} as done! ‚úÖ`,error:!1}):(oe.removeItem($.id),{message:`${i}@${n} Removed backlog item ${g}! üóëÔ∏è`,error:!1}):{message:`${i}@${n} Backlog item ${g} not found.`,error:!0}}if(f==="clear"){if(!l)return{message:`${i}@${n} Only moderators can clear the backlog.`,error:!0};const g=oe.clearCompleted();return{message:`${i}Cleared ${g} completed backlog item${g!==1?"s":""}!`,error:!1}}return{message:`${i}@${n} Usage: !backlog add/done/remove [text/number]`,error:!1}}if(a==="!goal"){if(!l)return{message:`${i}@${n} Only moderators can manage goals.`,error:!0};const y=c.length?c.split(/\s+/):[],f=(v=y[0])==null?void 0:v.toLowerCase(),p=y.slice(1);if(!f)return{message:`${i}Usage: !goal set [title] [target] [current] | !goal add [n] | !goal reset | !goal hide/show`,error:!1};if(f==="set"){if(p.length<2)return{message:`${i}Usage: !goal set [title] [target] [optional: current]`,error:!0};let g,$=0,M;const B=p[p.length-1],Q=p[p.length-2];return p.length>=3&&!isNaN(Number(B))&&!isNaN(Number(Q))?($=parseInt(p.pop()),g=parseInt(p.pop()),M=p.join(" ")):(g=parseInt(p.pop()),M=p.join(" ")),pe.setGoal(M,g,$),{message:`${i}Goal set: ${M} (${$}/${g})! üéØ`,error:!1}}if(f==="add"||f==="remove"){const g=parseInt(p[0])||1;return pe.updateProgress(f==="add"?g:-g),{message:`${i}Goal updated! üìà`,error:!1}}if(f==="reset")return pe.reset(),{message:`${i}Goal progress reset! üîÑ`,error:!1};if(f==="hide")return pe.hide(),{message:`${i}Goal tracker hidden.`,error:!1};if(f==="show")return pe.setGoal(),{message:`${i}Goal tracker visible.`,error:!1}}if(a==="!pomopause")return l?(re.pause(),{message:`${i}Timer paused! ‚è∏Ô∏è`,error:!1}):{message:`${i}@${n} Only moderators can control the timer.`,error:!0};if(a==="!pomoresume")return l?(re.resume(),{message:`${i}Timer resumed! ‚ñ∂Ô∏è`,error:!1}):{message:`${i}@${n} Only moderators can control the timer.`,error:!0};if(a==="!pomostop"||a==="!stoptimer")return l?(re.stop(),{message:`${i}Timer stopped! ‚èπÔ∏è`,error:!1}):{message:`${i}@${n} Only moderators can control the timer.`,error:!0};if(a==="!pomoreset")return l?(re.reset(),{message:`${i}Timer reset! All sessions cleared. üîÑ`,error:!1}):{message:`${i}@${n} Only moderators can control the timer.`,error:!0};if(a==="!pomostatus"){const y=re.getState(),f=Math.floor(y.currentSeconds/60),p=y.currentSeconds%60,g=`${f}:${p.toString().padStart(2,"0")}`,$=y.isRunning?"Running":y.isPaused?"Paused":"Stopped";return{message:`${i}Timer: ${$} | ${y.mode} mode | ${g} | Session ${y.currentSession}/${y.totalSessions} üìä`,error:!1}}if(a==="!pomo"||a==="!pomodoro"){if(!l)return{message:`${i}@${n} Only moderators can control the timer.`,error:!0};const y=c.split("/"),f=Math.max(1,parseInt(y[0],10)||25),p=Math.max(1,parseInt(y[1],10)||5),g=Math.max(1,Math.min(12,parseInt(y[2],10)||4));return re.startCycle(f,p,g,($,M,B)=>{$==="focus"?K.say(`${i}Focus session ${M} complete! Time for a break ‚òï`):$==="break"||$==="longbreak"?K.say(`${i}Break over! Starting session ${M+1}/${B} üí™`):$==="cycle_complete"&&K.say(`${i}Pomodoro cycle complete! ${B} sessions done! üéâ`)}),{message:`${i}Pomodoro started: ${f}m focus / ${p}m break √ó ${g} sessions ‚è±Ô∏è`,error:!1}}return null}function lt(n,e,t={}){const{strategy:r="transform",bounds:o=null,onDragStart:a,onDragEnd:l}=t,i=e||n;let c=!1,u=0,b=0,v=0,y=0,f=0,p=0,g=0,$=0,M={left:n.offsetLeft||0,top:n.offsetTop||0};const B=typeof o=="string"?document.querySelector(o):o;i.style.cursor="move";const Q=G=>{if(G.button===0&&!(G.target instanceof HTMLButtonElement||G.target.closest("button"))){if(c=!0,n.classList.add("dragging"),document.body.classList.add("overlay-dragging"),r==="absolute"){const J=n.getBoundingClientRect(),ue=B?B.getBoundingClientRect():{left:0,top:0};g=G.clientX-J.left,$=G.clientY-J.top,f=J.left-ue.left,p=J.top-ue.top,M={left:f,top:p}}else{const J=window.getComputedStyle(n),ue=new DOMMatrix(J.transform);f=ue.m41,p=ue.m42,v=G.clientX-f,y=G.clientY-p}a==null||a()}},Te=G=>{if(c)if(G.preventDefault(),r==="absolute"){const J=B?B.getBoundingClientRect():{left:0,top:0,width:window.innerWidth,height:window.innerHeight},ue=n.getBoundingClientRect();let Ze=G.clientX-J.left-g,et=G.clientY-J.top-$;const As=Math.max(0,J.width-ue.width),Fs=Math.max(0,J.height-ue.height);Ze=Math.max(0,Math.min(As,Ze)),et=Math.max(0,Math.min(Fs,et)),n.style.left=`${Math.round(Ze)}px`,n.style.top=`${Math.round(et)}px`,M={left:Ze,top:et}}else u=G.clientX-v,b=G.clientY-y,f=u,p=b,n.style.transform=`translate(${u}px, ${b}px)`},Qe=()=>{c&&(c=!1,n.classList.remove("dragging"),document.body.classList.remove("overlay-dragging"),r!=="absolute"&&(v=u,y=b),l==null||l({left:Math.round(M.left),top:Math.round(M.top)}))};return i.addEventListener("mousedown",Q),document.addEventListener("mousemove",Te),document.addEventListener("mouseup",Qe),()=>{i.removeEventListener("mousedown",Q),document.removeEventListener("mousemove",Te),document.removeEventListener("mouseup",Qe),n.classList.remove("dragging"),document.body.classList.remove("overlay-dragging")}}function St(){if(!A)return;const n=document.getElementById("app");if(!n)return;const e=new Set;n.querySelectorAll(".draggable-panel").forEach(r=>{var u;const o=r,a=o.dataset.panel;if(!a||(e.add(a),$e.has(a)&&((u=$e.get(a))==null||u(),$e.delete(a)),getComputedStyle(o).display==="none"))return;const l=Ps[a],i=l?o.querySelector(l):null,c=lt(o,i||o,{strategy:"absolute",bounds:n,onDragEnd:b=>{A.savePanelPosition(A.getCurrentLayout(),a,b)}});$e.set(a,c)});const t=[];$e.forEach((r,o)=>{e.has(o)||(r(),t.push(o))}),t.forEach(r=>$e.delete(r))}window.addEventListener("layoutChanged",()=>St());function Ms(){const n=document.getElementById("theme-toggle");if(!n)return;let e=!1,t=null;n.addEventListener("click",()=>{e&&t?(t.remove(),t=null,e=!1):(t=Os(),document.body.appendChild(t),lt(t),e=!0)}),document.addEventListener("click",r=>{const o=r.target;e&&t&&!n.contains(o)&&!t.contains(o)&&(t.remove(),t=null,e=!1)})}function Os(){const n=document.createElement("div");n.className="theme-menu";const e=me.getCurrentTheme(),t=me.getAvailableThemes();return n.innerHTML=`
		<div class="theme-menu-header" title="Drag to move">
			<span>üé® Themes</span>
			<span class="drag-hint">‚ãÆ‚ãÆ</span>
		</div>
		<div class="theme-list">
			${t.map(r=>`
				<button 
					class="theme-item ${r.name===e?"active":""}"
					data-theme="${r.name}"
				>
					${r.displayName}
				</button>
			`).join("")}
		</div>
	`,n.querySelectorAll(".theme-item").forEach(r=>{r.addEventListener("click",()=>{const o=r.getAttribute("data-theme");me.applyTheme(o),n.querySelectorAll(".theme-item").forEach(a=>a.classList.remove("active")),r.classList.add("active")})}),n}function Ds(){document.addEventListener("keydown",n=>{var e;(n.ctrlKey||n.metaKey)&&n.shiftKey&&n.key==="L"&&(n.preventDefault(),Us()),(n.ctrlKey||n.metaKey)&&n.shiftKey&&n.key==="T"&&(n.preventDefault(),(e=document.getElementById("theme-toggle"))==null||e.click())})}function Us(){const n=document.querySelector(".layout-selector");if(n){n.remove();return}const e=A.createLayoutSelector();document.body.appendChild(e);const t=e.querySelector(".layout-selector-header");t&&lt(e,t)}typeof window<"u"&&(window.debugOverlay={app:Me,themeManager:me,circularTimer:re,backlogPanel:oe,goalPanel:pe,layoutManager:A})})();

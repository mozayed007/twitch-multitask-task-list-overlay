var $t=L=>{throw TypeError(L)};var dt=(L,I,O)=>I.has(L)||$t("Cannot "+O);var r=(L,I,O)=>(dt(L,I,"read from private field"),O?O.call(L):I.get(L)),p=(L,I,O)=>I.has(L)?$t("Cannot add the same private member more than once"):I instanceof WeakSet?I.add(L):I.set(L,O),h=(L,I,O,Le)=>(dt(L,I,"write to private field"),Le?Le.call(L,O):I.set(L,O),O),d=(L,I,O)=>(dt(L,I,"access private method"),O);var ht=(L,I,O,Le)=>({set _(je){h(L,I,je,O)},get _(){return r(L,I,Le)}});(function(){"use strict";var Ve,Lt,fe,_,Ct,te,oe,x,Ae,ie,Fe,Ye,U,ne,ae,Ee,xe,le,wt,Et,xt,w,Pe,W,qe,ge,Be,F,q,D,j,ee,V,H,N,ye,ke,We,Je,Ie,y,Pt,ut,It,Ue,Te,ue,ze,Mt,Ot,Se,Ut,C,Ke,E,Re,Xe,Me,ct,Oe,Qe,$,Dt,At,st,mt,Ft,qt,Bt,Rt,pt,$e,_t,be,ce,Q,z,Y,_e,He,v,Ht,Nt,zt,Gt,jt,Vt,ft,Yt,Wt,rt,Jt,ot,Kt,it,de,P,Ne,B,gt,yt,Ge,Xt;let L,I,O=!1;const Le=getComputedStyle(document.documentElement).getPropertyValue("--card-gap-between").slice(0,-2);function je(){const e=document.querySelector(".task-wrapper").clientHeight,t=document.querySelector(".task-container.primary"),s=t.scrollHeight,o=document.querySelector(".task-container.secondary");if(s>e&&!O){o.style.display="block";const a=_settings.scrollSpeed.toString();let l=parseInt(a,10),i=s+parseInt(Le,10)*2,u={duration:i/l*1e3,iterations:1,easing:"linear"},b=[{transform:"translateY(0)"},{transform:`translateY(-${i}px)`}],T=[{transform:"translateY(0)"},{transform:`translateY(-${i}px)`}];L=t.animate(b,u),I=o.animate(T,u),O=!0,Zt()}else s<=e&&(o.style.display="none",Qt())}function Qt(){L&&L.cancel(),I&&I.cancel(),O=!1}function Zt(){L&&(L.addEventListener("finish",kt),L.addEventListener("cancel",kt))}function kt(){O=!1,je()}function nt(n,e){if(n.innerText===e)return;const t=n.animate([{opacity:1},{opacity:0}],{duration:350,fill:"forwards",easing:"ease-out"});t.onfinish=()=>{n.textContent=e,n.animate([{opacity:0},{opacity:1}],{duration:350,fill:"forwards",easing:"ease-in"})}}function es(n){const e=document.querySelector(":root");for(let[t,s]of Object.entries(n))t.includes("FontFamily")&&ts(s),e.style.setProperty(ss(t),s)}function ts(n){window.WebFont.load({google:{families:[`${n}:100,400,700`]}})}function ss(n){return`--${n.replace(/([A-Z])/g,"-$1").toLowerCase()}`}class bt{constructor(e,t){this.username=this.validateUsername(e),this.userColor=(t==null?void 0:t.userColor)||"",this.tasks=[]}validateUsername(e){if(typeof e!="string")throw new Error("Username must be of type string");if(e=e.trim(),e.length===0)throw new Error("Username invalid");return e}addTask(e){return this.tasks.push(e),e}editTask(e,t){let s=this.getTask(e);return s?(s.setDescription(t),s):null}completeTask(e){let t=this.getTask(e);return t?(t.setCompletionStatus(!0),t):null}setFocusedTask(e){let t=this.getTask(e);return t?(this.tasks.forEach(s=>{s.setFocusStatus(!1)}),t.setFocusStatus(!0),t):null}deleteTask(e){const t=[].concat(e).filter(o=>this.validTaskIndex(o)),s=[];return this.tasks=this.tasks.filter((o,a)=>t.includes(a)?(s.push(o),!1):!0),s}removeCompletedTasks(){const e=[];return this.tasks=this.tasks.filter(t=>t.isComplete()?(e.push(t),!1):!0),e}getTask(e){return this.validTaskIndex(e)?this.tasks[e]:null}getTasks(){return this.tasks}validTaskIndex(e){return!(typeof e!="number"||isNaN(e)||e<0||e>=this.tasks.length)}}class vt{constructor(e){p(this,Ve);this.description=this.validateDescription(e),this.id=d(this,Ve,Lt).call(this),this.completionStatus=!1,this.focusStatus=!1}validateDescription(e){if(typeof e!="string")throw new Error("Task description must be of type string");if(e=e.trim(),e.length===0)throw new Error("Task description invalid");return e}setDescription(e){this.description=this.validateDescription(e)}isComplete(){return this.completionStatus}setCompletionStatus(e){if(typeof e!="boolean")throw new Error("Completion status must be of type boolean");this.completionStatus=e,this.isFocused()&&this.isComplete()&&this.setFocusStatus(!1)}isFocused(){return this.focusStatus}setFocusStatus(e){if(typeof e!="boolean")throw new Error("Focus status must be of type boolean");this.focusStatus=e}}Ve=new WeakSet,Lt=function(){const e=new Date,t=String(e.getDate()).padStart(2,"0"),s=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0"),a=String(e.getSeconds()).padStart(2,"0"),l=String(e.getMilliseconds()).padStart(3,"0"),i=Math.floor(Math.random()*1e4);return`${t}${s}${o}${a}${l}${i}`};class rs{constructor(e="userList"){p(this,_);p(this,fe);h(this,fe,e),this.tasksCompleted=0,this.totalTasks=0,this.users=d(this,_,Ct).call(this)}getUser(e){return this.users.find(t=>t.username===e)}getAllUsers(){return this.users}createUser(e,t){if(this.getUser(e))throw new Error(`${e} already exists`);const s=new bt(e,t);return this.users.push(s),s}addUserTasks(e,t){const s=this.getUser(e);if(!s)throw new Error(`${e} does not exist`);const o=[].concat(t),a=[];return o.forEach(l=>{a.push(s.addTask(new vt(l))),this.totalTasks++}),d(this,_,te).call(this),a}editUserTask(e,t,s){const o=this.getUser(e);if(!o)throw new Error(`${e} has no tasks`);const a=o.editTask(t,s);if(!a)throw new Error(`Task ${t} not found`);return d(this,_,te).call(this),a}focusUserTask(e,t){const s=this.getUser(e);if(!s)throw new Error(`User ${e} not found`);const o=s.setFocusedTask(t);if(!o)throw new Error(`Task ${t} not found`);return d(this,_,te).call(this),o}completeUserTasks(e,t){const s=this.getUser(e);if(!s)throw new Error(`User ${e} not found`);const o=[].concat(t).reduce((a,l)=>{const i=s.getTask(l);return i&&(i.isComplete()||(i.setCompletionStatus(!0),this.tasksCompleted++),a.push(i)),a},[]);return d(this,_,te).call(this),o}deleteUserTasks(e,t){const s=this.getUser(e);if(!s)throw new Error(`User ${e} not found`);const o=[].concat(t),a=s.deleteTask(o);return s.getTasks().length===0&&this.deleteUser(e),this.decreaseTaskCount(a),d(this,_,te).call(this),a}checkUserTasks(e,t="incomplete"){const s=this.getUser(e);if(!s)return new Map;const o=new Map;return s.getTasks().forEach((a,l)=>{t==="incomplete"&&!a.isComplete()&&o.set(l,a),t==="complete"&&a.isComplete()&&o.set(l,a)}),o}clearUserList(){this.users=[],this.tasksCompleted=0,this.totalTasks=0,d(this,_,te).call(this)}clearDoneTasks(){let e=[];for(let t=this.users.length-1;t>=0;t--){const s=this.users[t],o=s.removeCompletedTasks();e=e.concat(o),s.getTasks().length===0&&this.users.splice(t,1)}return this.decreaseTaskCount(e),d(this,_,te).call(this),e}deleteUser(e){const t=this.users.findIndex(a=>RegExp(`^${e}`,"i").test(a.username));if(t===-1)throw new Error(`${e} not found`);const s=this.users[t],o=this.users.splice(t,1)[0];return this.decreaseTaskCount(o.getTasks()),d(this,_,te).call(this),s}decreaseTaskCount(e){e.forEach(t=>{t.isComplete()&&this.tasksCompleted--,this.totalTasks--})}}fe=new WeakMap,_=new WeakSet,Ct=function(){const e=[];let t=localStorage.getItem(r(this,fe));return t?JSON.parse(t).forEach(s=>{const o=new bt(s.username,{userColor:s.userColor});s.tasks.map(a=>{const l=o.addTask(new vt(a.description));this.totalTasks++,a.completionStatus&&(l.setCompletionStatus(a.completionStatus),this.tasksCompleted++),a.focusStatus&&l.setFocusStatus(a.focusStatus)}),e.push(o)}):localStorage.setItem(r(this,fe),JSON.stringify(e)),e},te=function(){localStorage.setItem(r(this,fe),JSON.stringify(this.users))};const os=document.getElementById("audioSample");class is{constructor(e){p(this,oe,null);p(this,x);p(this,Ae);p(this,ie);p(this,Fe);p(this,Ye,null);this.userList=new rs(e),es(_styles),h(this,x,_settings.languageCode),h(this,Ae,_settings.maxTasksPerUser),h(this,ie,_settings.headerFeature),h(this,Fe,_settings.headerCustomText)}setBacklogPanel(e){h(this,Ye,e),e.setOnRefresh(()=>{this.renderTaskList()}),this.renderTaskList()}render(){this.renderTaskList(),this.renderTaskHeader()}renderTaskList(){const e=document.querySelector(".task-container.primary"),t=document.querySelector(".task-container.secondary"),s=document.querySelector(".streamer-tasks-container");if(this.userList.users.length===0){e&&(e.innerHTML=""),t&&(t.innerHTML=""),s&&(s.innerHTML=""),this.renderTaskCount();return}const o=document.createDocumentFragment();this.userList.getAllUsers().forEach(a=>{const l=as(a),i=l.querySelector("ol");a.tasks.forEach(c=>{const u=document.createElement("li");u.classList.add("task"),u.dataset.taskId=`${c.id}`,u.innerText=c.description,c.isComplete()&&u.classList.add("done"),c.isFocused()&&u.classList.add("focus"),i.appendChild(u)}),o.appendChild(l)}),e&&(e.innerHTML="",e.appendChild(o.cloneNode(!0))),t&&(t.innerHTML="",t.appendChild(o.cloneNode(!0))),s&&(s.innerHTML="",s.appendChild(o.cloneNode(!0))),this.renderTaskCount(),je()}renderTaskHeader(){this.renderTaskCount(),r(this,ie).toLowerCase()==="timer"?this.renderTimer():r(this,ie).toLowerCase()==="commands"?this.renderCommandTips():r(this,ie).toLowerCase()==="text"&&this.renderCustomText(r(this,Fe))}renderTaskCount(){const e=this.userList.tasksCompleted,t=this.userList.totalTasks,s=document.querySelector(".task-count");s&&(s.textContent=`${e}/${t}`)}renderTimer(){document.querySelector(".timer").classList.remove("hidden")}startTimer(e=0,t=10){r(this,oe)&&clearInterval(r(this,oe));const s=document.querySelector(".timer"),o=s.querySelector(".timer-title"),a=s.querySelector(".timer-countdown");let l=e*60;nt(o,"Focus");let i=!0;const c=()=>{const u=Math.floor(l/60).toString().padStart(2,"0"),b=(l%60).toString().padStart(2,"0");a.textContent=`${u}:${b}`,l===0?(clearInterval(r(this,oe)),nt(o,"Break"),a.textContent="00:00",os.play(),l=t*60,i&&(h(this,oe,setInterval(c,1e3)),i=!1)):l--};h(this,oe,setInterval(c,1e3))}renderCommandTips(){const e=["!task","!edit","!done","!delete","!check","!help"],t=document.querySelector(".command-tips");t.classList.remove("hidden");let s=0;setInterval(()=>{const o=t.querySelector(".command-code");nt(o,e[s]),s=(s+1)%e.length},6e3)}renderCustomText(e){document.querySelector(".custom-header").classList.remove("hidden"),document.querySelector(".custom-text").textContent=e}chatHandler(e,t,s,o,a){t=`!${t.toLowerCase()}`;let l="",i="";try{if(ns(o))if(r(this,ie).toLowerCase()==="timer"&&_adminConfig.commands.timer.includes(t)){const[c,u]=s.split("/"),b=parseInt(c,10),T=parseInt(u,10)||10;if(isNaN(b)||b<0||isNaN(T)||T<0)throw new Error("Invalid timer duration");return this.startTimer(b,T),l=_adminConfig.responseTo[r(this,x)].timer+" ‚è≤Ô∏è",i=c,se(l,e,i)}else{if(_adminConfig.commands.clearList.includes(t))return this.userList.clearUserList(),this.clearListFromDOM(),l=_adminConfig.responseTo[r(this,x)].clearList,se(l,e,i);if(_adminConfig.commands.clearDone.includes(t))return this.userList.clearDoneTasks().forEach(({id:u})=>{this.deleteTaskFromDOM(u)}),l=_adminConfig.responseTo[r(this,x)].clearDone,se(l,e,i);if(_adminConfig.commands.clearUser.includes(t)){const c=this.userList.deleteUser(s);return this.deleteUserFromDOM(c),i=c.username,l=_adminConfig.responseTo[r(this,x)].clearUser,se(l,e,i)}}if(_userConfig.commands.addTask.includes(t)){if(!o.broadcaster)return se("üìã Use !backlog add [task] to manage your personal tasks!",e,"",!1);if(s==="")throw new Error("Task description is empty");let c=this.userList.getUser(e)||this.userList.createUser(e,{userColor:a.userColor});const u=s.split(", ");c.getTasks().length+u.length>parseInt(r(this,Ae).toString(),10)?l=_userConfig.responseTo[r(this,x)].maxTasksAdded:(this.userList.addUserTasks(e,u).forEach(T=>{this.addTaskToDOM(c,T)}),i=u.map(T=>`üìù "${T}"`).join(", ").replace(/,([^,]*)$/," &$1"),l=_userConfig.responseTo[r(this,x)].addTask)}else if(_userConfig.commands.editTask.includes(t)){if(!o.broadcaster)return se("üìã Use !backlog commands to manage your personal tasks!",e,"",!1);const c=s.search(new RegExp("(?<=\\d)\\s"));if(c===-1)throw new Error("Task number or description format is invalid");const u=s.slice(0,c),b=s.slice(c+1),T=this.userList.editUserTask(e,Ce(u),b);this.editTaskFromDOM(T),i=u,l=_userConfig.responseTo[r(this,x)].editTask}else if(_userConfig.commands.focusTask.includes(t)){const c=Ce(s),u=this.userList.focusUserTask(e,c);this.focusTaskFromDOM(e,u.id),i=(c+1).toString(),l=_userConfig.responseTo[r(this,x)].focusTask}else if(_userConfig.commands.finishTask.includes(t)){const c=s.split(",").reduce((b,T)=>(Ce(T)>=0&&b.push(Ce(T)),b),[]),u=this.userList.completeUserTasks(e,c);u.forEach(({id:b})=>{this.completeTaskFromDOM(b)}),u.length===0?l=_userConfig.responseTo[r(this,x)].noTaskFound:(i=u.map(b=>`‚úÖ "${b.description}"`).join(", ").replace(/,([^,]*)$/," &$1"),l=_userConfig.responseTo[r(this,x)].finishTask)}else if(_userConfig.commands.deleteTask.includes(t))if(i=s,s.toLowerCase()==="all"){const c=this.userList.deleteUser(e);this.deleteUserFromDOM(c),l=_userConfig.responseTo[r(this,x)].deleteAll}else{const c=s.split(",").reduce((b,T)=>(Ce(T)>=0&&b.push(Ce(T)),b),[]),u=this.userList.deleteUserTasks(e,c);u.forEach(({id:b})=>{this.deleteTaskFromDOM(b)}),u.length===0?l=_userConfig.responseTo[r(this,x)].noTaskFound:l=_userConfig.responseTo[r(this,x)].deleteTask}else if(_userConfig.commands.check.includes(t)){const c=this.userList.checkUserTasks(e),u=[];for(let[b,T]of c)u.push(`üìù ${b+1}. ${T.description}`);i=u.join(" "),i===""?l=_userConfig.responseTo[r(this,x)].noTaskFound:l=_userConfig.responseTo[r(this,x)].check}else if(_userConfig.commands.help.includes(t))l=_userConfig.responseTo[r(this,x)].help;else if(_userConfig.commands.additional.includes(t))l=_userConfig.responseTo[r(this,x)].additional;else throw new Error("command not found");return se(l,e,i)}catch(c){return se(_userConfig.responseTo[r(this,x)].invalidCommand,e,c.message,!0)}}clearListFromDOM(){this.renderTaskList()}addTaskToDOM(e,t){this.renderTaskList()}editTaskFromDOM(e){this.renderTaskList()}completeTaskFromDOM(e){this.renderTaskList()}focusTaskFromDOM(e,t){this.renderTaskList()}deleteTaskFromDOM(e){this.renderTaskList()}deleteUserFromDOM(e){this.renderTaskList()}}oe=new WeakMap,x=new WeakMap,Ae=new WeakMap,ie=new WeakMap,Fe=new WeakMap,Ye=new WeakMap;function se(n,e,t,s=!1){return{message:_settings.botResponsePrefix+n.replace("{user}",e).replace("{message}",t),error:s}}function ns(n){return n.broadcaster||n.mod}function Ce(n){return parseInt(n,10)-1}function as({username:n,userColor:e}){const t=document.createElement("div");t.classList.add("card"),t.dataset.user=n;const s=document.createElement("div");s.classList.add("username"),s.innerText=n,s.style.color=_settings.showUsernameColor?e:"",t.appendChild(s);const o=document.createElement("ol");return o.classList.add("tasks"),t.appendChild(o),t}function ls(){document.getElementById("modal").classList.remove("hidden"),document.getElementById("modal").classList.add("flex")}function cs(){document.getElementById("modal").classList.remove("flex"),document.getElementById("modal").classList.add("hidden")}function ds(n){const e={command:null,parameters:null,source:null,tags:null};let t=0,s=null,o=null,a=null,l=null;if(n[t]==="@"){let c=n.indexOf(" ");s=n.slice(1,c),t=c+1}if(n[t]===":"){t+=1;let c=n.indexOf(" ",t);o=n.slice(t,c),t=c+1}let i=n.indexOf(":",t);return i===-1&&(i=n.length),a=n.slice(t,i).trim(),i!==n.length&&(t=i+1,l=n.slice(t)),e.command=hs(a),e.command===null?null:(s!==null&&(e.tags=us(s)),e.source=ms(o),e.parameters=l,l&&l[0]==="!"&&(e.command=ps(l,e.command)),e)}function hs(n){let e=null;const t=n.split(" ");switch(t[0]){case"JOIN":case"PART":case"NOTICE":case"CLEARCHAT":case"HOSTTARGET":case"PRIVMSG":e={command:t[0],channel:t[1]};break;case"PING":e={command:t[0]};break;case"CAP":e={command:t[0],isCapRequestEnabled:t[2]==="ACK"};break;case"GLOBALUSERSTATE":e={command:t[0]};break;case"USERSTATE":case"ROOMSTATE":e={command:t[0],channel:t[1]};break;case"RECONNECT":e={command:t[0]};break;case"421":return console.error(`Unsupported IRC command: ${t[2]}`),null;case"001":e={command:t[0]};break;case"002":case"003":case"004":case"353":case"366":case"372":case"375":case"376":return null;default:return console.log(`Unexpected command: ${t[0]}`),null}return e}function us(n){const e={"client-nonce":null,flags:null};let t={};return n.split(";").forEach(o=>{let a=o.split("="),l=a[1]===""?null:a[1];switch(a[0]){case"badges":case"badge-info":if(l){let c={};l.split(",").forEach(b=>{let T=b.split("/");c[T[0]]=T[1]}),t[a[0]]=c}else t[a[0]]=null;break;case"emotes":if(l){let c={};l.split("/").forEach(b=>{let T=b.split(":"),k=[];T[1].split(",").forEach(m=>{let g=m.split("-");k.push({startPosition:g[0],endPosition:g[1]})}),c[T[0]]=k}),t[a[0]]=c}else t[a[0]]=null;break;case"emote-sets":let i=l.split(",");t[a[0]]=i;break;default:e.hasOwnProperty(a[0])||(t[a[0]]=l)}}),t}function ms(n){if(n==null)return null;{let e=n.split("!");return{nick:e.length==2?e[0]:null,host:e.length==2?e[1]:e[0]}}}function ps(n,e){let s=n.slice(0+1).trim(),o=s.indexOf(" ");return o===-1?(e.botCommand=s.slice(0),e.botCommandParams=""):(e.botCommand=s.slice(0,o),e.botCommandParams=s.slice(o).trim()),e}class fs{constructor(){this.events=new Map}on(e,t){this.events.has(e)||this.events.set(e,[]),this.events.get(e).push(t)}emit(e,...t){this.events.has(e)&&this.events.get(e).forEach(s=>s(...t))}off(e,t){if(this.events.has(e)){const s=this.events.get(e),o=s.indexOf(t);o!==-1&&(s.splice(o,1),s.length===0&&this.events.delete(e))}}once(e,t){const s=(...o)=>{t(...o),this.off(e,s)};this.on(e,s)}}class gs extends fs{constructor(t,{username:s,authToken:o,channel:a},l=WebSocket){super();p(this,U,null);p(this,ne,1e3);this.url=t,this.username=s.toLowerCase(),this.channel=`#${a.toLowerCase()}`,this.authToken=o.includes("oauth:")?o:`oauth:${o}`,this.WebSocketService=l}connect(){h(this,U,new this.WebSocketService(this.url)),r(this,U).onopen=()=>{r(this,U).send("CAP REQ :twitch.tv/tags twitch.tv/commands"),r(this,U).send(`PASS ${this.authToken}`),r(this,U).send(`NICK ${this.username}`)},r(this,U).onerror=t=>(console.error("websocket error: ",t),t),r(this,U).onmessage=t=>{(t==null?void 0:t.data).trim().split(`\r
`).forEach(a=>{const l=ds(a);if(l)switch(l.command.command){case"PRIVMSG":if(l.parameters.startsWith("!")){const i=ys(l);this.emit("command",i)}break;case"PING":r(this,U).send("PONG "+l.parameters);break;case"001":r(this,U).send(`JOIN ${this.channel}`);break;case"JOIN":console.log(`Joined ${this.channel}`),h(this,ne,1e3),this.emit("oauthSuccess");break;case"RECONNECT":this.disconnect(1012,"The Twitch IRC server is terminating the connection for maintenance reasons.");break;case"PART":console.error("The channel must have banned (/ban) the bot."),r(this,U).close();break;case"NOTICE":console.error(`${l.parameters}; left ${this.channel}`),this.emit("oauthError"),r(this,U).send(`PART ${this.channel}`);break}})},r(this,U).onclose=t=>{switch(t.code){case 1e3:console.log("Connection closed normally.");break;case 1006:console.error(`Connection dropped. Reconnecting in ${r(this,ne)} milliseconds...`);let s=r(this,ne);setTimeout(()=>{this.connect()},s),h(this,ne,r(this,ne)*2);break;case 1012:console.log("Switching  servers..."),this.connect();break;default:console.error(`Unhandled code: ${t.code}. Reason: ${t.reason}`)}}}say(t,s){var o;if(((o=r(this,U))==null?void 0:o.readyState)===WebSocket.OPEN){const l=[s?`@reply-parent-msg-id=${s}`:"","PRIVMSG",this.channel,`:${t}`].join(" ").trim();r(this,U).send(l)}else console.error("Connection is not open")}disconnect(t=1e3,s=""){r(this,U).close(t,s)}}U=new WeakMap,ne=new WeakMap;function ys(n){var e,t;return{user:n.tags["display-name"],command:n.command.botCommand,message:n.command.botCommandParams||"",flags:{broadcaster:!!((e=n.tags.badges)!=null&&e.broadcaster),mod:!!((t=n.tags.badges)!=null&&t.moderator)},extra:{userColor:n.tags.color,messageId:n.tags.id}}}function ks(n){n.emit("command",{user:"adminUser",command:"clearList",message:"",flags:{broadcaster:!0,mod:!1},extra:{userColor:"#FF0000",messageId:`${at()}`}});const e=["red","coral","springGreen","lightSeaGreen","slateBlue","hotpink","violet","orange","darkTurquoise","dodgerblue","blueviolet"],{maxTasksPerUser:t}=_settings;for(let s=1;s<=5;s++){const o=`Username${s}`,a=e[s-1];for(let l=0;l<t;l++){const i={user:o,command:"task",message:`test task description ${l===2?"longer text example":""}`,flags:{broadcaster:!0,mod:!1},extra:{userColor:a,messageId:`${at()}`}};setTimeout(()=>{n.emit("command",i)},1e3*s+l*100)}setTimeout(()=>{const l={user:o,command:"done",message:"1",flags:{broadcaster:!0,mod:!1},extra:{userColor:a,messageId:`${at()}`}};n.emit("command",l)},1e3*s+1e4)}}function at(){return`${Math.floor(Math.random()*1e9)}`}class bs{constructor(){p(this,le);p(this,ae,{});p(this,Ee,null);p(this,xe,null);d(this,le,wt).call(this)}applyTheme(e){if(!r(this,ae)[e])return console.error(`Theme "${e}" not found`),!1;const t=r(this,ae)[e];return h(this,Ee,e),localStorage.setItem("currentTheme",e),d(this,le,Et).call(this,t),d(this,le,xt).call(this,t.fonts),window.dispatchEvent(new CustomEvent("themeChanged",{detail:{themeName:e,theme:t}})),!0}getAvailableThemes(){return Object.entries(r(this,ae)).map(([e,t])=>({name:e,displayName:t.name}))}getCurrentTheme(){return r(this,Ee)}getCurrentThemeData(){return r(this,ae)[r(this,Ee)]}}ae=new WeakMap,Ee=new WeakMap,xe=new WeakMap,le=new WeakSet,wt=async function(){try{const e=await fetch("./themes.json");h(this,xe,await e.json()),h(this,ae,r(this,xe).themes);const t=localStorage.getItem("currentTheme")||r(this,xe).defaultTheme;this.applyTheme(t)}catch(e){console.error("Failed to load themes:",e)}},Et=function(e){const t=document.documentElement,{colors:s,effects:o}=e;t.style.setProperty("--color-primary",s.primary),t.style.setProperty("--color-secondary",s.secondary),t.style.setProperty("--color-accent",s.accent),t.style.setProperty("--color-text",s.text),t.style.setProperty("--color-text-secondary",s.textSecondary),t.style.setProperty("--color-card-bg",s.cardBg),t.style.setProperty("--color-card-border",s.cardBorder),t.style.setProperty("--color-timer-ring",s.timerRing),t.style.setProperty("--color-timer-bg",s.timerBg),t.style.setProperty("--color-task-done",s.taskDone),t.style.setProperty("--color-task-focus",s.taskFocus),t.style.setProperty("--shadow",s.shadow),s.background.includes("gradient"),t.style.setProperty("--background",s.background),t.style.setProperty("--background-overlay",s.backgroundOverlay),t.style.setProperty("--blur",o.blur),t.style.setProperty("--border-radius",o.borderRadius),t.style.setProperty("--card-radius",o.cardRadius)},xt=function(e){typeof WebFont<"u"&&WebFont.load({google:{families:[`${e.primary}:300,400,600,700`,`${e.secondary}:300,400,500,700`]}});const t=document.documentElement;t.style.setProperty("--font-primary",`'${e.primary}', sans-serif`),t.style.setProperty("--font-secondary",`'${e.secondary}', sans-serif`)};class vs{constructor(e){p(this,y);p(this,w);p(this,Pe);p(this,W);p(this,qe);p(this,ge);p(this,Be);p(this,F,null);p(this,q,0);p(this,D,0);p(this,j,"focus");p(this,ee,null);p(this,V,!1);p(this,H,0);p(this,N,4);p(this,ye,25);p(this,ke,5);p(this,We,15);p(this,Je,4);p(this,Ie,"pomoTimer.state");if(h(this,w,document.getElementById(e)),!r(this,w)){console.error(`Timer container "${e}" not found`);return}d(this,y,Pt).call(this)}startCycle(e=25,t=5,s=4,o=null){this.stop(),h(this,ye,e),h(this,ke,t),h(this,N,s),h(this,H,0),h(this,ee,o),d(this,y,ut).call(this),d(this,y,Se).call(this)}start(e,t="focus",s=null){this.stop(),h(this,j,t),h(this,q,e*60),h(this,D,r(this,q)),h(this,ee,s),h(this,V,!1),d(this,y,ze).call(this),h(this,F,setInterval(()=>d(this,y,Ue).call(this),1e3)),d(this,y,Te).call(this),d(this,y,ue).call(this,100)}stop(){r(this,F)&&(clearInterval(r(this,F)),h(this,F,null)),r(this,w).classList.remove("timer-running"),r(this,W)&&(r(this,W).style.opacity="0")}pause(){r(this,F)&&(clearInterval(r(this,F)),h(this,F,null),h(this,V,!0),r(this,w).classList.remove("timer-running"),r(this,W)&&(r(this,W).style.opacity="0"),d(this,y,Se).call(this))}resume(){!r(this,F)&&r(this,D)>0&&r(this,V)&&(h(this,V,!1),h(this,F,setInterval(()=>d(this,y,Ue).call(this),1e3)),r(this,w).classList.add("timer-running"),d(this,y,ue).call(this,(r(this,q)-r(this,D))/r(this,q)*100),d(this,y,Se).call(this))}reset(){this.stop(),h(this,D,0),h(this,q,0),h(this,H,0),h(this,V,!1),r(this,w).classList.remove("timer-running"),d(this,y,Te).call(this),d(this,y,ue).call(this,0),r(this,ge).textContent="Ready",this.updatePomoCount(0,r(this,N)),d(this,y,Ut).call(this)}updatePomoCount(e,t){const s=r(this,w).querySelector(".pomo-number");s&&(s.textContent=`${e} / ${t}`)}getState(){return{mode:r(this,j),currentSeconds:r(this,D),totalSeconds:r(this,q),isRunning:r(this,F)!==null,isPaused:r(this,V),currentSession:r(this,H),totalSessions:r(this,N),focusDuration:r(this,ye),breakDuration:r(this,ke)}}restoreState(){try{const e=localStorage.getItem(r(this,Ie));if(e){const t=JSON.parse(e);(t.isRunning||t.isPaused)&&(h(this,j,t.mode),h(this,D,t.currentSeconds),h(this,q,t.totalSeconds),h(this,H,t.currentSession),h(this,N,t.totalSessions),h(this,ye,t.focusDuration),h(this,ke,t.breakDuration),h(this,V,t.isPaused),d(this,y,Te).call(this),d(this,y,ze).call(this),this.updatePomoCount(r(this,H),r(this,N)),t.isRunning&&h(this,F,setInterval(()=>d(this,y,Ue).call(this),1e3)))}}catch(e){console.warn("Failed to restore timer state:",e)}}}w=new WeakMap,Pe=new WeakMap,W=new WeakMap,qe=new WeakMap,ge=new WeakMap,Be=new WeakMap,F=new WeakMap,q=new WeakMap,D=new WeakMap,j=new WeakMap,ee=new WeakMap,V=new WeakMap,H=new WeakMap,N=new WeakMap,ye=new WeakMap,ke=new WeakMap,We=new WeakMap,Je=new WeakMap,Ie=new WeakMap,y=new WeakSet,Pt=function(){r(this,w).innerHTML=`
			<div class="circular-timer">
				<div class="timer-orbit-ring">
					<div class="timer-orbit-planet"></div>
				</div>
				<svg class="timer-svg" viewBox="0 0 200 200">
					<!-- Background circle -->
					<circle
						class="timer-bg-circle"
						cx="100"
						cy="100"
						r="85"
						fill="none"
						stroke="var(--color-timer-bg)"
						stroke-width="12"
					/>
					<!-- Progress circle -->
					<circle
						class="timer-progress-ring"
						cx="100"
						cy="100"
						r="85"
						fill="none"
						stroke="var(--color-timer-ring)"
						stroke-width="12"
						stroke-linecap="round"
						transform="rotate(-90 100 100)"
					/>
				</svg>
				<div class="timer-content">
					<div class="timer-icon">
						<i class="icon-work">üìö</i>
					</div>
					<div class="timer-time">00:00</div>
					<div class="timer-label">Ready</div>
					<div class="timer-pomo-count">
						<span class="pomo-text">Pomo</span>
						<span class="pomo-number">0 / 4</span>
					</div>
				</div>
			</div>
		`,h(this,Pe,r(this,w).querySelector(".timer-progress-ring")),h(this,W,r(this,w).querySelector(".timer-orbit-ring")),h(this,qe,r(this,w).querySelector(".timer-time")),h(this,ge,r(this,w).querySelector(".timer-label")),h(this,Be,r(this,w).querySelector(".timer-icon")),d(this,y,ue).call(this,0)},ut=function(){if(r(this,H)>=r(this,N)){d(this,y,Ot).call(this);return}this.stop(),h(this,j,"focus"),ht(this,H)._++,h(this,q,r(this,ye)*60),h(this,D,r(this,q)),h(this,V,!1),d(this,y,ze).call(this),this.updatePomoCount(r(this,H),r(this,N)),h(this,F,setInterval(()=>d(this,y,Ue).call(this),1e3)),d(this,y,Te).call(this),d(this,y,ue).call(this,100),d(this,y,Se).call(this)},It=function(){this.stop();const e=r(this,H)%r(this,Je)===0,t=e?r(this,We):r(this,ke);h(this,j,e?"longbreak":"break"),h(this,q,t*60),h(this,D,r(this,q)),h(this,V,!1),d(this,y,ze).call(this),h(this,F,setInterval(()=>d(this,y,Ue).call(this),1e3)),d(this,y,Te).call(this),d(this,y,ue).call(this,100),d(this,y,Se).call(this)},Ue=function(){if(r(this,D)<=0){this.stop(),d(this,y,Mt).call(this);return}ht(this,D)._--,d(this,y,Te).call(this);const e=r(this,D)/r(this,q)*100;d(this,y,ue).call(this,e),r(this,D)<=3&&r(this,D)>0&&r(this,w).classList.add("timer-pulse")},Te=function(){const e=Math.floor(r(this,D)/60).toString().padStart(2,"0"),t=(r(this,D)%60).toString().padStart(2,"0");r(this,qe).textContent=`${e}:${t}`},ue=function(e){const t=2*Math.PI*85,s=t-e/100*t;if(r(this,Pe).style.strokeDasharray=`${t} ${t}`,r(this,Pe).style.strokeDashoffset=s,r(this,W)){const o=e/100*360;r(this,W).style.transform=`translate(-50%, -50%) rotate(${o}deg)`,r(this,W).style.opacity="0.7"}},ze=function(){const e={focus:{label:"Focus",icon:"üìö",class:"timer-focus-mode"},break:{label:"Short Break",icon:"‚òï",class:"timer-break-mode"},longbreak:{label:"Long Break",icon:"üå¥",class:"timer-longbreak-mode"}},t=e[r(this,j)]||e.focus;r(this,ge).textContent=t.label,r(this,Be).innerHTML=`<i class="icon-${r(this,j)}">${t.icon}</i>`,r(this,w).classList.remove("timer-focus-mode","timer-break-mode","timer-longbreak-mode"),r(this,w).classList.add(t.class),r(this,w).classList.add("timer-running")},Mt=function(){r(this,w).classList.remove("timer-pulse"),r(this,w).classList.add("timer-complete"),setTimeout(()=>{r(this,w).classList.remove("timer-complete")},2e3),r(this,j)==="focus"?setTimeout(()=>d(this,y,It).call(this),2e3):setTimeout(()=>d(this,y,ut).call(this),2e3),r(this,ee)&&r(this,ee).call(this,r(this,j),r(this,H),r(this,N)),d(this,y,Se).call(this)},Ot=function(){this.reset(),r(this,ge).textContent="Cycle Complete! üéâ",r(this,ee)&&r(this,ee).call(this,"cycle_complete",r(this,N),r(this,N))},Se=function(){try{localStorage.setItem(r(this,Ie),JSON.stringify(this.getState()))}catch(e){console.warn("Failed to save timer state:",e)}},Ut=function(){try{localStorage.removeItem(r(this,Ie))}catch(e){console.warn("Failed to clear timer state:",e)}};class Ts{constructor(e){p(this,$);p(this,C,[]);p(this,Ke);p(this,E);p(this,Re,"taskBacklog");p(this,Xe,50);p(this,Me,null);p(this,ct,null);p(this,Oe,!1);p(this,Qe,15);if(h(this,Ke,e),h(this,E,document.getElementById(e)),!r(this,E)){console.error(`Backlog container "${e}" not found`);return}d(this,$,_t).call(this),d(this,$,Dt).call(this),this.render()}setOnRefresh(e){h(this,Me,e)}addItem(e,t="Unknown",s=3){if(r(this,C).length>=r(this,Xe))return console.warn("Backlog is full"),null;const o={id:Date.now().toString(),description:e,creator:t,priority:Math.max(1,Math.min(5,s)),completed:!1,createdAt:new Date().toISOString()};return r(this,C).push(o),d(this,$,st).call(this),d(this,$,$e).call(this),this.render(),o}removeItem(e){const t=r(this,C).findIndex(s=>s.id===e);return t===-1?!1:(r(this,C).splice(t,1),d(this,$,$e).call(this),this.render(),!0)}toggleComplete(e){const t=r(this,C).find(s=>s.id===e);return t?(t.completed=!t.completed,d(this,$,$e).call(this),this.render(),!0):!1}setPriority(e,t){const s=r(this,C).find(o=>o.id===e);return s?(s.priority=Math.max(1,Math.min(5,t)),d(this,$,st).call(this),d(this,$,$e).call(this),this.render(),!0):!1}clearCompleted(){const e=r(this,C).length;h(this,C,r(this,C).filter(s=>!s.completed));const t=e-r(this,C).length;return t>0&&(d(this,$,$e).call(this),this.render()),t}clearAll(){const e=r(this,C).length;return h(this,C,[]),e>0&&(d(this,$,$e).call(this),this.render()),e}getItems(){return[...r(this,C)]}getItemByIndex(e){return r(this,C)[e-1]||null}getItemsByUser(e){const t=e.toLowerCase();return r(this,C).filter(s=>s.creator&&s.creator.toLowerCase()===t)}getUserItemByIndex(e,t){return this.getItemsByUser(e)[t-1]||null}render(){const e=r(this,E).querySelector(".backlog-list-primary"),t=r(this,E).querySelector(".backlog-list-secondary"),s=r(this,E).querySelector(".backlog-empty"),o=r(this,E).querySelector(".backlog-count"),a=r(this,E).querySelector(".backlog-panel"),l=r(this,E).querySelector(".streamer-tasks-container"),i=r(this,C).filter(g=>!g.completed).length;o.textContent=`${i} task${i!==1?"s":""}`,r(this,Me)&&r(this,Me).call(this);const c=l?l.querySelectorAll(".task").length:0,u=r(this,C).length,b=c+u,f=3+5;a.classList.remove("minimized","few-items","medium-content","expanded"),b===0?(a.classList.add("minimized"),e.classList.add("hidden"),t.classList.add("hidden"),s.classList.remove("hidden")):b<=3?(a.classList.add("few-items"),e.classList.remove("hidden"),s.classList.add("hidden")):b<=f?(a.classList.add("medium-content"),e.classList.remove("hidden"),s.classList.add("hidden")):(a.classList.add("expanded"),e.classList.remove("hidden"),s.classList.add("hidden"));const m=r(this,C).map((g,S)=>d(this,$,Rt).call(this,g,S+1)).join("");e.innerHTML=m,t.innerHTML=m,d(this,$,mt).call(this,e),d(this,$,mt).call(this,t),setTimeout(()=>d(this,$,Ft).call(this),100)}}C=new WeakMap,Ke=new WeakMap,E=new WeakMap,Re=new WeakMap,Xe=new WeakMap,Me=new WeakMap,ct=new WeakMap,Oe=new WeakMap,Qe=new WeakMap,$=new WeakSet,Dt=function(){r(this,E).innerHTML=`
			<div class="backlog-panel">
				<div class="backlog-header">
					<div class="backlog-header-top">
						<h3 class="backlog-title">
							<span class="backlog-icon">üìã</span>
							Task Backlog
						</h3>
						<div class="backlog-controls">
							<span class="backlog-count">0 tasks</span>
							<button class="backlog-btn backlog-clear-btn" title="Clear completed">
								<span>üóëÔ∏è</span>
							</button>
						</div>
					</div>
					<div class="backlog-commands-hint">
						<span class="backlog-cmd-label">COMMANDS:</span>
						<span class="backlog-cmd-typewriter"></span>
					</div>
				</div>
				<div class="backlog-content-wrapper">
					<div class="backlog-content">
						<!-- Streamer Tasks Section -->
						<div class="streamer-tasks-container"></div>
						
						<div class="backlog-list-header">Viewer Backlog</div>
						<div class="backlog-list backlog-list-primary"></div>
						<div class="backlog-list backlog-list-secondary"></div>
						<div class="backlog-empty">
							<p>No tasks in backlog</p>
							<p class="backlog-hint">Use !backlog add [task] to add tasks</p>
						</div>
					</div>
				</div>
			</div>
		`,r(this,E).querySelector(".backlog-clear-btn").addEventListener("click",()=>this.clearCompleted()),d(this,$,At).call(this)},At=function(){const e=["!backlog add [task]","!backlog done #","!backlog remove #","!backlog clear (mods)"],t=r(this,E).querySelector(".backlog-cmd-typewriter");if(!t)return;let s=0,o=0,a=!1,l=!1;const i=()=>{const c=e[s];if(l){setTimeout(()=>{l=!1,a=!0,i()},2e3);return}a?(t.textContent=c.substring(0,o-1),o--,o===0?(a=!1,s=(s+1)%e.length,setTimeout(i,500)):setTimeout(i,40)):(t.textContent=c.substring(0,o+1),o++,o===c.length&&(l=!0),setTimeout(i,l?0:80))};i()},st=function(){r(this,C).sort((e,t)=>e.completed!==t.completed?e.completed?1:-1:e.priority!==t.priority?t.priority-e.priority:new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())},mt=function(e){e.querySelectorAll(".backlog-item-check").forEach(t=>{t.addEventListener("click",s=>{const a=s.target.closest(".backlog-item");a&&a.dataset&&this.toggleComplete(a.dataset.id)})}),e.querySelectorAll(".backlog-item-delete").forEach(t=>{t.addEventListener("click",s=>{const a=s.target.closest(".backlog-item");a&&a.dataset&&this.removeItem(a.dataset.id)})})},Ft=function(){const e=r(this,E).querySelector(".backlog-list-primary"),t=r(this,E).querySelector(".backlog-list-secondary"),s=r(this,E).querySelector(".streamer-tasks-container");if(!e)return;const o=s?s.querySelectorAll(".task").length:0,a=r(this,C).length;if(o+a>8&&!r(this,Oe)){const c=e.scrollHeight;t.style.display="flex",d(this,$,qt).call(this,c)}else t.style.display="none",d(this,$,Bt).call(this)},qt=function(e){const t=r(this,E).querySelector(".backlog-list-primary"),s=r(this,E).querySelector(".backlog-list-secondary");if(!t||!s)return;const a=e+12,l=a/r(this,Qe)*1e3,i=[{transform:"translateY(0)"},{transform:`translateY(-${a}px)`}],c={duration:l,iterations:1/0,easing:"linear"};t.animate(i,c),s.animate(i,c),h(this,Oe,!0);const u=r(this,E).querySelector(".backlog-content");u&&u.classList.add("scrolling")},Bt=function(){const e=r(this,E).querySelector(".backlog-list-primary"),t=r(this,E).querySelector(".backlog-list-secondary");e&&e.getAnimations().forEach(o=>o.cancel()),t&&t.getAnimations().forEach(o=>o.cancel()),h(this,Oe,!1);const s=r(this,E).querySelector(".backlog-content");s&&s.classList.remove("scrolling")},Rt=function(e,t){const s=e.completed?"‚úÖ":"‚¨ú",o=e.creator||"Unknown";return`
			<div class="backlog-item ${e.completed?"completed":""}" data-id="${e.id}">
				<div class="backlog-item-header">
					<span class="backlog-item-index">${t}.</span>
					<span class="backlog-item-creator" title="Created by ${o}">@${d(this,$,pt).call(this,o)}</span>
				</div>
				<div class="backlog-item-body">
					<button class="backlog-item-check" title="${e.completed?"Mark incomplete":"Mark complete"}">
						${s}
					</button>
					<span class="backlog-item-text">${d(this,$,pt).call(this,e.description)}</span>
				</div>
				<button class="backlog-item-delete" title="Delete">üóëÔ∏è</button>
			</div>
		`},pt=function(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML},$e=function(){try{localStorage.setItem(r(this,Re),JSON.stringify(r(this,C)))}catch(e){console.error("Failed to save backlog:",e)}},_t=function(){try{const e=localStorage.getItem(r(this,Re));e&&(h(this,C,JSON.parse(e)),d(this,$,st).call(this))}catch(e){console.error("Failed to load backlog:",e),h(this,C,[])}};const Tt={timer:{id:"timer-container",defaultDisplay:"flex"},taskList:{id:"task-list-container",defaultDisplay:"block"},backlog:{id:"backlog-container",defaultDisplay:"block"},infoPanel:{id:"info-panel-container",defaultDisplay:"block"}},Ss=30;class $s{constructor(e){p(this,v);p(this,be,{compact:{name:"Compact",description:"Timer and tasks in a tight side-by-side layout",container:{padding:40},components:{timer:{enabled:!0,display:"flex",position:{top:120,left:80},size:{width:320,height:320,minWidth:280}},taskList:{enabled:!1},backlog:{enabled:!0,position:{top:5,left:460},size:{width:700,minWidth:520,minHeight:420}},infoPanel:{enabled:!1}}},split:{name:"Split View",description:"Timer left, tasks center, backlog right",container:{padding:40},components:{timer:{enabled:!0,display:"flex",position:{top:120,left:80},size:{width:320,height:320}},taskList:{enabled:!1},backlog:{enabled:!0,position:{top:15,left:440},size:{width:320,minHeight:480}},infoPanel:{enabled:!1}}},fullOverlay:{name:"Full Overlay",description:"Balanced dashboard with all panels visible",container:{padding:32},components:{timer:{enabled:!0,display:"flex",position:{top:60,left:780},size:{width:360,height:360}},taskList:{enabled:!1},backlog:{enabled:!0,position:{top:460,left:220},size:{width:280,minHeight:420}},infoPanel:{enabled:!0,position:{top:460,left:540},size:{width:280,minHeight:420}}}},minimal:{name:"Minimal",description:"Single timer focus for clean scenes",container:{padding:60},components:{timer:{enabled:!0,display:"flex",position:{top:320,left:820},size:{width:320,height:320}},taskList:{enabled:!1},backlog:{enabled:!1},infoPanel:{enabled:!1}}},timerWithTasks:{name:"Timer + Tasks",description:"Timer stacked above active tasks",container:{padding:40},components:{timer:{enabled:!0,display:"flex",position:{top:100,left:760},size:{width:360,height:360}},taskList:{enabled:!1},backlog:{enabled:!0,position:{top:480,left:700},size:{width:520,minHeight:420}},infoPanel:{enabled:!1}}},dashboard:{name:"Productivity Dashboard",description:"Comprehensive layout for work and study streams",container:{padding:36},components:{timer:{enabled:!0,display:"flex",position:{top:80,left:80},size:{width:320,height:320}},taskList:{enabled:!1},backlog:{enabled:!0,position:{top:15,left:460},size:{width:360,minHeight:480}},infoPanel:{enabled:!0,position:{top:620,left:480},size:{width:360,minHeight:360}}}}});p(this,ce,"compact");p(this,Q);p(this,z,{});p(this,Y,{});p(this,_e,"enhancedOverlay.panelPositions.v2");p(this,He,"enhancedOverlay.panelSizes.v1");if(h(this,Q,document.getElementById(e)),!r(this,Q)){console.error(`Layout container "${e}" not found`);return}h(this,z,d(this,v,Jt).call(this)),h(this,Y,d(this,v,Kt).call(this));const t=localStorage.getItem("currentLayout")||"compact";this.applyLayout(t)}applyLayout(e){if(!r(this,be)[e])return console.error(`Layout "${e}" not found`),!1;h(this,ce,e);const t=r(this,be)[e];return localStorage.setItem("currentLayout",e),r(this,Q).dataset.layout=e,d(this,v,Ht).call(this),d(this,v,Nt).call(this,t.container),d(this,v,zt).call(this,e,t.components),window.dispatchEvent(new CustomEvent("layoutChanged",{detail:{layoutName:e,layout:t}})),!0}savePanelPosition(e,t,s){r(this,z)[e]||(r(this,z)[e]={});const o=d(this,v,rt).call(this,s);r(this,z)[e][t]={left:Math.round(o.left),top:Math.round(o.top)},d(this,v,ot).call(this)}savePanelSize(e,t,s){r(this,Y)[e]||(r(this,Y)[e]={}),r(this,Y)[e][t]={width:Math.round(s.width),height:Math.round(s.height)},d(this,v,it).call(this)}resetPanelPosition(e,t=r(this,ce)){var s;return r(this,z)[t]?e?r(this,z)[t][e]?(delete r(this,z)[t][e],(s=r(this,Y)[t])!=null&&s[e]&&(delete r(this,Y)[t][e],d(this,v,it).call(this)),d(this,v,ot).call(this),this.applyLayout(t),!0):!1:(delete r(this,z)[t],delete r(this,Y)[t],d(this,v,ot).call(this),d(this,v,it).call(this),this.applyLayout(t),!0):!1}resetLayoutPositions(e){return this.resetPanelPosition(void 0,e)}getAvailableLayouts(){return Object.entries(r(this,be)).map(([e,t])=>({name:e,displayName:t.name,description:t.description}))}getCurrentLayout(){return r(this,ce)}getDefaultPosition(e,t){var o,a;const s=r(this,be)[e];return((a=(o=s==null?void 0:s.components)==null?void 0:o[t])==null?void 0:a.position)??null}createLayoutSelector(){const e=document.createElement("div");return e.className="layout-selector glass-effect",e.innerHTML=`
			<div class="layout-selector-header">
				<h4>Layout Presets</h4>
				<button class="layout-close-btn">√ó</button>
			</div>
			<div class="layout-options">
				${this.getAvailableLayouts().map(t=>`
					<button 
						class="layout-option ${t.name===r(this,ce)?"active":""}"
						data-layout="${t.name}"
					>
						<div class="layout-option-name">${t.displayName}</div>
						<div class="layout-option-desc">${t.description}</div>
					</button>
				`).join("")}
			</div>
		`,e.querySelectorAll(".layout-option").forEach(t=>{t.addEventListener("click",()=>{const s=t,o=s.dataset.layout;this.applyLayout(o),e.querySelectorAll(".layout-option").forEach(a=>a.classList.remove("active")),s.classList.add("active")})}),e.querySelector(".layout-close-btn").addEventListener("click",()=>{e.remove()}),e}convertToBasePosition(e){return d(this,v,rt).call(this,e)}refreshLayout(){this.applyLayout(r(this,ce))}}be=new WeakMap,ce=new WeakMap,Q=new WeakMap,z=new WeakMap,Y=new WeakMap,_e=new WeakMap,He=new WeakMap,v=new WeakSet,Ht=function(){const e=r(this,Q).style;e.display="block",e.gridTemplateColumns="",e.gridTemplateRows="",e.justifyContent="",e.alignItems="",e.maxWidth="",e.height="",e.gap="",e.position="fixed",e.top="0",e.left="0",e.width="100%",e.height="100%",e.padding=`${Ss}px`,e.boxSizing="border-box",e.overflow="visible"},Nt=function(e={}){if(!e)return;const t=r(this,Q).style;typeof e.padding=="number"&&(t.padding=`${e.padding}px`)},zt=function(e,t){const{scaleX:s,scaleY:o}=d(this,v,ft).call(this),a=r(this,Q).getBoundingClientRect();Object.values(Tt).forEach(({id:l})=>{const i=document.getElementById(l);i&&(i.style.display="none",i.removeAttribute("aria-hidden"))}),Object.entries(t).forEach(([l,i])=>{const c=Tt[l];if(!c)return;const u=document.getElementById(c.id);if(!u)return;if(!(i!=null&&i.enabled)){u.style.display="none",u.setAttribute("aria-hidden","true");return}u.style.display=i.display||c.defaultDisplay,u.classList.add("draggable-panel"),u.style.position="absolute",u.style.zIndex=i.zIndex??10,u.dataset.panel=l,u.style.transform="none",console.log(`Setting up panel ${l}:`,{display:u.style.display,position:u.style.position,left:u.style.left,top:u.style.top,class:u.className}),d(this,v,Gt).call(this,u,i.size,l,e);const T=d(this,v,jt).call(this,e,l)??i.position;if(T){const k=d(this,v,Yt).call(this,T,s,o),f=d(this,v,Wt).call(this,k,u,a);u.style.left=`${Math.round(f.left)}px`,u.style.top=`${Math.round(f.top)}px`;const m=d(this,v,rt).call(this,f);u.dataset.baseLeft=`${m.left}`,u.dataset.baseTop=`${m.top}`}})},Gt=function(e,t={},s=null,o=null){const a=o&&s?d(this,v,Vt).call(this,o,s):null,l=a?{...t,...a}:t;["width","height","minWidth","minHeight","maxWidth","maxHeight"].forEach(c=>{l[c]!==void 0?e.style[c]=`${l[c]}px`:e.style[c]=""})},jt=function(e,t){var s;return((s=r(this,z)[e])==null?void 0:s[t])??null},Vt=function(e,t){var s;return((s=r(this,Y)[e])==null?void 0:s[t])??null},ft=function(){if(!r(this,Q))return{scaleX:1,scaleY:1};const e=1,t=1;return console.log("Using 1:1 scale for 1920x1080 resolution"),{scaleX:e,scaleY:t}},Yt=function(e,t,s){return{left:e.left*t,top:e.top*s}},Wt=function(e,t,s){const o=t.getBoundingClientRect(),a=o.width||t.offsetWidth||0,l=o.height||t.offsetHeight||0,i=Math.max(0,s.width-a),c=Math.max(0,s.height-l);return{left:Math.max(0,Math.min(i,e.left)),top:Math.max(0,Math.min(c,e.top))}},rt=function(e){const{scaleX:t,scaleY:s}=d(this,v,ft).call(this);return{left:e.left/t,top:e.top/s}},Jt=function(){try{const e=localStorage.getItem(r(this,_e));return e?JSON.parse(e):{}}catch(e){return console.warn("Failed to load saved panel positions",e),{}}},ot=function(){try{localStorage.setItem(r(this,_e),JSON.stringify(r(this,z)))}catch(e){console.warn("Failed to persist panel positions",e)}},Kt=function(){try{const e=localStorage.getItem(r(this,He));return e?JSON.parse(e):{}}catch(e){return console.warn("Failed to load saved panel sizes",e),{}}},it=function(){try{localStorage.setItem(r(this,He),JSON.stringify(r(this,Y)))}catch(e){console.warn("Failed to persist panel sizes",e)}};class Ls{constructor(e){p(this,B);p(this,de);p(this,P,{title:"Stream Goal",current:0,target:100,active:!1});p(this,Ne,"overlay.goalData");if(h(this,de,document.getElementById(e)),!r(this,de)){console.error(`Goal container "${e}" not found`);return}d(this,B,Xt).call(this),d(this,B,gt).call(this)}setGoal(e,t,s=0){h(this,P,{title:e||"Goal",target:typeof t=="number"?t:parseInt(t)||100,current:typeof s=="number"?s:parseInt(s)||0,active:!0}),d(this,B,Ge).call(this),this.render()}updateProgress(e){const t=typeof e=="number"?e:parseInt(e)||0;r(this,P).current+=t,r(this,P).current<0&&(r(this,P).current=0),d(this,B,Ge).call(this),this.render()}reset(){r(this,P).current=0,d(this,B,Ge).call(this),this.render()}hide(){r(this,P).active=!1,d(this,B,Ge).call(this),this.render()}render(){if(!r(this,de))return;const e=r(this,de).querySelector(".goal-panel");if(!e){d(this,B,gt).call(this);return}r(this,P).active?(e.classList.remove("hidden"),e.classList.add("active")):(e.classList.add("hidden"),e.classList.remove("active"));const t=e.querySelector(".goal-title"),s=e.querySelector(".goal-progress-text"),o=e.querySelector(".goal-bar-fill");t&&(t.textContent=r(this,P).title),s&&(s.textContent=`${r(this,P).current} / ${r(this,P).target}`),o instanceof HTMLElement&&(o.style.width=`${d(this,B,yt).call(this)}%`)}}de=new WeakMap,P=new WeakMap,Ne=new WeakMap,B=new WeakSet,gt=function(){r(this,de).innerHTML=`
			<div class="goal-panel ${r(this,P).active?"active":"hidden"}">
				<div class="goal-info">
					<span class="goal-title">${r(this,P).title}</span>
					<span class="goal-progress-text">${r(this,P).current} / ${r(this,P).target}</span>
				</div>
				<div class="goal-bar-container">
					<div class="goal-bar-fill" style="width: ${d(this,B,yt).call(this)}%"></div>
				</div>
			</div>
		`},yt=function(){if(r(this,P).target<=0)return 0;const e=r(this,P).current/r(this,P).target*100;return Math.min(Math.max(e,0),100)},Ge=function(){localStorage.setItem(r(this,Ne),JSON.stringify(r(this,P)))},Xt=function(){const e=localStorage.getItem(r(this,Ne));if(e)try{h(this,P,JSON.parse(e))}catch(t){console.error("Failed to load goal state",t)}};const{twitch_channel:Cs,twitch_oauth:ws,twitch_username:Es}=_authConfig,xs="wss://irc-ws.chat.twitch.tv:443",K=new gs(xs,{username:Es,authToken:ws,channel:Cs});let De,me,re,X,A,pe;const we=new Map,Ps={timer:".circular-timer",taskList:".header",backlog:".backlog-header",goal:".goal-panel"};window.addEventListener("load",()=>{let n="userList";_settings.testMode&&(console.log("Test mode enabled"),n="testUserList"),De=new is(n),De.render(),me=new bs,re=new vs("timer-container"),X=new Ts("backlog-container"),De.setBacklogPanel(X),pe=new Ls("goal-container"),A=new $s("app"),St(),Ms(),Us(),K.on("command",e=>{const{user:t,command:s,message:o,flags:a,extra:l}=e,i=Is(t,s,o,a);if(i){i.error?console.error(i.message):K.say(i.message,l.messageId);return}const c=De.chatHandler(t,s,o,a,l);c.error?console.error(c.message):K.say(c.message,l.messageId)}),K.on("oauthError",()=>{ls()}),K.on("oauthSuccess",()=>{cs()}),K.connect(),_settings.testMode&&ks(K)});function Is(n,e,t,s,o){var b,T;const a=`!${e.toLowerCase()}`,l=s.broadcaster||s.mod,i=_settings.botResponsePrefix,c=(t||"").trim(),u=k=>{if(!k)return null;const f=k.toLowerCase(),m=f.replace(/[^a-z0-9]/g,""),g=A.getAvailableLayouts();for(const S of g){const M=S.name.toLowerCase(),R=M.replace(/[^a-z0-9]/g,""),Z=S.displayName.toLowerCase(),ve=Z.replace(/[^a-z0-9]/g,"");if(M===f||R===m||Z===f||ve===m)return S.name}return null};if(a==="!theme"){if(!l)return{message:`${i}@${n} Only broadcasters and moderators can change themes.`,error:!0};if(!c){const m=me.getAvailableThemes().map(g=>g.name).join(", ");return{message:`${i}Available themes: ${m}. Use !theme [name] to switch.`,error:!1}}const k=c.toLowerCase(),f=me.applyTheme(k);return{message:f?`${i}Theme changed to ${c}! üé®`:`${i}Theme "${c}" not found.`,error:!f}}if(a==="!layout"){if(!l)return{message:`${i}@${n} Only broadcasters and moderators can change layouts.`,error:!0};if(!c){const g=A.getAvailableLayouts().map(S=>`${S.name} (${S.description})`).join(", ");return{message:`${i}Available layouts: ${g}. Use !layout [name] to switch.`,error:!1}}const k=u(c);if(!k)return{message:`${i}Layout "${c}" not found.`,error:!0};const f=A.applyLayout(k),m=A.getAvailableLayouts().find(g=>g.name===k);return{message:f?`${i}Layout changed to ${(m==null?void 0:m.displayName)||k}! üìê`:`${i}Layout "${c}" not found.`,error:!f}}if(a==="!resetpanel"){if(!l)return{message:`${i}@${n} Only moderators can reset panel positions.`,error:!0};if(!c)return{message:`${i}Usage: !resetpanel [timer|tasklist|backlog|infopanel] (optional layout)`,error:!1};const[k,f]=c.split(/\s+/),m=k==null?void 0:k.toLowerCase();if(!m||!["timer","tasklist","backlog","infopanel"].includes(m))return{message:`${i}Panel must be one of: timer, tasklist, backlog, infopanel.`,error:!0};const S=m==="tasklist"?"taskList":m==="infopanel"?"infoPanel":m,M=f?u(f):A.getCurrentLayout();if(!M)return{message:`${i}Layout "${f}" not found.`,error:!0};const R=A.getAvailableLayouts().find(Ze=>Ze.name===M),Z=(R==null?void 0:R.displayName)||M,ve=A.resetPanelPosition(S,M);return{message:ve?`${i}Reset ${m} panel position for ${Z}.`:`${i}No custom position stored for ${m} in ${Z}.`,error:!ve}}if(a==="!resetlayout"){if(!l)return{message:`${i}@${n} Only moderators can reset layouts.`,error:!0};const k=c?u(c):A.getCurrentLayout();if(!k)return{message:`${i}Layout "${c}" not found.`,error:!0};const f=A.getAvailableLayouts().find(S=>S.name===k),m=(f==null?void 0:f.displayName)||k,g=A.resetLayoutPositions(k);return{message:g?`${i}Reset all panel positions for ${m}.`:`${i}No custom positions stored for ${m}.`,error:!g}}if(a==="!backlog"){const k=c.length?c.split(/\s+/):[],f=(b=k[0])==null?void 0:b.toLowerCase(),m=k.slice(1).join(" ");if(!f)return{message:`${i}@${n} Usage: !backlog add/done/remove [text/number]`,error:!1};if(f==="add"){if(!m)return{message:`${i}@${n} Provide a task description to add.`,error:!0};const g=X.addItem(m,n);return{message:g?`${i}@${n} Added "${m}" to backlog! üìã`:`${i}@${n} Backlog is full!`,error:!g}}if(f==="done"||f==="remove"){const g=parseInt(m,10);if(!m||Number.isNaN(g)||g<1)return{message:`${i}@${n} Provide a valid backlog item number.`,error:!0};let S;return l?S=X.getItemByIndex(g):S=X.getUserItemByIndex(n,g),S?f==="done"?(X.toggleComplete(S.id),{message:`${i}@${n} Marked backlog item ${g} as done! ‚úÖ`,error:!1}):(X.removeItem(S.id),{message:`${i}@${n} Removed backlog item ${g}! üóëÔ∏è`,error:!1}):{message:l?`${i}@${n} Backlog item ${g} not found.`:`${i}@${n} You don't have a backlog item #${g}.`,error:!0}}if(f==="clear"){if(!l)return{message:`${i}@${n} Only broadcasters and moderators can clear the backlog.`,error:!0};if(m.toLowerCase()==="all"){const S=X.clearAll();return{message:`${i}Cleared ALL ${S} backlog items! üóëÔ∏è`,error:!1}}const g=X.clearCompleted();return{message:`${i}Cleared ${g} completed backlog item${g!==1?"s":""}!`,error:!1}}return{message:`${i}@${n} Usage: !backlog add/done/remove [text/number]`,error:!1}}if(a==="!goal"){if(!l)return{message:`${i}@${n} Only broadcasters and moderators can manage goals.`,error:!0};const k=c.length?c.split(/\s+/):[],f=(T=k[0])==null?void 0:T.toLowerCase(),m=k.slice(1);if(!f)return{message:`${i}Usage: !goal set [title] [target] [current] | !goal add [n] | !goal reset | !goal hide/show`,error:!1};if(f==="set"){if(m.length<2)return{message:`${i}Usage: !goal set [title] [target] [optional: current]`,error:!0};let g,S=0,M;const R=m[m.length-1],Z=m[m.length-2];return m.length>=3&&!isNaN(Number(R))&&!isNaN(Number(Z))?(S=parseInt(m.pop()),g=parseInt(m.pop()),M=m.join(" ")):(g=parseInt(m.pop()),M=m.join(" ")),pe.setGoal(M,g,S),{message:`${i}Goal set: ${M} (${S}/${g})! üéØ`,error:!1}}if(f==="add"||f==="remove"){const g=parseInt(m[0])||1;return pe.updateProgress(f==="add"?g:-g),{message:`${i}Goal updated! üìà`,error:!1}}if(f==="reset")return pe.reset(),{message:`${i}Goal progress reset! üîÑ`,error:!1};if(f==="hide")return pe.hide(),{message:`${i}Goal tracker hidden.`,error:!1};if(f==="show")return pe.setGoal(),{message:`${i}Goal tracker visible.`,error:!1}}if(a==="!pomopause")return l?(re.pause(),{message:`${i}Timer paused! ‚è∏Ô∏è`,error:!1}):{message:`${i}@${n} Only moderators can control the timer.`,error:!0};if(a==="!pomoresume")return l?(re.resume(),{message:`${i}Timer resumed! ‚ñ∂Ô∏è`,error:!1}):{message:`${i}@${n} Only moderators can control the timer.`,error:!0};if(a==="!pomostop"||a==="!stoptimer")return l?(re.stop(),{message:`${i}Timer stopped! ‚èπÔ∏è`,error:!1}):{message:`${i}@${n} Only moderators can control the timer.`,error:!0};if(a==="!pomoreset")return l?(re.reset(),{message:`${i}Timer reset! All sessions cleared. üîÑ`,error:!1}):{message:`${i}@${n} Only moderators can control the timer.`,error:!0};if(a==="!pomostatus"){const k=re.getState(),f=Math.floor(k.currentSeconds/60),m=k.currentSeconds%60,g=`${f}:${m.toString().padStart(2,"0")}`,S=k.isRunning?"Running":k.isPaused?"Paused":"Stopped";return{message:`${i}Timer: ${S} | ${k.mode} mode | ${g} | Session ${k.currentSession}/${k.totalSessions} üìä`,error:!1}}if(a==="!pomo"||a==="!pomodoro"){if(!l)return{message:`${i}@${n} Only moderators can control the timer.`,error:!0};const k=c.split("/"),f=Math.max(1,parseInt(k[0],10)||25),m=Math.max(1,parseInt(k[1],10)||5),g=Math.max(1,Math.min(12,parseInt(k[2],10)||4));return re.startCycle(f,m,g,(S,M,R)=>{S==="focus"?K.say(`${i}Focus session ${M} complete! Time for a break ‚òï`):S==="break"||S==="longbreak"?K.say(`${i}Break over! Starting session ${M+1}/${R} üí™`):S==="cycle_complete"&&K.say(`${i}Pomodoro cycle complete! ${R} sessions done! üéâ`)}),{message:`${i}Pomodoro started: ${f}m focus / ${m}m break √ó ${g} sessions ‚è±Ô∏è`,error:!1}}return null}function lt(n,e,t={}){const{strategy:s="transform",bounds:o=null,onDragStart:a,onDragEnd:l}=t,i=e||n;let c=!1,u=0,b=0,T=0,k=0,f=0,m=0,g=0,S=0,M={left:n.offsetLeft||0,top:n.offsetTop||0};const R=typeof o=="string"?document.querySelector(o):o;i.style.cursor="move";const Z=G=>{if(G.button===0&&!(G.target instanceof HTMLButtonElement||G.target.closest("button"))){if(c=!0,n.classList.add("dragging"),document.body.classList.add("overlay-dragging"),s==="absolute"){const J=n.getBoundingClientRect(),he=R?R.getBoundingClientRect():{left:0,top:0};g=G.clientX-J.left,S=G.clientY-J.top,f=J.left-he.left,m=J.top-he.top,M={left:f,top:m}}else{const J=window.getComputedStyle(n),he=new DOMMatrix(J.transform);f=he.m41,m=he.m42,T=G.clientX-f,k=G.clientY-m}a==null||a()}},ve=G=>{if(c)if(G.preventDefault(),s==="absolute"){const J=R?R.getBoundingClientRect():{left:0,top:0,width:window.innerWidth,height:window.innerHeight},he=n.getBoundingClientRect();let et=G.clientX-J.left-g,tt=G.clientY-J.top-S;const As=Math.max(0,J.width-he.width),Fs=Math.max(0,J.height-he.height);et=Math.max(0,Math.min(As,et)),tt=Math.max(0,Math.min(Fs,tt)),n.style.left=`${Math.round(et)}px`,n.style.top=`${Math.round(tt)}px`,M={left:et,top:tt}}else u=G.clientX-T,b=G.clientY-k,f=u,m=b,n.style.transform=`translate(${u}px, ${b}px)`},Ze=()=>{c&&(c=!1,n.classList.remove("dragging"),document.body.classList.remove("overlay-dragging"),s!=="absolute"&&(T=u,k=b),l==null||l({left:Math.round(M.left),top:Math.round(M.top)}))};return i.addEventListener("mousedown",Z),document.addEventListener("mousemove",ve),document.addEventListener("mouseup",Ze),()=>{i.removeEventListener("mousedown",Z),document.removeEventListener("mousemove",ve),document.removeEventListener("mouseup",Ze),n.classList.remove("dragging"),document.body.classList.remove("overlay-dragging")}}function St(){if(!A)return;const n=document.getElementById("app");if(!n)return;const e=new Set;n.querySelectorAll(".draggable-panel").forEach(s=>{var u;const o=s,a=o.dataset.panel;if(!a||(e.add(a),we.has(a)&&((u=we.get(a))==null||u(),we.delete(a)),getComputedStyle(o).display==="none"))return;const l=Ps[a],i=l?o.querySelector(l):null,c=lt(o,i||o,{strategy:"absolute",bounds:n,onDragEnd:b=>{A.savePanelPosition(A.getCurrentLayout(),a,b)}});we.set(a,c)});const t=[];we.forEach((s,o)=>{e.has(o)||(s(),t.push(o))}),t.forEach(s=>we.delete(s))}window.addEventListener("layoutChanged",()=>St());function Ms(){const n=document.getElementById("theme-toggle");if(!n)return;let e=!1,t=null;n.addEventListener("click",()=>{e&&t?(t.remove(),t=null,e=!1):(t=Os(),document.body.appendChild(t),lt(t),e=!0)}),document.addEventListener("click",s=>{const o=s.target;e&&t&&!n.contains(o)&&!t.contains(o)&&(t.remove(),t=null,e=!1)})}function Os(){const n=document.createElement("div");n.className="theme-menu";const e=me.getCurrentTheme(),t=me.getAvailableThemes();return n.innerHTML=`
		<div class="theme-menu-header" title="Drag to move">
			<span>üé® Themes</span>
			<span class="drag-hint">‚ãÆ‚ãÆ</span>
		</div>
		<div class="theme-list">
			${t.map(s=>`
				<button 
					class="theme-item ${s.name===e?"active":""}"
					data-theme="${s.name}"
				>
					${s.displayName}
				</button>
			`).join("")}
		</div>
	`,n.querySelectorAll(".theme-item").forEach(s=>{s.addEventListener("click",()=>{const o=s.getAttribute("data-theme");me.applyTheme(o),n.querySelectorAll(".theme-item").forEach(a=>a.classList.remove("active")),s.classList.add("active")})}),n}function Us(){document.addEventListener("keydown",n=>{var e;(n.ctrlKey||n.metaKey)&&n.shiftKey&&n.key==="L"&&(n.preventDefault(),Ds()),(n.ctrlKey||n.metaKey)&&n.shiftKey&&n.key==="T"&&(n.preventDefault(),(e=document.getElementById("theme-toggle"))==null||e.click())})}function Ds(){const n=document.querySelector(".layout-selector");if(n){n.remove();return}const e=A.createLayoutSelector();document.body.appendChild(e);const t=e.querySelector(".layout-selector-header");t&&lt(e,t)}typeof window<"u"&&(window.debugOverlay={app:De,themeManager:me,circularTimer:re,backlogPanel:X,goalPanel:pe,layoutManager:A})})();
